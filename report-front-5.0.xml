This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.gitignore
eslint.config.js
index.html
package.json
public/vite.svg
README.md
src/App.jsx
src/assets/carrusel-1.png
src/assets/carrusel-3.png
src/assets/dr-chapatin.png
src/assets/imagen.png
src/assets/imagen2.png
src/assets/logo.png
src/assets/logo1.png
src/assets/z.png
src/components/Admin/AdminStats.jsx
src/components/Admin/RegisterSpecialistModal.jsx
src/components/Admin/UserRow.jsx
src/components/Admin/UserTable.jsx
src/components/Carousel.jsx
src/components/Chat/ChatWidget.jsx
src/components/Dashboard/GlucoseCard.jsx
src/components/Dashboard/HealthRegisterForm.jsx
src/components/Dashboard/PressureCard.jsx
src/components/Guards/AdminGuard.jsx
src/components/Guards/PatientGuard.jsx
src/components/Guards/SpecialistGuard.jsx
src/components/Landing/DrChapatinSection.jsx
src/components/Landing/HowToUseSection.jsx
src/components/Loader.jsx
src/components/Navbar.jsx
src/components/SosButton.jsx
src/index.css
src/main.jsx
src/pages/AboutPage.jsx
src/pages/AdminPage.jsx
src/pages/ContactPage.jsx
src/pages/Dashboard.jsx
src/pages/HealthRegisterPage.jsx
src/pages/HistoryPage.jsx
src/pages/HomePage.jsx
src/pages/LoginPage.jsx
src/pages/MedicalRecords.jsx
src/pages/PatientFile.jsx
src/pages/ProfilePage.jsx
src/pages/RegisterPage.jsx
src/pages/ResetPassword.jsx
src/pages/SpecialistDashboard.jsx
src/services/AdminService.js
src/services/AuthService.js
src/services/downloadService.js
src/services/MedicalService.js
src/services/readingsService.js
src/services/SpecialistService.js
src/setupTests.js
src/Styles/AboutStyles.css
src/Styles/AdminStyles.css
src/Styles/carouselStyles.css
src/Styles/ChatWidgetStyles.css
src/Styles/ContactStyles.css
src/Styles/DashboardStyles.css
src/Styles/DrChapatinSection.css
src/Styles/healthRegister.css
src/Styles/healthStyles.css
src/Styles/HistoryStyles.css
src/Styles/homeStyles.css
src/Styles/HowToUseSection.css
src/Styles/LoaderStyles.css
src/Styles/loginStyles.css
src/Styles/medicalRecordsStyles.css
src/Styles/NavbarStyles.css
src/Styles/ProfileStyles.css
src/Styles/ResetPasswordStyles.css
src/Styles/signUpStyles.css
src/Styles/SosButtonStyles.css
src/Styles/SpecialistStyles.css
src/tests/components/Admin/AdminStats.test.jsx
src/tests/components/Admin/RegisterSpecialistModal.test.jsx
src/tests/components/Admin/UserRow.test.jsx
src/tests/components/Admin/UserTable.test.jsx
src/tests/components/Chat/ChatWidget.test.jsx
src/tests/components/Dashboard/GlucoseCard.test.jsx
src/tests/components/Dashboard/HealthRegisterForm.test.jsx
src/tests/components/Dashboard/PressureCard.test.jsx
src/tests/components/Guards/AdminGuard.test.jsx
src/tests/components/Guards/PatientGuard.test.jsx
src/tests/components/Guards/SpecialistGuard.test.jsx
src/tests/components/Landing/DrChapatinSection.test.jsx
src/tests/components/Landing/HowToUseSection.test.jsx
src/tests/components/Loader.test.jsx
src/tests/components/Navbar.test.jsx
src/tests/components/SosButton.test.jsx
src/tests/pages/AboutPage.test.jsx
src/tests/pages/AdminPage.test.jsx
src/tests/pages/ContactPage.test.jsx
src/tests/pages/Dashboard.test.jsx
src/tests/pages/HealthRegisterPage.test.jsx
src/tests/pages/HistoryPage.test.jsx
src/tests/pages/Login.test.jsx
src/tests/pages/MedicalRecords.test.jsx
src/tests/pages/PatientFile.test.jsx
src/tests/pages/ProfilePage.test.jsx
src/tests/pages/RegisterPage.test.jsx
src/tests/pages/ResetPassword.test.jsx
src/tests/pages/SpecialistDashboard.test.jsx
src/tests/services/AdminService.test.js
src/tests/services/AuthService.test.js
src/tests/services/downloadService.test.js
src/tests/services/MedicalService.test.js
src/tests/services/readingsService.test.js
src/tests/services/SpecialistService.test.js
src/tests/setup.js
src/tests/utils/formatDate.test.js
src/tests/utils/formatDateDownload.test.js
src/tests/utils/validations.test.js
src/utils/formatDate.js
src/utils/formatDateDownload.js
src/utils/validations.js
vite.config.js
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".gitignore">
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Testing
coverage/

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?

# Seguridad y Variables de Entorno
.env
.env.local
.env.development.local
.env.test.local
.env.production.local

# Archivos de Sistema
.DS_Store
Thumbs.db

# Logs de error adicionales
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
</file>

<file path="eslint.config.js">
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },
])
</file>

<file path="index.html">
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>web-monitoreo</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
</file>

<file path="public/vite.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="31.88" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 257"><defs><linearGradient id="IconifyId1813088fe1fbc01fb466" x1="-.828%" x2="57.636%" y1="7.652%" y2="78.411%"><stop offset="0%" stop-color="#41D1FF"></stop><stop offset="100%" stop-color="#BD34FE"></stop></linearGradient><linearGradient id="IconifyId1813088fe1fbc01fb467" x1="43.376%" x2="50.316%" y1="2.242%" y2="89.03%"><stop offset="0%" stop-color="#FFEA83"></stop><stop offset="8.333%" stop-color="#FFDD35"></stop><stop offset="100%" stop-color="#FFA800"></stop></linearGradient></defs><path fill="url(#IconifyId1813088fe1fbc01fb466)" d="M255.153 37.938L134.897 252.976c-2.483 4.44-8.862 4.466-11.382.048L.875 37.958c-2.746-4.814 1.371-10.646 6.827-9.67l120.385 21.517a6.537 6.537 0 0 0 2.322-.004l117.867-21.483c5.438-.991 9.574 4.796 6.877 9.62Z"></path><path fill="url(#IconifyId1813088fe1fbc01fb467)" d="M185.432.063L96.44 17.501a3.268 3.268 0 0 0-2.634 3.014l-5.474 92.456a3.268 3.268 0 0 0 3.997 3.378l24.777-5.718c2.318-.535 4.413 1.507 3.936 3.838l-7.361 36.047c-.495 2.426 1.782 4.5 4.151 3.78l15.304-4.649c2.372-.72 4.652 1.36 4.15 3.788l-11.698 56.621c-.732 3.542 3.979 5.473 5.943 2.437l1.313-2.028l72.516-144.72c1.215-2.423-.88-5.186-3.54-4.672l-25.505 4.922c-2.396.462-4.435-1.77-3.759-4.114l16.646-57.705c.677-2.35-1.37-4.583-3.769-4.113Z"></path></svg>
</file>

<file path="src/index.css">
/* src/index.css */
body {
  margin: 0;
  display: block; /* Quita el centrado forzado de Vite */
  min-width: 320px;
  min-height: 100vh;
  background-color: #f0f4f8; /* Fondo gris clínico suave */
}

#root {
  width: 100%;
}
</file>

<file path="src/main.jsx">
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.jsx'

createRoot(document.getElementById('root')).render(
  <StrictMode>
    <App />
  </StrictMode>,
)
</file>

<file path="src/services/readingsService.js">
export function getLastReading() {
  return {
    glucose: 300,
    systolic: 134,
    diastolic: 92,
    date: "13 de enero, 14:02",
  };
}
</file>

<file path="src/Styles/healthStyles.css">
.health-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  padding: 20px;
  background-color: #f0f4f8;
}

.health-card {
  background: white;
  padding: 2rem;
  border-radius: 12px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.08);
  width: 100%;
  max-width: 450px;
  border-top: 6px solid #1e40af; 
}

.health-card h3 {
  color: #1e3a8a;
  text-align: center;
  margin-bottom: 20px;
}

.input-group {
  margin-bottom: 20px;
  text-align: left;
}

.input-group label {
  display: block;
  margin-bottom: 8px;
  font-size: 0.9rem;
  color: #1e40af;
  font-weight: bold;
}

.dual-input {
  display: flex;
  align-items: center;
  gap: 10px;
}

.health-card input {
  width: 100%;
  padding: 12px;
  border: 1px solid #d1d5db;
  border-radius: 6px;
  box-sizing: border-box;
}

.btn-save {
  width: 100%;
  padding: 14px;
  background-color: #1e40af;
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 1rem;
  font-weight: bold;
  cursor: pointer;
  transition: 0.3s;
}

.btn-save:hover {
  background-color: #1d4ed8;
}

@media (max-width: 480px) {
  .health-card {
    padding: 1.5rem;
  }
  .dual-input {
    flex-direction: column;
  }
}
</file>

<file path="src/Styles/signUpStyles.css">
.signup-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  padding: 20px;
  background-color: #f0f4f8;
}

.signup-box {
  background: white;
  padding: 2.5rem;
  border-radius: 12px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.1);
  width: 100%;
  max-width: 500px;
  border-top: 6px solid #1e40af;
  text-align: center;
}

.signup-logo {
  width: 200px; 
  height: auto;
  margin-bottom: 20px;
}

.form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 15px;
  text-align: left;
}

.form-group {
  display: flex;
  flex-direction: column;
}

.form-group label {
  font-size: 0.85rem;
  color: #1e40af;
  margin-bottom: 5px;
  font-weight: bold;
}

.form-group input {
  padding: 10px;
  border: 1px solid #d1d5db;
  border-radius: 6px;
  font-size: 0.9rem;
  box-sizing: border-box;
}

.form-group.full-width {
  grid-column: span 2;
}

.error-message-container {
  grid-column: span 2;
  color: #dc2626;
  text-align: center;
  margin-bottom: 10px;
  font-size: 0.9rem;
  font-weight: 500;
}

.btn-signup {
  grid-column: span 2; 
  margin-top: 20px;
  padding: 14px;
  background-color: #1e40af;
  color: white;
  border: none;
  border-radius: 6px;
  font-weight: bold;
  font-size: 1rem;
  cursor: pointer;
  transition: background 0.3s;
}

.btn-signup:hover {
  background-color: #1d4ed8;
}

.signup-footer {
  margin-top: 20px;
  font-size: 0.9rem;
  color: #64748b;
}

.signup-footer a {
  color: #1e40af;
  font-weight: bold;
  text-decoration: none;
}

@media (max-width: 480px) {
  .form-grid {
    grid-template-columns: 1fr;
  }
  .form-group.full-width {
    grid-column: span 1;
  }
  .error-message-container {
    grid-column: span 1;
  }
  .btn-signup {
    grid-column: span 1;
  }
  .signup-box {
    padding: 1.5rem;
    box-shadow: none;
  }
  .signup-logo {
    width: 160px;
  }
}
</file>

<file path="src/tests/components/Admin/AdminStats.test.jsx">
import { describe, it, expect, vi, beforeEach } from 'vitest';
import { render, screen, waitFor } from '@testing-library/react';
import AdminStats from '../../../components/Admin/AdminStats';
import * as AdminService from '../../../services/AdminService';

vi.mock('../../../services/AdminService');

describe('AdminStats.jsx', () => {
  const mockStats = {
    total: 100,
    active: 50,
    roles: [
      { role: 'admin', count: 5 },
      { role: 'specialist', count: 15 },
      { role: 'patient', count: 80 }
    ]
  };

  beforeEach(() => {
    vi.clearAllMocks();
  });

  it('debe renderizar con valores en 0 inicialmente', () => {
    AdminService.getStats.mockResolvedValue({});
    render(<AdminStats />);

    expect(screen.getByText('Total Usuarios')).toBeInTheDocument();
    
    const values = screen.getAllByText('0');
    expect(values.length).toBeGreaterThan(0);
  });

  it('debe cargar y mostrar las estadísticas correctamente', async () => {
    AdminService.getStats.mockResolvedValue(mockStats);

    render(<AdminStats />);

    await waitFor(() => {
      expect(screen.getByText('100')).toBeInTheDocument();
      expect(screen.getByText('50')).toBeInTheDocument();
      expect(screen.getByText('5')).toBeInTheDocument();
      expect(screen.getByText('15')).toBeInTheDocument();
      expect(screen.getByText('80')).toBeInTheDocument();
    });
  });
});
</file>

<file path="src/tests/components/Admin/RegisterSpecialistModal.test.jsx">
import { describe, it, expect, vi, beforeEach } from 'vitest';
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import RegisterSpecialistModal from '../../../components/Admin/RegisterSpecialistModal';
import * as AdminService from '../../../services/AdminService';

vi.mock('../../../services/AdminService');

describe('RegisterSpecialistModal.jsx', () => {
  const mockOnClose = vi.fn();
  const mockOnSuccess = vi.fn();

  beforeEach(() => {
    vi.clearAllMocks();
    vi.spyOn(window, 'alert').mockImplementation(() => {});
  });

  it('debe renderizar el formulario correctamente', () => {
    render(<RegisterSpecialistModal onClose={mockOnClose} onSuccess={mockOnSuccess} />);
    expect(screen.getByText(/Registrar Especialista/i)).toBeInTheDocument();
    expect(screen.getByPlaceholderText(/12.345.678-K/i)).toBeInTheDocument();
  });

  it('debe mostrar errores de validación si se envía vacío', () => {
    render(<RegisterSpecialistModal onClose={mockOnClose} onSuccess={mockOnSuccess} />);
    
    const submitBtn = screen.getByText('Registrar Profesional');
    fireEvent.click(submitBtn);

    expect(screen.getByText(/RUT es incompleto/i)).toBeInTheDocument();
    expect(screen.getByText(/Formato de correo inválido/i)).toBeInTheDocument();
  });

  it('debe formatear el RUT automáticamente mientras se escribe', () => {
    render(<RegisterSpecialistModal onClose={mockOnClose} onSuccess={mockOnSuccess} />);
    
    const rutInput = screen.getByPlaceholderText(/12.345.678-K/i);
    fireEvent.change(rutInput, { target: { value: '123456789' } });

    expect(rutInput.value).toBe('12.345.678-9');
  });

  it('debe llamar a createSpecialist y cerrar el modal en éxito', async () => {
    AdminService.createSpecialist.mockResolvedValue({ success: true });

    const { container } = render(<RegisterSpecialistModal onClose={mockOnClose} onSuccess={mockOnSuccess} />);

    const inputNames = container.querySelector('input[name="first_names"]');
    const inputLastNames = container.querySelector('input[name="last_names"]');
    const inputRut = container.querySelector('input[name="rut"]');
    const inputEmail = container.querySelector('input[name="email"]');
    const inputPassword = container.querySelector('input[name="password"]');

    fireEvent.change(inputNames, { target: { value: 'Dr' } });
    fireEvent.change(inputLastNames, { target: { value: 'House' } });
    fireEvent.change(inputRut, { target: { value: '111111111' } });
    fireEvent.change(inputEmail, { target: { value: 'house@hospital.com' } });
    fireEvent.change(inputPassword, { target: { value: 'Password123!' } });

    fireEvent.click(screen.getByText('Registrar Profesional'));

    await waitFor(() => {
      expect(AdminService.createSpecialist).toHaveBeenCalled();
      expect(mockOnSuccess).toHaveBeenCalled();
      expect(mockOnClose).toHaveBeenCalled();
    });
  });
});
</file>

<file path="src/tests/components/Admin/UserRow.test.jsx">
import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import UserRow from '../../../components/Admin/UserRow';
import * as AdminService from '../../../services/AdminService';

vi.mock('../../../services/AdminService');

describe('UserRow.jsx', () => {
  const mockUser = {
    id: 1,
    rut: '12.345.678-9',
    first_names: 'Juan',
    last_names: 'Pérez',
    email: 'juan@test.com',
    role: 'patient',
    status: 'active'
  };

  const mockOnUpdate = vi.fn();

  beforeEach(() => {
    vi.clearAllMocks();
    vi.spyOn(window, 'confirm').mockImplementation(() => true); 
    vi.spyOn(window, 'alert').mockImplementation(() => {});
  });

  afterEach(() => {
    vi.restoreAllMocks();
  });

  it('debe renderizar los datos del usuario correctamente', () => {
    render(
      <table>
        <tbody>
          <UserRow user={mockUser} onUpdate={mockOnUpdate} />
        </tbody>
      </table>
    );

    expect(screen.getByText('12.345.678-9')).toBeInTheDocument();
    expect(screen.getByText('Juan Pérez')).toBeInTheDocument();
    expect(screen.getByText('Paciente')).toBeInTheDocument();
  });

  it('debe intentar eliminar usuario al hacer clic en borrar y confirmar', async () => {
    AdminService.deleteUser.mockResolvedValue({ success: true });

    render(
      <table>
        <tbody>
          <UserRow user={mockUser} onUpdate={mockOnUpdate} />
        </tbody>
      </table>
    );

    const deleteBtn = screen.getByTitle('Eliminar permanentemente');
    fireEvent.click(deleteBtn);

    expect(window.confirm).toHaveBeenCalled();
    
    await waitFor(() => {
        expect(AdminService.deleteUser).toHaveBeenCalledWith(1);
        expect(mockOnUpdate).toHaveBeenCalled();
    });
  });

  it('debe mostrar alerta de borrado solicitado si el status es delete_requested', () => {
    const deletingUser = { ...mockUser, status: 'delete_requested', delete_requested_at: '2023-01-01' };

    render(
      <table>
        <tbody>
          <UserRow user={deletingUser} onUpdate={mockOnUpdate} />
        </tbody>
      </table>
    );

    expect(screen.getByText(/Solicitó borrar/i)).toBeInTheDocument();
    expect(screen.getByText('Por Borrar')).toBeInTheDocument();
  });
});
</file>

<file path="src/tests/components/Admin/UserTable.test.jsx">
import { describe, it, expect, vi, beforeEach } from 'vitest';
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import UserTable from '../../../components/Admin/UserTable';
import * as AdminService from '../../../services/AdminService';

vi.mock('../../../services/AdminService');

// Aquí hacemos un "mock" del componente UserRow.
// Lo hacemos simple (solo muestra nombre y email) para que en este test
// nos enfoquemos solo en la lógica de la Tabla (filtros, carga, etc)
// y no en los botones o lógica interna de cada fila.
vi.mock('../../../components/Admin/UserRow', () => ({
  default: ({ user }) => (
    <tr data-testid="user-row">
      <td>{user.first_names}</td>
      <td>{user.email}</td>
    </tr>
  )
}));

describe('UserTable.jsx', () => {
  const mockUsers = [
    { id: 1, first_names: 'Ana', role: 'admin', status: 'active' },
    { id: 2, first_names: 'Beto', role: 'patient', status: 'active' },
    { id: 3, first_names: 'Carla', role: 'patient', status: 'delete_requested' }
  ];

  beforeEach(() => {
    vi.clearAllMocks();
  });

  it('debe mostrar mensaje de carga y luego la lista de usuarios', async () => {
    // Simulamos que el servicio responde bien con los datos de prueba
    AdminService.getUsers.mockResolvedValue(mockUsers);

    render(<UserTable />);

    expect(screen.getByText(/Cargando usuarios/i)).toBeInTheDocument();

    // Esperamos a que el componente termine de cargar y muestre las 3 filas
    await waitFor(() => {
      const rows = screen.getAllByTestId('user-row');
      expect(rows).toHaveLength(3);
    });
  });

  it('debe filtrar usuarios por búsqueda', async () => {
    AdminService.getUsers.mockResolvedValue(mockUsers);
    render(<UserTable />);

    await waitFor(() => screen.getAllByTestId('user-row'));

    // Escribimos "Ana" en el input del buscador
    const searchInput = screen.getByPlaceholderText(/Buscar por nombre/i);
    fireEvent.change(searchInput, { target: { value: 'Ana' } });

    // Verificamos que solo quede 1 fila visible (la de Ana)
    expect(screen.getAllByTestId('user-row')).toHaveLength(1);
    expect(screen.getByText('Ana')).toBeInTheDocument();
    
    // Y nos aseguramos que "Beto" haya desaparecido de la pantalla
    expect(screen.queryByText('Beto')).not.toBeInTheDocument();
  });

  it('debe filtrar solo solicitudes de borrado al hacer clic en el botón de alerta', async () => {
    AdminService.getUsers.mockResolvedValue(mockUsers);
    render(<UserTable />);

    await waitFor(() => screen.getAllByTestId('user-row'));

    // Hacemos clic en el botón para ver solo los que pidieron borrado
    const filterBtn = screen.getByText(/Ver Solicitudes de Borrado/i);
    fireEvent.click(filterBtn);

    const rows = screen.getAllByTestId('user-row');
    // Solo Carla tiene el estado 'delete_requested', así que debería quedar sola ella
    expect(rows).toHaveLength(1); 
    expect(screen.getByText('Carla')).toBeInTheDocument();
  });
});
</file>

<file path="src/tests/components/Chat/ChatWidget.test.jsx">
import { describe, it, expect, vi, beforeEach } from 'vitest';
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import axios from 'axios';
import ChatWidget from '../../../components/Chat/ChatWidget';

vi.mock('axios');

describe('ChatWidget.jsx', () => {
  const userId = 'user-123';

  beforeEach(() => {
    vi.clearAllMocks();
    // Los tests corren en una terminal, no en un navegador real.
    // La terminal no tiene barra de desplazamiento (scroll), así que "fingimos" esta función
    // para que el chat no se rompa cuando intente bajar automáticamente al último mensaje.
    window.HTMLElement.prototype.scrollIntoView = vi.fn();
  });

  it('no debe renderizar nada si no hay userId', () => {
    const { container } = render(<ChatWidget userId={null} />);
    expect(container).toBeEmptyDOMElement();
  });

  it('debe estar cerrado inicialmente y abrirse al hacer click', () => {
    render(<ChatWidget userId={userId} />);
    
    const toggleBtn = screen.getByLabelText('Abrir Asistente Médico Virtual');
    expect(toggleBtn).toBeInTheDocument();
    
    fireEvent.click(toggleBtn);
    
    expect(screen.getByText('Dr. Chapatín')).toBeInTheDocument();
    expect(screen.getByText(/Hola. Soy el Dr. Chapatín/i)).toBeInTheDocument();
  });

  it('debe enviar un mensaje y mostrar la respuesta del bot', async () => {
    // Simulamos que el "backend" nos responde bien
    axios.post.mockResolvedValue({ data: { response: 'Tómese un paracetamol.' } });

    render(<ChatWidget userId={userId} />);
    
    fireEvent.click(screen.getByLabelText('Abrir Asistente Médico Virtual'));

    const input = screen.getByPlaceholderText('Describe tus síntomas...');
    fireEvent.change(input, { target: { value: 'Me duele la cabeza' } });

    // Buscamos el formulario más cercano al input y lo enviamos.
    // Es más seguro que buscar el botón porque simula el "Enter" del teclado también.
    fireEvent.submit(input.closest('form')); 

    // Verificamos que MI mensaje apareció
    expect(screen.getByText('Me duele la cabeza')).toBeInTheDocument();

    // Verificamos que salió el loader de carga
    expect(screen.getByText(/Analizando.../i)).toBeInTheDocument();

    // Usamos waitFor porque la respuesta de la IA no llega al tiro.
    // Le decimos al test: "Espera un cachito hasta que aparezca este texto".
    await waitFor(() => {
      expect(screen.getByText('Tómese un paracetamol.')).toBeInTheDocument();
    });

    expect(axios.post).toHaveBeenCalledWith(
      expect.stringContaining('/api/ai/send'),
      { userId, message: 'Me duele la cabeza' },
      expect.anything()
    );
  });

  it('debe manejar errores de la API', async () => {
    // Simulamos que el backend se cayó o dio error
    axios.post.mockRejectedValue(new Error('Error de red'));

    render(<ChatWidget userId={userId} />);
    fireEvent.click(screen.getByLabelText('Abrir Asistente Médico Virtual'));

    const input = screen.getByPlaceholderText('Describe tus síntomas...');
    fireEvent.change(input, { target: { value: 'Hola' } });
    fireEvent.submit(input.closest('form'));

    // Esperamos a que el chat se de cuenta del error y muestre el mensaje de fallo
    await waitFor(() => {
      expect(screen.getByText(/tengo dificultades técnicas/i)).toBeInTheDocument();
    });
  });
});
</file>

<file path="src/tests/components/Dashboard/GlucoseCard.test.jsx">
import { render, screen } from "@testing-library/react";
import { describe, it, expect, vi } from "vitest";
import GlucoseCard from "../../../components/Dashboard/GlucoseCard";

vi.mock("../../../utils/formatDate", () => ({
  formatDateLong: () => "01 de enero de 2026",
}));

vi.mock("react-icons/fa", () => ({
  FaTint: () => <span data-testid="fa-tint-icon" />,
}));

describe("GlucoseCard", () => {
  it("muestra estado Normal cuando la glucosa es menor a 141", () => {
    render(<GlucoseCard glucose={120} date={new Date()} />);

    expect(screen.getByText("Glucosa")).toBeInTheDocument();
    expect(screen.getByText("120 mg/dL")).toBeInTheDocument();
    expect(screen.getByText("Normal")).toBeInTheDocument();

    expect(screen.getByText("01 de enero de 2026")).toBeInTheDocument();
  });

  it("muestra estado Alerta cuando la glucosa es entre 141 y 199", () => {
    render(<GlucoseCard glucose={150} date={new Date()} />);

    expect(screen.getByText("150 mg/dL")).toBeInTheDocument();
    expect(screen.getByText("Alerta")).toBeInTheDocument();
  });

  it("muestra estado Peligro cuando la glucosa es mayor o igual a 200", () => {
    render(<GlucoseCard glucose={220} date={new Date()} />);

    expect(screen.getByText("220 mg/dL")).toBeInTheDocument();
    expect(screen.getByText("Peligro")).toBeInTheDocument();
  });
});
</file>

<file path="src/tests/components/Dashboard/HealthRegisterForm.test.jsx">
import { describe, it, expect, vi, beforeEach } from "vitest";
import { render, screen, fireEvent, waitFor } from "@testing-library/react";
import HealthRegisterForm from "../../../components/Dashboard/HealthRegisterForm";
import axios from "axios";

vi.mock("axios");

describe("HealthRegisterForm", () => {
  beforeEach(() => {
    // Seteamos un usuario falso en localStorage para que la petición incluya el token
    localStorage.setItem("user_id", "1");
    localStorage.setItem("token", "fake-token");
    
    // Evitamos que el window.alert rompa el test ya que no hay ventana real
    vi.spyOn(window, "alert").mockImplementation(() => {});
    vi.clearAllMocks();
  });

  it("renderiza los inputs y el botón", () => {
    render(<HealthRegisterForm />);

    expect(screen.getByPlaceholderText("Ej: 120")).toBeInTheDocument();
    expect(screen.getByPlaceholderText("Sistólica (Ej: 120)")).toBeInTheDocument();
    expect(screen.getByPlaceholderText("Diastólica (Ej: 80)")).toBeInTheDocument();
    expect(screen.getByText("Guardar Registro")).toBeInTheDocument();
  });

  it("muestra alerta si los valores son menores o iguales a 0", async () => {
    render(<HealthRegisterForm />);

    // Probamos con valores inválidos (ceros)
    fireEvent.change(screen.getByPlaceholderText("Ej: 120"), { target: { value: "0" } });
    fireEvent.change(screen.getByPlaceholderText("Sistólica (Ej: 120)"), { target: { value: "120" } });
    fireEvent.change(screen.getByPlaceholderText("Diastólica (Ej: 80)"), { target: { value: "80" } });

    fireEvent.submit(screen.getByRole("button", { name: /guardar registro/i }));

    // Verificamos que salte la alerta y no se llame al backend
    await waitFor(() => {
      expect(window.alert).toHaveBeenCalledWith("Los valores de salud deben ser mayores a 0");
    });

    expect(axios.post).not.toHaveBeenCalled();
  });

  it("envía los datos correctamente y limpia el formulario", async () => {
    axios.post.mockResolvedValueOnce({ data: {} });

    render(<HealthRegisterForm />);

    fireEvent.change(screen.getByPlaceholderText("Ej: 120"), { target: { value: "110" } });
    fireEvent.change(screen.getByPlaceholderText("Sistólica (Ej: 120)"), { target: { value: "120" } });
    fireEvent.change(screen.getByPlaceholderText("Diastólica (Ej: 80)"), { target: { value: "80" } });

    fireEvent.click(screen.getByText("Guardar Registro"));

    await waitFor(() => {
      expect(axios.post).toHaveBeenCalledTimes(1);
    });

    // Validamos que se envíe el payload correcto y el token en los headers
    expect(axios.post).toHaveBeenCalledWith(
      expect.stringContaining("/api/registros"),
      {
        patientId: "1",
        glucosa: 110,
        sistolica: 120,
        diastolica: 80,
      },
      expect.objectContaining({
        headers: expect.objectContaining({
          Authorization: "Bearer fake-token",
        }),
      })
    );

    expect(window.alert).toHaveBeenCalledWith("Registro guardado correctamente");

    // Revisamos que los inputs se limpien después de guardar
    expect(screen.getByPlaceholderText("Ej: 120").value).toBe("");
    expect(screen.getByPlaceholderText("Sistólica (Ej: 120)").value).toBe("");
    expect(screen.getByPlaceholderText("Diastólica (Ej: 80)").value).toBe("");
  });

  it("muestra alerta si ocurre un error al guardar", async () => {
    // Simulamos fallo del backend
    axios.post.mockRejectedValueOnce(new Error("Error backend"));

    render(<HealthRegisterForm />);

    fireEvent.change(screen.getByPlaceholderText("Ej: 120"), { target: { value: "100" } });
    fireEvent.change(screen.getByPlaceholderText("Sistólica (Ej: 120)"), { target: { value: "120" } });
    fireEvent.change(screen.getByPlaceholderText("Diastólica (Ej: 80)"), { target: { value: "80" } });

    fireEvent.click(screen.getByText("Guardar Registro"));

    await waitFor(() => {
      expect(window.alert).toHaveBeenCalledWith("Error al guardar registro");
    });
  });
});
</file>

<file path="src/tests/components/Dashboard/PressureCard.test.jsx">
import { render, screen } from "@testing-library/react";
import { describe, it, expect, vi } from "vitest";
import PressureCard from "../../../components/Dashboard/PressureCard";

vi.mock("../../../utils/formatDate", () => ({
  formatDateLong: vi.fn(() => "1 de enero de 2024"),
}));

vi.mock("react-icons/fa", () => ({
  FaHeartbeat: () => <span data-testid="heart-icon" />,
}));

describe("PressureCard", () => {
  it("renderiza presión normal correctamente", () => {
    render(
      <PressureCard
        systolic={120}
        diastolic={80}
        date={new Date()}
      />
    );

    expect(screen.getByText("Presión Arterial")).toBeInTheDocument();
    expect(screen.getByText("120/80 mmHg")).toBeInTheDocument();
    expect(screen.getByText("Normal")).toBeInTheDocument();
    expect(screen.getByText("1 de enero de 2024")).toBeInTheDocument();
  });

  it("muestra alerta cuando la presión es elevada", () => {
    render(
      <PressureCard
        systolic={135}
        diastolic={88}
        date={new Date()}
      />
    );

    expect(screen.getByText("Alerta")).toBeInTheDocument();
  });

  it("muestra peligro cuando la presión es alta", () => {
    render(
      <PressureCard
        systolic={150}
        diastolic={95}
        date={new Date()}
      />
    );

    expect(screen.getByText("Peligro")).toBeInTheDocument();
  });
});
</file>

<file path="src/tests/components/Guards/AdminGuard.test.jsx">
import { describe, it, expect, vi, beforeEach } from 'vitest';
import { render, screen } from '@testing-library/react';
import AdminGuard from '../../../components/Guards/AdminGuard'; 

// Hacemos un componente falso de Navigate para ver a dónde nos redirige
vi.mock('react-router-dom', () => ({
  Navigate: ({ to }) => <div>Redirigido a {to}</div>
}));

describe('AdminGuard.jsx', () => {
  beforeEach(() => {
    // Limpiamos el almacenamiento antes de cada test para que no se mezclen los datos
    localStorage.clear();
  });

  it('te manda al login si no tienes token', () => {
    render(
      <AdminGuard>
        <div>Panel Secreto</div>
      </AdminGuard>
    );
    // Como no pusimos token en localStorage, debe echarnos
    expect(screen.getByText('Redirigido a /login')).toBeInTheDocument();
  });

  it('te manda al dashboard si eres paciente', () => {
    // Preparamos el escenario: usuario logueado pero es paciente
    localStorage.setItem('token', 'token-falso');
    localStorage.setItem('user_role', 'patient');

    render(
      <AdminGuard>
        <div>Panel Secreto</div>
      </AdminGuard>
    );

    expect(screen.getByText('Redirigido a /dashboard')).toBeInTheDocument();
  });

  it('te manda al panel médico si eres especialista', () => {
    // Escenario: usuario es doctor
    localStorage.setItem('token', 'token-falso');
    localStorage.setItem('user_role', 'specialist');

    render(
      <AdminGuard>
        <div>Panel Secreto</div>
      </AdminGuard>
    );

    expect(screen.getByText('Redirigido a /panel-medico')).toBeInTheDocument();
  });

  it('te deja pasar si eres Admin de verdad', () => {
    // Escenario: usuario es el jefe (admin)
    localStorage.setItem('token', 'token-falso');
    localStorage.setItem('user_role', 'admin');

    render(
      <AdminGuard>
        <div>Panel Secreto</div>
      </AdminGuard>
    );

    // Aquí sí debería mostrar el contenido protegido
    expect(screen.getByText('Panel Secreto')).toBeInTheDocument();
  });
});
</file>

<file path="src/tests/components/Guards/PatientGuard.test.jsx">
import { describe, it, expect, vi, beforeEach } from 'vitest';
import { render, screen } from '@testing-library/react';

import PatientGuard from '../../../components/Guards/PatientGuard';

vi.mock('react-router-dom', () => ({
  Navigate: ({ to }) => <div>Redirigido a {to}</div>
}));

describe('PatientGuard.jsx', () => {
  beforeEach(() => {
    localStorage.clear();
  });

  it('debe redirigir al login si no hay token', () => {
    render(
      <PatientGuard>
        <div>Contenido Secreto</div>
      </PatientGuard>
    );

    expect(screen.queryByText('Contenido Secreto')).not.toBeInTheDocument();
    expect(screen.getByText('Redirigido a /login')).toBeInTheDocument();
  });

  it('debe renderizar el contenido (children) si hay token', () => {
    localStorage.setItem('token', 'fake-token-123');

    render(
      <PatientGuard>
        <div>Contenido Secreto</div>
      </PatientGuard>
    );

    expect(screen.getByText('Contenido Secreto')).toBeInTheDocument();
    expect(screen.queryByText(/Redirigido/)).not.toBeInTheDocument();
  });
});
</file>

<file path="src/tests/components/Guards/SpecialistGuard.test.jsx">
import { describe, it, expect, vi, beforeEach } from 'vitest';
import { render, screen } from '@testing-library/react';
import SpecialistGuard from '../../../components/Guards/SpecialistGuard';

vi.mock('react-router-dom', () => ({
  Navigate: ({ to }) => <div>Redirigido a {to}</div>
}));

describe('SpecialistGuard.jsx', () => {
  beforeEach(() => {
    localStorage.clear();
  });

  it('debe redirigir al Login si no hay token', () => {
    render(
      <SpecialistGuard>
        <div>Zona Especialista</div>
      </SpecialistGuard>
    );
    expect(screen.getByText('Redirigido a /login')).toBeInTheDocument();
  });

  it('debe sacar al paciente y mandarlo a su dashboard', () => {
    localStorage.setItem('token', 'valid-token');
    localStorage.setItem('user_role', 'patient');

    render(
      <SpecialistGuard>
        <div>Zona Especialista</div>
      </SpecialistGuard>
    );
    expect(screen.getByText('Redirigido a /dashboard')).toBeInTheDocument();
  });

  it('debe dejar entrar al especialista', () => {
    localStorage.setItem('token', 'valid-token');
    localStorage.setItem('user_role', 'specialist');

    render(
      <SpecialistGuard>
        <div>Zona Especialista</div>
      </SpecialistGuard>
    );
    // Aquí validamos que SÍ se muestre el contenido hijo
    expect(screen.getByText('Zona Especialista')).toBeInTheDocument();
  });

  it('debe redirigir al Admin a su propia zona', () => {
    localStorage.setItem('token', 'valid-token');
    localStorage.setItem('user_role', 'admin');

    render(
      <SpecialistGuard>
        <div>Zona Especialista</div>
      </SpecialistGuard>
    );
    
    // El código original manda al admin a "/admin", no lo deja entrar aquí.
    // Así que el test debe esperar esa redirección.
    expect(screen.getByText('Redirigido a /admin')).toBeInTheDocument();
  });
});
</file>

<file path="src/tests/components/Landing/DrChapatinSection.test.jsx">
import { describe, it, expect } from 'vitest';
import { render, screen } from '@testing-library/react';
import DrChapatinSection from '../../../components/Landing/DrChapatinSection';

describe('DrChapatinSection.jsx', () => {
  it('debe renderizar el título principal y las badges', () => {
    render(<DrChapatinSection />);
    
    expect(screen.getByText(/No es broma:/i)).toBeInTheDocument();
    expect(screen.getByText(/Ciencia real detrás del personaje/i)).toBeInTheDocument();
    
    expect(screen.getByText('IA Médica Avanzada')).toBeInTheDocument();
    expect(screen.getByText('Modo: Dr. Chapatín')).toBeInTheDocument();
  });

  it('debe mostrar los 3 pilares de confianza (Grid)', () => {
    render(<DrChapatinSection />);
    
    expect(screen.getByText('Protocolos Clínicos')).toBeInTheDocument();
    expect(screen.getByText('Entrenamiento')).toBeInTheDocument();
    expect(screen.getByText('Seguridad')).toBeInTheDocument();
  });

  it('debe mostrar el disclaimer médico legal (CRÍTICO)', () => {
    render(<DrChapatinSection />);
    
    expect(screen.getByText(/no reemplaza una consulta médica presencial/i)).toBeInTheDocument();
  });

  it('debe renderizar la imagen del doctor y la tarjeta flotante', () => {
    render(<DrChapatinSection />);
    
    const image = screen.getByAltText('Dr Chapatín IA');
    expect(image).toBeInTheDocument();
    expect(image).toHaveClass('chapatin-img');

    expect(screen.getByText('Precisión Analítica')).toBeInTheDocument();
    expect(screen.getByText(/98% en detección/i)).toBeInTheDocument();
  });
});
</file>

<file path="src/tests/components/Landing/HowToUseSection.test.jsx">
import { describe, it, expect } from 'vitest';
import { render, screen } from '@testing-library/react';
import HowToUseSection from '../../../components/Landing/HowToUseSection';

describe('HowToUseSection.jsx', () => {
  it('debe renderizar el encabezado de la guía', () => {
    render(<HowToUseSection />);
    
    expect(screen.getByText('Guía Rápida')).toBeInTheDocument();
    expect(screen.getByText('Toma el control en 3 pasos')).toBeInTheDocument();
  });

  it('debe mostrar los 3 pasos del proceso correctamente', () => {
    render(<HowToUseSection />);
    
    expect(screen.getByText('Entra al Registro')).toBeInTheDocument();
    expect(screen.getByText('Ingresa tus Datos')).toBeInTheDocument();
    expect(screen.getByText('Recibe tu Análisis')).toBeInTheDocument();

    expect(screen.getByText('1')).toBeInTheDocument();
    expect(screen.getByText('2')).toBeInTheDocument();
    expect(screen.getByText('3')).toBeInTheDocument();
  });

  it('debe contener las instrucciones detalladas', () => {
    render(<HowToUseSection />);
    
    expect(screen.getByText(/busca la tarjeta que dice/i)).toBeInTheDocument();
    expect(screen.getByText(/El formulario es inteligente/i)).toBeInTheDocument();
    expect(screen.getByText(/te dirá al instante si estás/i)).toBeInTheDocument();
  });
});
</file>

<file path="src/tests/components/Loader.test.jsx">
import { describe, it, expect } from 'vitest';
import { render, screen } from '@testing-library/react';
import Loader from '../../components/Loader';

describe('Loader.jsx', () => {
  it('debe mostrar el mensaje por defecto', () => {
    render(<Loader />);
    expect(screen.getByText('Cargando sistema...')).toBeInTheDocument();
  });

  it('debe mostrar un mensaje personalizado', () => {
    render(<Loader message="Procesando datos..." />);
    expect(screen.getByText('Procesando datos...')).toBeInTheDocument();
  });
});
</file>

<file path="src/tests/components/Navbar.test.jsx">
import { describe, it, expect, vi, beforeEach } from 'vitest';
import { render, screen, fireEvent } from '@testing-library/react';
import { BrowserRouter } from 'react-router-dom';
import Navbar from '../../components/Navbar';

const mockNavigate = vi.fn();

vi.mock('react-router-dom', async () => {
  const actual = await vi.importActual('react-router-dom');
  return {
    ...actual,
    useNavigate: () => mockNavigate,
  };
});

vi.mock('../../components/SosButton', () => ({
  default: () => <button data-testid="sos-btn-mock">SOS</button>
}));

describe('Navbar.jsx', () => {
  beforeEach(() => {
    vi.clearAllMocks();
    localStorage.clear();
  });

  it('debe renderizar enlaces públicos si no hay token (Visitante)', () => {
    render(
      <BrowserRouter>
        <Navbar isUserAdmin={false} userRole={null} />
      </BrowserRouter>
    );

    expect(screen.getByText('Iniciar Sesión')).toBeInTheDocument();
    expect(screen.getByText('Registrarse')).toBeInTheDocument();
    expect(screen.queryByText('Mi Panel')).not.toBeInTheDocument();
  });

  it('debe renderizar menú de Especialista si el rol es specialist', () => {
    localStorage.setItem('token', 'fake-token');
    localStorage.setItem('user_name', 'Dr. Strange');
    
    render(
      <BrowserRouter>
        <Navbar isUserAdmin={false} userRole="specialist" />
      </BrowserRouter>
    );

    expect(screen.getByText('Dr. Strange')).toBeInTheDocument();
    expect(screen.getByText('Profesional')).toBeInTheDocument();
    expect(screen.getByText('Salir')).toBeInTheDocument(); 
  });

  it('debe renderizar menú de Paciente Logueado', () => {
    localStorage.setItem('token', 'fake-token');
    
    render(
      <BrowserRouter>
        <Navbar isUserAdmin={false} userRole="patient" />
      </BrowserRouter>
    );

    expect(screen.getByText('Mi Panel')).toBeInTheDocument();
    expect(screen.getByText('Cerrar Sesión')).toBeInTheDocument();
    expect(screen.getAllByTestId('sos-btn-mock').length).toBeGreaterThan(0);
  });

  it('debe renderizar enlace Admin si es administrador', () => {
    localStorage.setItem('token', 'fake-token');

    render(
      <BrowserRouter>
        <Navbar isUserAdmin={true} userRole="admin" />
      </BrowserRouter>
    );

    expect(screen.getByText('Panel Admin')).toBeInTheDocument();
  });

  it('debe cerrar sesión correctamente y redirigir', () => {
    localStorage.setItem('token', 'fake-token');
    
    render(
      <BrowserRouter>
        <Navbar isUserAdmin={false} userRole="patient" />
      </BrowserRouter>
    );

    const logoutBtn = screen.getByText('Cerrar Sesión');
    fireEvent.click(logoutBtn);

    expect(localStorage.getItem('token')).toBeNull(); 
    expect(mockNavigate).toHaveBeenCalledWith('/login');
  });

  it('debe abrir y cerrar el menú móvil', () => {
    const { container } = render(
      <BrowserRouter>
        <Navbar isUserAdmin={false} userRole={null} />
      </BrowserRouter>
    );

    const hamburger = container.querySelector('.hamburger');
    const navCollapse = container.querySelector('.nav-collapse');

    fireEvent.click(hamburger);
    expect(navCollapse).toHaveClass('active');

    fireEvent.click(hamburger);
    expect(navCollapse).not.toHaveClass('active');
  });
});
</file>

<file path="src/tests/components/SosButton.test.jsx">
import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import axios from 'axios';
import SosButton from '../../components/SosButton';

vi.mock('axios');

describe('SosButton.jsx', () => {
  beforeEach(() => {
    vi.clearAllMocks();
    localStorage.setItem('user_id', '123');
    localStorage.setItem('token', 'token-123');
    
    // Mock para el portapapeles y window.open
    Object.assign(navigator, {
      clipboard: {
        writeText: vi.fn(),
      },
    });
    vi.spyOn(window, 'open').mockImplementation(() => {});
    
    // Espiamos el console.warn para verificar avisos
    vi.spyOn(console, 'warn').mockImplementation(() => {});
  });

  afterEach(() => {
    vi.restoreAllMocks();
    localStorage.clear();
  });

  it('debe lanzar un warning en consola si no hay usuario logueado', () => {
    localStorage.removeItem('user_id'); 
    render(<SosButton />);
    
    fireEvent.click(screen.getByLabelText('Emergencia SOS'));
    
    expect(console.warn).toHaveBeenCalledWith(expect.stringContaining('Usuario no autenticado'));
  });

  it('debe llamar a la API y abrir modal con teléfono si hay éxito', async () => {
    axios.get.mockResolvedValue({
      data: { success: true, phone: '+56912345678' }
    });

    render(<SosButton />);
    
    const btn = screen.getByLabelText('Emergencia SOS');
    fireEvent.click(btn);

    await waitFor(() => {
      expect(screen.getByText('Ayuda de Emergencia')).toBeInTheDocument();
      expect(screen.getByText('+56912345678')).toBeInTheDocument();
    });
  });

  it('debe copiar el número al portapapeles', async () => {
    axios.get.mockResolvedValue({
      data: { success: true, phone: '+56912345678' }
    });

    render(<SosButton />);
    fireEvent.click(screen.getByLabelText('Emergencia SOS'));

    await waitFor(() => screen.getByText('+56912345678'));

    fireEvent.click(screen.getByTitle('Haz clic para copiar'));

    expect(navigator.clipboard.writeText).toHaveBeenCalledWith('+56912345678');
    expect(screen.getByText('Copiado')).toBeInTheDocument();
  });

  it('debe intentar abrir WhatsApp con el número correcto', async () => {
    axios.get.mockResolvedValue({
      data: { success: true, phone: '+56912345678' }
    });

    render(<SosButton />);
    fireEvent.click(screen.getByLabelText('Emergencia SOS'));
    await waitFor(() => screen.getByText('Enviar WhatsApp'));

    fireEvent.click(screen.getByText('Enviar WhatsApp'));
    
    expect(window.open).toHaveBeenCalledWith(
      expect.stringContaining('https://wa.me/56912345678'), 
      '_blank'
    );
  });
});
</file>

<file path="src/tests/pages/ContactPage.test.jsx">
import { describe, it, expect, vi, beforeEach } from 'vitest';
import { render, screen, fireEvent } from '@testing-library/react';
import ContactPage from '../../pages/ContactPage';

describe('ContactPage', () => {
  
  beforeEach(() => {
    vi.clearAllMocks();
    vi.spyOn(window, 'alert').mockImplementation(() => {});
  });

  it('renderiza correctamente las secciones principales', () => {
    render(<ContactPage />);
    expect(screen.getByText(/Centro de Ayuda/i)).toBeInTheDocument();
    expect(screen.getByText(/Reportar un Problema/i)).toBeInTheDocument();
    expect(screen.getByText(/Gestión de Cuenta/i)).toBeInTheDocument();
    expect(screen.getByText(/Preguntas Frecuentes/i)).toBeInTheDocument();
  });

  it('abre y cierra las preguntas frecuentes (FAQ) al hacer click', () => {
    render(<ContactPage />);

    const questionButton = screen.getByRole('button', { 
        name: /¿Cómo registro mi presión arterial o glucosa\?/i 
    });
    
    const answerDiv = screen.getByText(/Ve a tu 'Mi Panel' y busca la tarjeta/i);

    // Verificamos el flujo: Cerrado -> Abierto -> Cerrado
    expect(answerDiv).not.toHaveClass('open');

    fireEvent.click(questionButton);
    expect(answerDiv).toHaveClass('open');

    fireEvent.click(questionButton);
    expect(answerDiv).not.toHaveClass('open');
  });

  it('envía el formulario de reporte y muestra una alerta', () => {
    render(<ContactPage />);

    fireEvent.change(screen.getByPlaceholderText(/Ej: Error al guardar datos/i), {
      target: { value: 'Error en el login' }
    });
    
    fireEvent.change(screen.getByPlaceholderText(/Describe el problema.../i), {
      target: { value: 'No puedo entrar a mi cuenta.' }
    });

    const submitBtn = screen.getByRole('button', { name: /Enviar Reporte/i });
    fireEvent.click(submitBtn);

    expect(window.alert).toHaveBeenCalledWith('¡Gracias! Mensaje enviado al equipo técnico.');
  });
});
</file>

<file path="src/tests/pages/HealthRegisterPage.test.jsx">
import { describe, it, expect, vi } from 'vitest';
import { render, screen } from '@testing-library/react';
import HealthRegisterPage from '../../pages/HealthRegisterPage';

// Mockeamos el formulario para probar solo la página contenedora
vi.mock('../../components/Dashboard/HealthRegisterForm', () => ({
  default: () => <div data-testid="health-form-mock">HealthRegisterForm Mock</div>,
}));

describe('HealthRegisterPage', () => {
  
  it('renderiza el título, la descripción y el formulario', () => {
    render(<HealthRegisterPage />);

    expect(screen.getByText(/Registrar Información de Salud/i)).toBeInTheDocument();
    
    expect(screen.getByText(/Ingresa tus valores de glucosa y presión arterial/i)).toBeInTheDocument();

    expect(screen.getByTestId('health-form-mock')).toBeInTheDocument();
  });
});
</file>

<file path="src/tests/services/AdminService.test.js">
import { describe, it, expect, vi, beforeEach } from 'vitest';
import axios from 'axios';
import * as AdminService from '../../services/AdminService';

vi.mock('axios');

describe('AdminService', () => {
    beforeEach(() => {
        vi.clearAllMocks();
        localStorage.setItem('token', 'fake-token');
    });

    // --- GET STATS ---
    it('getStats debe retornar datos cuando la respuesta es exitosa', async () => {
        const mockData = { users: 10, specialists: 5 };
        axios.get.mockResolvedValue({ data: mockData });

        const result = await AdminService.getStats();

        expect(result).toEqual(mockData);
        expect(axios.get).toHaveBeenCalledWith(
            expect.stringContaining('/stats'),
            expect.objectContaining({ headers: expect.anything() })
        );
    });

    it('getStats debe retornar null si hay error', async () => {
        axios.get.mockRejectedValue(new Error('Network Error'));
        const result = await AdminService.getStats();
        expect(result).toBeNull();
    });

    // --- GET USERS ---
    it('getUsers debe retornar lista de usuarios', async () => {
        const mockUsers = [{ id: 1, name: 'Pepe' }];
        axios.get.mockResolvedValue({ data: mockUsers });

        const result = await AdminService.getUsers();
        expect(result).toEqual(mockUsers);
    });

    it('getUsers debe retornar array vacío si falla', async () => {
        axios.get.mockRejectedValue(new Error('Fail'));
        const result = await AdminService.getUsers();
        expect(result).toEqual([]);
    });

    // --- CREATE SPECIALIST ---
    it('createSpecialist debe retornar success: true si funciona', async () => {
        axios.post.mockResolvedValue({ data: {} });
        const userData = { email: 'doc@test.com' };

        const result = await AdminService.createSpecialist(userData);

        expect(result).toEqual({ success: true });
        expect(axios.post).toHaveBeenCalledWith(
            expect.stringContaining('/create-specialist'),
            userData,
            expect.anything()
        );
    });

    it('createSpecialist debe retornar el mensaje de error si falla', async () => {
        const errorMessage = 'Email duplicado';
        axios.post.mockRejectedValue({ 
            response: { data: { error: errorMessage } } 
        });

        const result = await AdminService.createSpecialist({});
        expect(result).toEqual({ success: false, error: errorMessage });
    });

    // --- DELETE USER ---
    it('deleteUser debe eliminar usuario correctamente', async () => {
        axios.delete.mockResolvedValue({ data: {} });
        const result = await AdminService.deleteUser(123);
        expect(result).toEqual({ success: true });
        expect(axios.delete).toHaveBeenCalledWith(expect.stringContaining('/users/123'), expect.anything());
    });

    // --- VERIFY ADMIN ---
    it('verifyAdminStatus debe retornar true si es admin', async () => {
        axios.post.mockResolvedValue({ data: { isAdmin: true } });
        const result = await AdminService.verifyAdminStatus('admin@test.com');
        expect(result).toBe(true);
    });

    it('verifyAdminStatus debe retornar false si falla', async () => {
        axios.post.mockRejectedValue(new Error('Not admin'));
        const result = await AdminService.verifyAdminStatus('user@test.com');
        expect(result).toBe(false);
    });

    // --- REQUEST DELETION ---
    it('requestAccountDeletion debe enviar la solicitud correctamente', async () => {
        axios.patch.mockResolvedValue({ data: {} });
        const result = await AdminService.requestAccountDeletion(999);
        expect(result).toEqual({ success: true });
        expect(axios.patch).toHaveBeenCalledWith(expect.stringContaining('/users/request-deletion/999'), {}, expect.anything());
    });
});
</file>

<file path="src/tests/services/AuthService.test.js">
import { describe, it, expect, vi, beforeEach } from 'vitest';
import axios from 'axios';
import * as AuthService from '../../services/AuthService';

vi.mock('axios');

describe('AuthService', () => {
    beforeEach(() => {
        vi.clearAllMocks();
        localStorage.clear();
        vi.spyOn(console, 'error').mockImplementation(() => {});
    });

    describe('isAdmin', () => {
        it('debe retornar false si no hay email o token', async () => {
            const result = await AuthService.isAdmin();
            expect(result).toBe(false);
            expect(axios.post).not.toHaveBeenCalled();
        });

        it('debe retornar true si la API confirma que es admin', async () => {
            localStorage.setItem('user_email', 'admin@test.com');
            localStorage.setItem('token', 'valid-token');
            
            axios.post.mockResolvedValue({ data: { isAdmin: true } });

            const result = await AuthService.isAdmin();
            expect(result).toBe(true);
            expect(axios.post).toHaveBeenCalledWith(
                expect.stringContaining('/verify-admin'),
                { email: 'admin@test.com' },
                expect.objectContaining({
                    headers: expect.objectContaining({
                        'Authorization': 'Bearer valid-token'
                    })
                })
            );
        });

        it('debe retornar false si ocurre un error en la petición', async () => {
            localStorage.setItem('user_email', 'user@test.com');
            localStorage.setItem('token', 'valid-token');
            axios.post.mockRejectedValue(new Error('Error'));

            const result = await AuthService.isAdmin();
            expect(result).toBe(false);
        });
    });

    describe('getUserProfile', () => {
        it('debe retornar los datos del usuario si la petición es exitosa', async () => {
            const mockUser = { id: 123, role: 'specialist' };
            axios.get.mockResolvedValue({ data: mockUser });

            const result = await AuthService.getUserProfile(123, 'token-123');
            
            expect(result).toEqual(mockUser);
            expect(axios.get).toHaveBeenCalledWith(
                expect.stringContaining('/users/123'),
                expect.objectContaining({
                    headers: expect.objectContaining({
                        'Authorization': 'Bearer token-123'
                    })
                })
            );
        });

        it('debe retornar null si la petición falla', async () => {
            axios.get.mockRejectedValue(new Error('User not found'));
            const result = await AuthService.getUserProfile(999, 'token-fail');
            
            expect(result).toBeNull();
            expect(console.error).toHaveBeenCalled();
        });
    });

    describe('requestPublicPasswordReset', () => {
        it('debe retornar éxito al solicitar reset', async () => {
            axios.post.mockResolvedValue({});
            const result = await AuthService.requestPublicPasswordReset('test@mail.com');
            expect(result).toEqual({ success: true });
        });

        it('debe retornar error con mensaje si falla', async () => {
            const errMsg = 'Email no registrado';
            axios.post.mockRejectedValue({ response: { data: { error: errMsg } } });

            const result = await AuthService.requestPublicPasswordReset('fail@mail.com');
            expect(result).toEqual({ success: false, error: errMsg });
        });
    });
});
</file>

<file path="src/tests/services/downloadService.test.js">
import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';
import axios from 'axios';
import { descargarHistorial } from '../../services/downloadService';

vi.mock('axios');

vi.mock('../../utils/formatDateDownload', () => ({
    formatDateDownload: () => '2026-01-01_12-00'
}));

describe('downloadService', () => {
    // Guardamos las implementaciones originales para restaurarlas después
    const originalCreateObjectURL = global.URL.createObjectURL;
    const originalRevokeObjectURL = global.URL.revokeObjectURL;

    beforeEach(() => {
        vi.clearAllMocks();
        // Simulamos la creación de URLs de blob
        global.URL.createObjectURL = vi.fn(() => 'blob:http://localhost/fake-url');
        global.URL.revokeObjectURL = vi.fn();
    });

    afterEach(() => {
        global.URL.createObjectURL = originalCreateObjectURL;
        global.URL.revokeObjectURL = originalRevokeObjectURL;
    });

    it('debe descargar el archivo correctamente', async () => {
        axios.get.mockResolvedValue({ data: new Blob(['fake content']) });

        // Espiamos el elemento <a> para verificar que se le asignen los atributos
        const linkSpy = { click: vi.fn(), remove: vi.fn(), href: '', download: '' };
        vi.spyOn(document, 'createElement').mockReturnValue(linkSpy);
        vi.spyOn(document.body, 'appendChild').mockImplementation(() => {});

        await descargarHistorial(123, 'pdf');

        // 1. Verificamos la llamada a la API con responseType: blob (CRÍTICO)
        expect(axios.get).toHaveBeenCalledWith(
            expect.stringContaining('/historial/pdf/123'),
            expect.objectContaining({ responseType: 'blob' })
        );
        
        // 2. Verificamos manipulación del DOM
        expect(document.createElement).toHaveBeenCalledWith('a');
        expect(linkSpy.download).toContain('historial_123'); 
        expect(linkSpy.click).toHaveBeenCalled(); 
        
        // 3. Verificamos limpieza de memoria
        expect(global.URL.revokeObjectURL).toHaveBeenCalled(); 
    });

    it('debe manejar errores sin romper la app', async () => {
        const consoleSpy = vi.spyOn(console, 'error').mockImplementation(() => {});
        axios.get.mockRejectedValue(new Error('Download failed'));

        await descargarHistorial(123, 'pdf');

        expect(consoleSpy).toHaveBeenCalledWith("Error descargando historial:", expect.any(Error));
    });
});
</file>

<file path="src/tests/services/MedicalService.test.js">
import { describe, it, expect, vi, beforeEach } from 'vitest';
import axios from 'axios';
import * as MedicalService from '../../services/MedicalService';

vi.mock('axios');

describe('MedicalService', () => {
    beforeEach(() => {
        vi.clearAllMocks();
        localStorage.setItem('token', 'token-test');
        // Silenciamos los console.error/warn para que el output del test salga limpio
        vi.spyOn(console, 'error').mockImplementation(() => {});
        vi.spyOn(console, 'warn').mockImplementation(() => {});
    });

    // --- GET MEDICAL RECORD ---
    it('getMedicalRecord retorna datos si existe', async () => {
        const mockData = { allergies: 'None', blood_type: 'O+' };
        axios.get.mockResolvedValue({ data: mockData });

        const result = await MedicalService.getMedicalRecord(1);
        
        expect(result).toEqual(mockData);
        expect(axios.get).toHaveBeenCalledWith(
            expect.stringContaining('/medical/records/1'),
            expect.objectContaining({ headers: expect.anything() })
        );
    });

    it('getMedicalRecord retorna null si recibe un 404 (No encontrado)', async () => {
        const error404 = { response: { status: 404 } };
        axios.get.mockRejectedValue(error404);

        const result = await MedicalService.getMedicalRecord(1);
        
        expect(result).toBeNull();
        expect(console.warn).toHaveBeenCalled();
    });

    it('getMedicalRecord retorna null ante errores de red generales', async () => {
        axios.get.mockRejectedValue(new Error('Network Error'));

        const result = await MedicalService.getMedicalRecord(1);
        
        expect(result).toBeNull();
        expect(console.error).toHaveBeenCalled();
    });

    // --- CREATE MEDICAL RECORD ---
    it('createMedicalRecord crea la ficha correctamente', async () => {
        const mockResponse = { id: 1, status: 'created' };
        axios.post.mockResolvedValue({ data: mockResponse });
        
        const payload = { height: 180, weight: 80 };
        const result = await MedicalService.createMedicalRecord(payload);

        expect(result).toEqual(mockResponse);
        expect(axios.post).toHaveBeenCalledWith(
            expect.stringContaining('/medical/records'),
            payload,
            expect.anything()
        );
    });

    it('createMedicalRecord lanza error si falla', async () => {
        const errorMsg = 'Datos inválidos';
        axios.post.mockRejectedValue({ response: { data: { error: errorMsg } } });

        await expect(MedicalService.createMedicalRecord({}))
            .rejects
            .toThrow(errorMsg);
    });

    // --- UPDATE MEDICAL RECORD ---
    it('updateMedicalRecord actualiza datos correctamente', async () => {
        const mockResponse = { success: true };
        axios.put.mockResolvedValue({ data: mockResponse });

        const updatePayload = { weight: 82 };
        const result = await MedicalService.updateMedicalRecord(1, updatePayload);

        expect(result).toEqual(mockResponse);
        expect(axios.put).toHaveBeenCalledWith(
            expect.stringContaining('/medical/records/1'),
            updatePayload,
            expect.anything()
        );
    });

    it('updateMedicalRecord lanza error si la actualización falla', async () => {
        const errorMsg = 'Error interno';
        axios.put.mockRejectedValue({ response: { data: { error: errorMsg } } });

        await expect(MedicalService.updateMedicalRecord(1, {}))
            .rejects
            .toThrow(errorMsg);
    });
});
</file>

<file path="src/tests/services/readingsService.test.js">
import { describe, it, expect } from 'vitest';
import { getLastReading } from '../../services/readingsService';

describe('readingsService', () => {
    it('getLastReading devuelve los datos estáticos esperados', () => {
        const reading = getLastReading();
        
        // Verificamos la estructura completa
        expect(reading).toEqual({
            glucose: 300,
            systolic: 134,
            diastolic: 92,
            date: "13 de enero, 14:02",
        });
    });
});
</file>

<file path="src/tests/services/SpecialistService.test.js">
import { describe, it, expect, vi, beforeEach } from 'vitest';
import axios from 'axios';
import * as SpecialistService from '../../services/SpecialistService';

vi.mock('axios');

describe('SpecialistService', () => {
    
    beforeEach(() => {
        vi.clearAllMocks();
        localStorage.setItem('token', 'token-especialista');
        // Evitamos ruidos en la consola durante los tests
        vi.spyOn(console, 'error').mockImplementation(() => {});
    });

    it('getPatients debe retornar la lista de pacientes correctamente', async () => {
        const mockPatients = [{ id: 1, name: 'Juan' }, { id: 2, name: 'Ana' }];
        axios.get.mockResolvedValue({ data: mockPatients });

        const result = await SpecialistService.getPatients();

        expect(result).toEqual(mockPatients);
        expect(axios.get).toHaveBeenCalledWith(
            expect.stringContaining('/patients'),
            expect.objectContaining({ headers: expect.anything() })
        );
    });

    it('getPatients retorna una lista vacía si hay error', async () => {
        axios.get.mockRejectedValue(new Error('Fail'));

        const result = await SpecialistService.getPatients();
        
        expect(result).toEqual([]); 
        expect(console.error).toHaveBeenCalled();
    });

    it('getPatientDashboardData debe retornar los datos de salud del paciente', async () => {
        const mockHealth = { glucose: { value: 120 }, pressure: { systolic: 120 } };
        axios.get.mockResolvedValue({ data: mockHealth });

        const result = await SpecialistService.getPatientDashboardData(123);

        expect(result).toEqual(mockHealth);
        expect(axios.get).toHaveBeenCalledWith(
            expect.stringContaining('/api/registros/dashboard/123'),
            expect.anything()
        );
    });

    it('getPatientDashboardData maneja errores retornando nulos', async () => {
        axios.get.mockRejectedValue(new Error('Fail'));
        
        const result = await SpecialistService.getPatientDashboardData(1);
        
        expect(result).toEqual({ glucose: null, pressure: null });
    });

    it('getPatientHistory debe retornar el historial del paciente', async () => {
        const mockHistory = [{ glucose: 100 }, { glucose: 110 }];
        axios.get.mockResolvedValue({ data: mockHistory });

        const result = await SpecialistService.getPatientHistory(123);

        expect(result).toEqual(mockHistory);
        expect(axios.get).toHaveBeenCalledWith(
            expect.stringContaining('/api/registros/historial/123'),
            expect.anything()
        );
    });

    it('getDownloadUrl construye la URL correctamente', () => {
        const url = SpecialistService.getDownloadUrl(123);
        // Verificamos que contenga la base y el ID correcto
        expect(url).toContain('/api/descargas/historial/pdf/123');
    });

    it('getMedicalRecord retorna null si la ficha no existe (404)', async () => {
        axios.get.mockRejectedValue({ response: { status: 404 } });

        const result = await SpecialistService.getMedicalRecord(456);

        expect(result).toBeNull();
    });
});
</file>

<file path="src/tests/setup.js">
import '@testing-library/jest-dom'
import { cleanup } from '@testing-library/react'
import { afterEach } from 'vitest'

afterEach(() => {
  cleanup()
})
</file>

<file path="src/tests/utils/formatDate.test.js">
import { describe, it, expect } from 'vitest';
import { formatDateLong } from '../../utils/formatDate';

describe('formatDate.js', () => {
  it('debe retornar string vacío si la fecha es nula o indefinida', () => {
    expect(formatDateLong(null)).toBe('');
    expect(formatDateLong('')).toBe('');
  });

  it('debe formatear correctamente una fecha completa', () => {
    const mockDate = new Date('2023-10-25T14:30:00');
    const result = formatDateLong(mockDate);

    expect(result).toMatch(/miércoles/i); 
    expect(result).toMatch(/25 de octubre/i); 
    expect(result).toMatch(/14:30 pm/); 
  });

  it('debe capitalizar la primera letra del día', () => {
    const mockDate = new Date('2023-10-25T09:00:00');
    const result = formatDateLong(mockDate);
    
    expect(result.charAt(0)).toBe(result.charAt(0).toUpperCase());
  });

  it('debe manejar correctamente el horario am', () => {
    const mockDate = new Date('2023-10-25T09:15:00');
    const result = formatDateLong(mockDate);
    
    expect(result).toMatch(/09:15 am/);
  });
});
</file>

<file path="src/tests/utils/formatDateDownload.test.js">
import { describe, it, expect } from 'vitest';
import { formatDateDownload } from '../../utils/formatDateDownload';

describe('formatDateDownload.js', () => {
  it('debe retornar string vacío si no hay fecha', () => {
    expect(formatDateDownload(null)).toBe('');
  });

  it('debe incluir el año y el formato de hora para archivos', () => {
    const mockDate = new Date('2023-12-31T23:59:00');
    const result = formatDateDownload(mockDate);

    expect(result).toMatch(/2023/);
    expect(result).toMatch(/31 de diciembre/i);
    expect(result).toMatch(/23:59 pm/);
  });
});
</file>

<file path="src/tests/utils/validations.test.js">
import { describe, it, expect } from 'vitest';
import { formatRut, isValidEmail } from '../../utils/validations';

describe('validations.js', () => {
  
  describe('formatRut', () => {
    it('debe formatear correctamente un RUT estándar', () => {
      expect(formatRut('123456789')).toBe('12.345.678-9');
    });

    it('debe formatear correctamente un RUT con K', () => {
      expect(formatRut('12345678k')).toBe('12.345.678-K'); 
    });

    it('debe manejar RUTs de menos de 7 dígitos', () => {
      expect(formatRut('12345k')).toBe('12.345-K');
    });

    it('debe limpiar caracteres especiales antes de formatear', () => {
      expect(formatRut('12.345.678-9')).toBe('12.345.678-9');
    });

    it('debe retornar string vacío si el input es inválido', () => {
      expect(formatRut('')).toBe('');
      expect(formatRut(null)).toBe('');
    });
  });

  describe('isValidEmail', () => {
    it('debe retornar true para emails válidos', () => {
      expect(isValidEmail('yeider@duoc.cl')).toBe(true);
      expect(isValidEmail('test.user@gmail.com')).toBe(true);
    });

    it('debe retornar false para formatos de correo inválidos', () => {
      expect(isValidEmail('yeiderduoc.cl')).toBe(false);
      expect(isValidEmail('yeider@')).toBe(false);
      expect(isValidEmail('')).toBe(false);
    });
  });
});
</file>

<file path="src/components/Admin/RegisterSpecialistModal.jsx">
import React, { useState } from 'react';
import { X, UserPlus, Mail, Lock, FileText } from 'lucide-react';
import { createSpecialist } from '../../services/AdminService';

const RegisterSpecialistModal = ({ onClose, onSuccess }) => {
    const [formData, setFormData] = useState({
        first_names: '',
        last_names: '',
        rut: '',
        email: '',
        password: ''
    });
    
    const [errors, setErrors] = useState({});
    const [loading, setLoading] = useState(false);

    const formatRut = (rut) => {
        let value = rut.replace(/[^0-9kK]/g, '');
        if (value.length <= 1) return value;
        const body = value.slice(0, -1);
        const dv = value.slice(-1).toUpperCase();
        return `${body.replace(/\B(?=(\d{3})+(?!\d))/g, ".")}-${dv}`;
    };

    const handleChange = (e) => {
        const { name, value } = e.target;
        if (name === 'rut') {
            setFormData({ ...formData, [name]: formatRut(value) });
        } else {
            setFormData({ ...formData, [name]: value });
        }
        if (errors[name]) {
            setErrors({ ...errors, [name]: null });
        }
    };

    const validateForm = () => {
        const newErrors = {};
        if (!formData.rut || formData.rut.length < 8) newErrors.rut = "El RUT es incompleto.";
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(formData.email)) newErrors.email = "Formato de correo inválido.";
        const passRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).{6,}$/;
        if (!passRegex.test(formData.password)) newErrors.password = "Mín. 6 caracteres, 1 mayús, 1 num, 1 símbolo.";
        if (!formData.first_names.trim()) newErrors.first_names = "Requerido.";
        if (!formData.last_names.trim()) newErrors.last_names = "Requerido.";
        setErrors(newErrors);
        return Object.keys(newErrors).length === 0;
    };

    const handleSubmit = async (e) => {
        e.preventDefault();
        if (!validateForm()) return;

        setLoading(true);
        
        const { success, error } = await createSpecialist(formData);

        setLoading(false);

        if (success) {
            alert("Especialista creado con éxito.");
            onSuccess();
            onClose();
        } else {
            const errorText = error.toLowerCase();
            const serverErrors = {};

            if (errorText.includes('rut')) {
                serverErrors.rut = error;
            } else if (errorText.includes('correo') || errorText.includes('email')) {
                serverErrors.email = error;
            } else {
                alert("Error del sistema: " + error);
            }

            setErrors({ ...errors, ...serverErrors });
        }
    };

    return (
        <div className="modal-overlay">
            <div className="modal-content">
                <div className="modal-header">
                    <h3>
                        <UserPlus size={24} /> Registrar Especialista
                    </h3>
                    <button onClick={onClose} className="btn-close-modal">
                        <X size={24} />
                    </button>
                </div>

                <form onSubmit={handleSubmit}>
                    <div className="form-grid-2">
                        <div className="input-group-reset">
                            <label>Nombres</label>
                            <input 
                                type="text" 
                                name="first_names" 
                                value={formData.first_names} 
                                onChange={handleChange} 
                                className={`input-reset ${errors.first_names ? 'input-error-border' : ''}`} 
                            />
                            {errors.first_names && <span className="error-msg">{errors.first_names}</span>}
                        </div>
                        <div className="input-group-reset">
                            <label>Apellidos</label>
                            <input 
                                type="text" 
                                name="last_names" 
                                value={formData.last_names} 
                                onChange={handleChange} 
                                className={`input-reset ${errors.last_names ? 'input-error-border' : ''}`} 
                            />
                            {errors.last_names && <span className="error-msg">{errors.last_names}</span>}
                        </div>
                    </div>

                    <div className="input-group-reset">
                        <label>RUT</label>
                        <div className="input-icon-wrapper">
                            <FileText size={18} className="input-icon" />
                            <input 
                                type="text" 
                                name="rut" 
                                placeholder="12.345.678-K" 
                                value={formData.rut} 
                                onChange={handleChange} 
                                maxLength={12} 
                                className={`input-reset input-with-icon ${errors.rut ? 'input-error-border' : ''}`} 
                            />
                        </div>
                        {errors.rut && <span className="error-msg">{errors.rut}</span>}
                    </div>

                    <div className="input-group-reset">
                        <label>Correo Institucional</label>
                        <div className="input-icon-wrapper">
                            <Mail size={18} className="input-icon" />
                            <input 
                                type="email" 
                                name="email" 
                                value={formData.email} 
                                onChange={handleChange} 
                                className={`input-reset input-with-icon ${errors.email ? 'input-error-border' : ''}`} 
                            />
                        </div>
                        {errors.email && <span className="error-msg">{errors.email}</span>}
                    </div>

                    <div className="input-group-reset">
                        <label>Contraseña Inicial</label>
                        <div className="input-icon-wrapper">
                            <Lock size={18} className="input-icon" />
                            <input 
                                type="password" 
                                name="password" 
                                value={formData.password} 
                                onChange={handleChange} 
                                className={`input-reset input-with-icon ${errors.password ? 'input-error-border' : ''}`} 
                            />
                        </div>
                        {errors.password && <span className="error-msg">{errors.password}</span>}
                    </div>

                    <div className="modal-actions">
                        <button type="button" onClick={onClose} className="btn-cancel">Cancelar</button>
                        <button type="submit" className="btn-confirm" disabled={loading}>
                            {loading ? 'Validando...' : 'Registrar Profesional'}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    );
};

export default RegisterSpecialistModal;
</file>

<file path="src/components/Carousel.jsx">
import { useState, useEffect, useRef } from 'react';
import { useNavigate } from 'react-router-dom';
import '../Styles/carouselStyles.css';
import imagen1 from '../assets/imagen1.png'; 
import carrusel1 from '../assets/carrusel-1.png';

const Carousel = () => {
  const navigate = useNavigate();
  const [currentIndex, setCurrentIndex] = useState(0);
  const listRef = useRef();

  const slides = [
    {
      id: 1,
      badge: "Salud explicada por IA",
      title: "Monitorea tu Presión y Glucosa con IA",
      text: "Controla tus niveles de forma simple y segura.",
      img: carrusel1
    },
    {
      id: 2,
      badge: "Tecnología Gemini",
      title: "Análisis Clínico en Lenguaje Claro",
      text: "Entiende tus resultados sin tecnicismos complejos.",
      img: imagen1
    },
    {
      badge: "Vive tranquilo",
      title: "Tus Datos Médicos están Seguros",
      text: "Implementamos altos estándares de seguridad y cifrado para que tu información personal esté siempre protegida.",
      img: imagen2 
    }
  ];

  useEffect(() => {
    const listNode = listRef.current;
    const imgNode = listNode.querySelectorAll("li > img")[currentIndex];

    if (imgNode) {
      imgNode.scrollIntoView({
        behavior: "smooth",
        block: "nearest",
        inline: "center"
      });
    }
  }, [currentIndex]);

  const scrollToImage = (direction) => {
    if (direction === 'prev') {
      setCurrentIndex(curr => (curr === 0 ? 0 : curr - 1));
    } else {
      setCurrentIndex(curr => (curr === slides.length - 1 ? curr : curr + 1));
    }
  };

  return (
    <div className="main-container">
      <div className="slider-container">
        <div className="leftArrow" onClick={() => scrollToImage('prev')}>&#10094;</div>
        <div className="rightArrow" onClick={() => scrollToImage('next')}>&#10095;</div>
        
        <div className="container-images">
          <ul ref={listRef}>
            {slides.map((item, index) => (
              <li key={item.id} className="slide-item">
                <div className="hero-text">
                  <span className="badge">{item.badge}</span>
                  <h1>{item.title}</h1>
                  <p>{item.text}</p>
                  <button className="btn-primary big" onClick={() => navigate("/signup")}>
                    Comenzar Ahora
                  </button>
                </div>
                <img src={item.img} alt="Salud" />
              </li>
            ))}
          </ul>
        </div>

        <div className="dots-container">
          {slides.map((_, idx) => (
            <div 
              key={idx} 
              className={`dot-item ${idx === currentIndex ? "active" : ""}`}
              onClick={() => setCurrentIndex(idx)}
            >
              &#9679;
            </div>
          ))}
        </div>
      </div>
    </div>
  );
};

export default Carousel;
</file>

<file path="src/components/Guards/AdminGuard.jsx">
import React from 'react';
import { Navigate } from 'react-router-dom';

const AdminGuard = ({ children }) => {
  const token = localStorage.getItem('token');
  const role = localStorage.getItem('user_role');

  if (!token) {
    return <Navigate to="/login" replace />;
  }

  if (role === 'patient') {
    return <Navigate to="/dashboard" replace />;
  }

  if (role === 'specialist') {
    return <Navigate to="/panel-medico" replace />;
  }

  if (role === 'admin') {
    return children;
  }

  return <Navigate to="/" replace />;
};

export default AdminGuard;
</file>

<file path="src/components/Guards/PatientGuard.jsx">
import React from 'react';
import { Navigate } from "react-router-dom";

const PatientGuard = ({ children }) => {
  const token = localStorage.getItem("token");
  const role = localStorage.getItem("user_role");

  if (!token) {
    return <Navigate to="/login" replace />;
  }

  if (role === 'admin') {
    return <Navigate to="/admin" replace />;
  }

  if (role === 'specialist') {
    return <Navigate to="/panel-medico" replace />;
  }

  return children;
};

export default PatientGuard;
</file>

<file path="src/components/Guards/SpecialistGuard.jsx">
import React from 'react';
import { Navigate } from "react-router-dom";

const SpecialistGuard = ({ children }) => {
  const token = localStorage.getItem('token');
  const role = localStorage.getItem('user_role');
  
  if (!token) return <Navigate to="/login" replace />;
  
  if (role === 'patient') {
      return <Navigate to="/dashboard" replace />;
  }

  if (role === 'admin') {
      return <Navigate to="/admin" replace />;
  }
  
  if (role === 'specialist') {
      return children;
  }

  return <Navigate to="/login" replace />;
};

export default SpecialistGuard;
</file>

<file path="src/components/Landing/DrChapatinSection.jsx">
import React from "react";
import { BookOpenCheck, BrainCircuit, ShieldCheck, CheckCircle2 } from "lucide-react";
import "../../Styles/DrChapatinSection.css"; 
import drImage from "../../assets/dr-chapatin.png"; 

export default function DrChapatinSection() {

  return (
    <section className="chapatin-section">
      <div className="chapatin-container">
        
        <div className="chapatin-content">
          <div className="badge-wrapper">
            <span className="badge-ia">IA Médica Avanzada</span>
            <span className="badge-humor">Modo: Dr. Chapatín</span>
          </div>
          
          <h2>No es broma: <br/>Ciencia real detrás del personaje.</h2>
          
          <p className="main-description">
            Puede que el Dr. Chapatín traiga su "bolsita", pero nuestra IA trae 
            <strong> gigabytes de literatura médica validada</strong>. Hemos entrenado el modelo 
            para separar el humor del diagnóstico:
          </p>

          <p className="sub-description">
            La personalidad es para que te relajes. Los datos son para que te cuides.
          </p>

          <div className="trust-grid">
            <div className="trust-item">
              <div className="trust-icon icon-blue">
                <BookOpenCheck size={24} />
              </div>
              <div>
                <h4>Protocolos Clínicos</h4>
                <p>Basado en guías MINSAL y OMS.</p>
              </div>
            </div>
            
            <div className="trust-item">
              <div className="trust-icon icon-purple">
                <BrainCircuit size={24} />
              </div>
              <div>
                <h4>Entrenamiento</h4>
                <p>+1M de casos médicos anonimizados.</p>
              </div>
            </div>
            
            <div className="trust-item">
              <div className="trust-icon icon-green">
                <ShieldCheck size={24} />
              </div>
              <div>
                <h4>Seguridad</h4>
                <p>Tus datos están encriptados y seguros.</p>
              </div>
            </div>
          </div>

          <p className="disclaimer-text">
            *Nota: Esta IA ofrece orientación y triaje, no reemplaza una consulta médica presencial.
          </p>
        </div>

        <div className="chapatin-image-wrapper">
          <div className="blob-bg"></div>
          <img src={drImage} alt="Dr Chapatín IA" className="chapatin-img" />
          
          <div className="floating-card">
            <div className="check-icon-wrapper">
              <CheckCircle2 size={20} />
            </div>
            <div className="floating-text">
              <strong>Precisión Analítica</strong>
              <span>98% en detección de síntomas</span>
            </div>
          </div>
        </div>

      </div>
    </section>
  );
}
</file>

<file path="src/components/Landing/HowToUseSection.jsx">
import React from "react";
import "../../Styles/HowToUseSection.css";

export default function HowToUseSection() {
  return (
    <section className="tutorial-section">
      <div className="tutorial-container">
        
        <div className="tutorial-header">
          <span className="tutorial-badge">Guía Rápida</span>
          <h2>Toma el control en 3 pasos</h2>
          <p>Registrar tu salud nunca fue tan sencillo. Olvídate de las libretas de papel.</p>
        </div>

        <div className="steps-grid">
          <div className="step-card">
            <div className="step-number">1</div>
            <div className="step-icon-bg purple">
              <svg viewBox="0 0 24 24" width="32" height="32"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" fill="currentColor"/></svg>
            </div>
            <h3>Entra al Registro</h3>
            <p>Desde tu Panel Principal, busca la tarjeta que dice <strong>"Registrar Información"</strong> con el signo más (+).</p>
          </div>

          <div className="step-card">
            <div className="step-number">2</div>
            <div className="step-icon-bg blue">
              <svg viewBox="0 0 24 24" width="32" height="32"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" fill="currentColor"/></svg>
            </div>
            <h3>Ingresa tus Datos</h3>
            <p>Escribe tus niveles de <strong>Glucosa</strong> o <strong>Presión Arterial</strong>. El formulario es inteligente y validará los números por ti.</p>
          </div>

          <div className="step-card">
            <div className="step-number">3</div>
            <div className="step-icon-bg green">
              <svg viewBox="0 0 24 24" width="32" height="32"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z" fill="currentColor"/></svg>
            </div>
            <h3>Recibe tu Análisis</h3>
            <p>Al guardar, nuestra IA analizará el resultado y te dirá al instante si estás <strong>Estable</strong> o si necesitas atención.</p>
          </div>
        </div>

      </div>
    </section>
  );
}
</file>

<file path="src/components/Loader.jsx">
import React from 'react';
import { Loader2 } from 'lucide-react';
import '../Styles/LoaderStyles.css';

const Loader = ({ message = "Cargando sistema..." }) => {
  return (
    <div className="loader-overlay">
      <div className="loader-content">
        <Loader2 className="loader-spinner" size={60} />
        <p>{message}</p>
      </div>
    </div>
  );
};

export default Loader;
</file>

<file path="src/pages/AboutPage.jsx">
import React from 'react';
import { useNavigate } from 'react-router-dom'; 
import { FcPrivacy, FcMindMap, FcLike } from 'react-icons/fc'; 
import '../Styles/AboutStyles.css';

const AboutPage = () => {
  const navigate = useNavigate(); 

  return (
    <div className="about-container">
      <div className="about-hero">
        <h1>Cuidando tu salud con tecnología</h1>
        <p>
          En <strong>Salud al Día</strong>, creemos que el bienestar debe ser accesible, 
          inteligente y fácil de entender para todos.
        </p>
      </div>

      <div className="about-mission">
        <div className="mission-card">
          <h2> Nuestra Misión</h2>
          <p>
            Democratizar el acceso a un monitoreo de salud preventivo. 
            Utilizamos tecnología avanzada para que puedas registrar, visualizar 
            y entender tus indicadores vitales (glucosa y presión) sin complicaciones.
          </p>
        </div>
        <div className="mission-card">
          <h2> Nuestra Visión</h2>
          <p>
            Ser la plataforma líder en Latinoamérica en autogestión de salud digital, 
            conectando a pacientes con sus datos médicos de manera segura y eficiente, 
            reduciendo riesgos mediante la prevención temprana.
          </p>
        </div>
      </div>

      <div className="about-values">
        <h2>¿Por qué elegirnos?</h2>
        <div className="values-grid">
          <div className="value-item">
            <span className="value-icon"><FcPrivacy size={45} /></span>
            <h3>Seguridad Total</h3>
            <p>Tus datos médicos están encriptados y protegidos con los más altos estándares.</p>
          </div>
          <div className="value-item">
            <span className="value-icon"><FcMindMap size={45} /></span>
            <h3>Innovación IA</h3>
            <p>Integramos inteligencia artificial para ayudarte a interpretar tus resultados.</p>
          </div>
          <div className="value-item">
            <span className="value-icon"><FcLike size={45} /></span>
            <h3>Centrado en Ti</h3>
            <p>Diseñamos cada pantalla pensando en tu facilidad de uso y tranquilidad.</p>
          </div>
        </div>
      </div> 

      <section className="cta-footer">
        <h2>¿Listo para mejorar tu salud?</h2>
        <p>Únete a miles de personas que ya confían en Salud al Día.</p>
        <button className="btn-white" onClick={() => navigate("/signup")}>
          Crear Cuenta Ahora
        </button>
      </section>
    </div>
  );
};

export default AboutPage;
</file>

<file path="src/pages/ContactPage.jsx">
import React, { useState } from 'react';
import '../Styles/ContactStyles.css';

const ContactPage = () => {
  const [activeIndex, setActiveIndex] = useState(null);

  const toggleFAQ = (index) => {
    setActiveIndex(activeIndex === index ? null : index);
  };

  const faqData = [
    {
        question: "¿Cómo registro mi presión arterial o glucosa?",
        answer: "Ve a tu 'Mi Panel' y busca la tarjeta de 'Registro Rápido'. Selecciona si quieres guardar Glucosa o Presión, ingresa el valor y pulsa Guardar. ¡Se añadirá automáticamente a tu historial!"
      },
      {
        question: "¿Puedo ver mis datos en otro celular?",
        answer: "¡Sí! Como Salud al Día guarda tu información en la nube de forma segura, solo necesitas iniciar sesión con tu correo y contraseña en cualquier dispositivo para ver todo tu historial."
      },
      {
        question: "¿Es seguro guardar mi información médica aquí?",
        answer: "Absolutamente. Utilizamos encriptación y estándares de seguridad para proteger tu privacidad. Nadie más tiene acceso a tus datos personales sin tu autorización."
      },
      {
        question: "¿Qué hago si me equivoqué al anotar un dato?",
        answer: "No te preocupes. Ve a la sección 'Historial', busca el registro incorrecto y verás una opción para eliminarlo. Luego puedes volver a ingresarlo correctamente."
      },
      {
        question: "¿Cómo puedo recuperar mi contraseña?",
        answer: "En la pantalla de Iniciar Sesión, pulsa sobre '¿Olvidaste tu contraseña?'. Te enviaremos un enlace a tu correo registrado para que puedas crear una nueva."
      }
  ];

  return (
    <div className="contact-container">
      <div className="contact-hero">
        <h1>Centro de Ayuda</h1>
        <p>Estamos aquí para escucharte y resolver tus dudas.</p>
      </div>

      <div className="contact-grid-equal">
        <div className="contact-card-equal">
          <h2> Reportar un Problema</h2>
          <p className="report-description">
            ¿Encontraste un error en la web? Cuéntanos para arreglarlo.
          </p>
          <form onSubmit={(e) => { e.preventDefault(); alert('¡Gracias! Mensaje enviado al equipo técnico.'); }}>
            <div className="form-group">
              <label>Asunto</label>
              <input type="text" className="form-input" placeholder="Ej: Error al guardar datos" required />
            </div>
            <div className="form-group">
              <label>Mensaje</label>
              <textarea className="form-textarea" rows="5" placeholder="Describe el problema..." required></textarea>
            </div>
            <button type="submit" className="btn-send">Enviar Reporte</button>
          </form>
        </div>

        <div className="contact-card-equal delete-card-style">
            <div className="delete-content-centered">
                <h3> Gestión de Cuenta</h3>
                <p>
                Lamentamos que quieras irte. Si deseas <strong>eliminar tu cuenta</strong> y borrar 
                todos tus datos permanentemente de nuestros servidores, por favor escribe desde 
                tu correo registrado a:
                </p>
                <br />
                <a href="mailto:bajas@saludaldia.com?subject=Solicitud de Baja de Cuenta" className="email-link-large">
                 bajas@saludaldia.com
                </a>
                <p className="delete-warning">
                *El proceso es irreversible y puede tardar hasta 48 horas hábiles.
                </p>
            </div>
        </div>
      </div>

      <div className="faq-section">
        <h2 className="faq-title">Preguntas Frecuentes (FAQ)</h2>
        <div className="faq-list">
          {faqData.map((item, index) => (
            <div className="faq-item" key={index}>
              <button className="faq-question" onClick={() => toggleFAQ(index)}>
                {item.question}
                <span>{activeIndex === index ? '−' : '+'}</span>
              </button>
              <div className={`faq-answer ${activeIndex === index ? 'open' : ''}`}>
                {item.answer}
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  );
};

export default ContactPage;
</file>

<file path="src/pages/HealthRegisterPage.jsx">
import HealthRegisterForm from "../components/Dashboard/HealthRegisterForm";
import "../Styles/healthRegister.css";

export default function HealthRegisterPage() {
  return (
    <div className="health-page">
      <h1>Registrar Información de Salud</h1>
      <p>Ingresa tus valores de glucosa y presión arterial</p>
      <HealthRegisterForm />
    </div>
  );
}
</file>

<file path="src/pages/ResetPassword.jsx">
import React, { useState, useEffect } from 'react';
import { useNavigate, useSearchParams } from 'react-router-dom';
import { Eye, EyeOff, Lock, CheckCircle } from 'lucide-react';
import { updatePasswordFinal } from '../services/AdminService';
import '../Styles/ResetPasswordStyles.css';

const ResetPassword = () => {
  const [searchParams] = useSearchParams();
  const navigate = useNavigate();
  const emailFromUrl = searchParams.get('email');

  const [passwords, setPasswords] = useState({ newPassword: '', confirmPassword: '' });
  const [showPass, setShowPass] = useState(false);
  const [loading, setLoading] = useState(false);
  const [status, setStatus] = useState(null);

  useEffect(() => {
    if (!emailFromUrl) {
      navigate('/login');
    }
  }, [emailFromUrl, navigate]);

  const handleChange = (e) => {
    setPasswords({ ...passwords, [e.target.name]: e.target.value });
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setStatus(null);

    if (passwords.newPassword !== passwords.confirmPassword) {
      alert("Las contraseñas no coinciden");
      return;
    }

    if (passwords.newPassword.length < 6) {
      alert("La contraseña debe tener al menos 6 caracteres");
      return;
    }

    setLoading(true);

    const { success, error } = await updatePasswordFinal(emailFromUrl, passwords.newPassword);

    if (success) {
      setStatus('success');
      setTimeout(() => navigate('/login'), 3000);
    } else {
      alert("Error: " + error);
      setLoading(false);
    }
  };

  if (status === 'success') {
    return (
      <div className="reset-container">
        <div className="reset-box success-box">
          <CheckCircle size={60} className="icon-success" />
          <h2>Contraseña Actualizada</h2>
          <p>Tu contraseña ha sido cambiada exitosamente.</p>
          <p className="redirect-text">Redirigiendo al Login...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="reset-container">
      <div className="reset-box">
        <div className="reset-header">
          <div className="icon-wrapper">
            <Lock size={30} className="icon-lock" />
          </div>
          <h2>Restablecer Contraseña</h2>
          <p className="email-display">Cuenta: {emailFromUrl}</p>
        </div>

        <form onSubmit={handleSubmit}>
          <div className="input-group-reset">
            <label>Nueva Contraseña</label>
            <div className="password-wrapper">
              <input 
                type={showPass ? "text" : "password"} 
                name="newPassword" 
                placeholder="Mínimo 6 caracteres"
                value={passwords.newPassword}
                onChange={handleChange}
                required 
              />
              <button type="button" className="toggle-btn" onClick={() => setShowPass(!showPass)}>
                {showPass ? <EyeOff size={18} /> : <Eye size={18} />}
              </button>
            </div>
          </div>

          <div className="input-group-reset">
            <label>Confirmar Contraseña</label>
            <input 
              type={showPass ? "text" : "password"} 
              name="confirmPassword" 
              placeholder="Repite la contraseña"
              value={passwords.confirmPassword}
              onChange={handleChange}
              required 
            />
          </div>

          <button type="submit" className="btn-reset" disabled={loading}>
            {loading ? 'Actualizando...' : 'Cambiar Contraseña'}
          </button>
        </form>
      </div>
    </div>
  );
};

export default ResetPassword;
</file>

<file path="src/pages/SpecialistDashboard.jsx">
import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Search, FileText, User } from 'lucide-react';
import { getPatients, getPatientDashboardData } from '../services/SpecialistService'; 
import '../Styles/SpecialistStyles.css'; 

const SpecialistDashboard = () => {
  const navigate = useNavigate();
  const [patients, setPatients] = useState([]);
  const [filter, setFilter] = useState('all'); 
  const [searchTerm, setSearchTerm] = useState('');
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchPatientsAndData = async () => {
      setLoading(true);
      try {
        const patientsList = await getPatients();
        
        const enrichedPatients = await Promise.all(
          patientsList.map(async (patient) => {
            try {
              const healthData = await getPatientDashboardData(patient.id);
              
              const lastGlucoseDate = healthData.glucose?.date ? new Date(healthData.glucose.date) : null;
              const lastPressureDate = healthData.pressure?.date ? new Date(healthData.pressure.date) : null;
              
              let lastControlDate = "Sin registros";
              if (lastGlucoseDate || lastPressureDate) {
                const dates = [lastGlucoseDate, lastPressureDate].filter(d => d !== null);
                const mostRecent = new Date(Math.max(...dates));
                lastControlDate = mostRecent.toLocaleDateString();
              }

              let status = 'stable';
              let statusLabel = 'Estable';

              const glucose = healthData.glucose?.value;
              const sys = healthData.pressure?.systolic;
              const dia = healthData.pressure?.diastolic;

              if (glucose > 140 || sys >= 140 || dia >= 90) {
                status = 'critical';
                statusLabel = 'Alerta';
              } else if (glucose > 0 && glucose < 70) {
                status = 'critical';
                statusLabel = 'Hipoglicemia';
              }

              return {
                ...patient,
                lastControl: lastControlDate,
                status: status,
                statusLabel: statusLabel
              };
            } catch (err) {
              return {
                ...patient,
                lastControl: 'Error de carga',
                status: 'stable',
                statusLabel: 'Estable'
              };
            }
          })
        );

        setPatients(enrichedPatients);
      } catch (error) {
        console.error(error);
      } finally {
        setLoading(false);
      }
    };

    fetchPatientsAndData();
  }, []);

  const filteredPatients = patients.filter(p => {
    const fullName = `${p.first_names || ''} ${p.last_names || ''}`.toLowerCase();
    const rut = p.rut ? p.rut.toLowerCase() : '';
    const search = searchTerm.toLowerCase();
    const matchesSearch = fullName.includes(search) || rut.includes(search);
    
    if (!matchesSearch) return false;
    if (filter === 'all') return true;
    return p.status === filter;
  });

  return (
    <div className="specialist-bg">
      <div className="specialist-container">
        <header className="dashboard-header">
            <div className="header-title-wrapper">
                <h1>Panel de Control Medico</h1>
                <span className="badge-pro">Profesional</span>
            </div>
            <p>Monitoreo de pacientes en tiempo real</p>
        </header>

        <div className="toolbar-card">
            <div className="search-bar">
                <Search className="search-icon-input" size={20} />
                <input 
                    type="text" 
                    placeholder="Buscar paciente por RUT o Nombre..." 
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                />
            </div>
            
            <div className="filter-buttons">
                <button 
                    className={`filter-btn ${filter === 'all' ? 'active blue' : ''}`} 
                    onClick={() => setFilter('all')}
                >
                    Todos
                </button>
                <button 
                    className={`filter-btn ${filter === 'critical' ? 'active red' : ''}`} 
                    onClick={() => setFilter('critical')}
                >
                    Alertas
                </button>
                <button 
                    className={`filter-btn ${filter === 'stable' ? 'active green' : ''}`} 
                    onClick={() => setFilter('stable')}
                >
                    Estables
                </button>
            </div>
        </div>

        <div className="table-container-medical">
            <div className="table-wrapper-scroll">
                <table className="medical-table">
                    <thead>
                        <tr>
                            <th>Paciente</th>
                            <th>RUT</th>
                            <th>Ultimo Control</th>
                            <th>Estado</th>
                            <th>Accion</th>
                        </tr>
                    </thead>
                    <tbody>
                        {!loading && filteredPatients.map(patient => (
                            <tr key={patient.id}>
                                <td className="patient-cell">
                                    <div className="avatar-circle">
                                        <User size={18} className="icon-white" />
                                    </div>
                                    <div className="patient-info">
                                        <span className="patient-name">{patient.first_names} {patient.last_names}</span>
                                    </div>
                                </td>
                                <td>{patient.rut}</td>
                                <td>{patient.lastControl}</td>
                                <td>
                                    <span className={`status-badge-medical ${patient.status}`}>
                                        {patient.statusLabel}
                                    </span>
                                </td>
                                <td>
                                    <button 
                                        className="btn-view-file"
                                        onClick={() => navigate(`/paciente/${patient.id}`)}
                                    >
                                        <FileText size={16} /> Ver Ficha
                                    </button>
                                </td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>
            {filteredPatients.length === 0 && !loading && (
                <div className="no-data">No se encontraron pacientes.</div>
            )}
            {loading && <div className="no-data">Cargando informacion de salud...</div>}
        </div>
      </div>
    </div>
  );
};

export default SpecialistDashboard;
</file>

<file path="src/setupTests.js">
import '@testing-library/jest-dom'
</file>

<file path="src/Styles/AboutStyles.css">
.about-container {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  color: #333;
  line-height: 1.6;
  padding-bottom: 60px;
}

.about-hero {
  background-color: #f8fafc;
  text-align: center;
  padding: 80px 20px;
  border-bottom: 1px solid #e5e7eb;
}

.about-hero h1 {
  font-size: 2.5rem;
  color: #2563eb; 
  margin-bottom: 15px;
}

.about-hero p {
  font-size: 1.2rem;
  color: #64748b;
  max-width: 700px;
  margin: 0 auto;
}

.about-mission {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 40px;
  padding: 60px 5%;
  background: white;
}

.mission-card {
  background: white;
  padding: 40px;
  border-radius: 12px;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  flex: 1;
  min-width: 300px;
  max-width: 500px;
  border-top: 4px solid #2563eb;
}

.mission-card h2 {
  color: #1e293b;
  margin-bottom: 15px;
}

.about-values {
  background-color: #f0f9ff; 
  padding: 60px 5%;
  text-align: center;
}

.values-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 30px;
  margin-top: 40px;
}

.value-item {
  background: white;
  padding: 30px;
  border-radius: 10px;
  transition: transform 0.3s ease;
}

.value-item:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
}

.value-icon {
  font-size: 2rem;
  margin-bottom: 15px;
  display: block;
}


@media (max-width: 768px) {
  .about-hero h1 { font-size: 2rem; }
  .about-mission { flex-direction: column; }
}

.cta-footer {
  background: #2563eb; 
  color: white;
  text-align: center;
  padding: 60px 20px;
  width: 100%;
  margin-top: 40px;
  box-shadow: 0 -4px 10px rgba(0,0,0,0.05); 
}

.cta-footer h2 {
  font-size: 2rem;
  margin-bottom: 15px;
}

.cta-footer p {
  font-size: 1.1rem;
  opacity: 0.9;
  margin-bottom: 25px;
}

.btn-white {
  background-color: white;
  color: #2563eb;
  padding: 12px 30px;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  font-size: 1rem;
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
}

.btn-white:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}
</file>

<file path="src/Styles/carouselStyles.css">
.main-container {
  width: 100%;
  padding: 40px 10%;
  background: #f4f8ff;
}

.slider-container {
  position: relative;
  width: 100%;
  height: 500px;
}

.container-images {
  width: 100%;
  height: 100%;
  overflow: hidden; 
  border-radius: 22px;
}

.container-images ul {
  display: flex;
  list-style: none;
  width: 100%;
  height: 100%;
}

.slide-item {
  min-width: 100%; 
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 40px;
}

.slide-item img {
  width: 50%;
  height: 400px;
  object-fit: cover;
  border-radius: 22px;
  box-shadow: 0 20px 40px rgba(0,0,0,0.1);
}

.leftArrow, .rightArrow {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  font-size: 50px;
  color: #2563eb;
  cursor: pointer;
  z-index: 10;
  transition: 0.3s;
}

.leftArrow { left: -60px; }
.rightArrow { right: -60px; }

.dots-container {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-top: 20px;
}

.dot-item {
  cursor: pointer;
  color: #cbd5e1;
  font-size: 20px;
}

.dot-item.active {
  color: #2563eb;
}
</file>

<file path="src/Styles/ContactStyles.css">
.contact-container {
  max-width: 1100px; 
  margin: 0 auto;
  padding: 60px 20px;
  font-family: 'Segoe UI', sans-serif;
  color: #333;
}

.contact-hero {
  text-align: center;
  margin-bottom: 50px;
}

.contact-hero h1 {
  color: #2563eb;
  font-size: 2.5rem;
  margin-bottom: 10px;
}

.contact-hero p {
  color: #64748b;
  font-size: 1.1rem;
}

.contact-grid-equal {
  display: grid;
  grid-template-columns: 1fr 1fr; 
  gap: 40px;
  margin-bottom: 60px;
  align-items: stretch; 
}

.contact-card-equal {
  background: white;
  padding: 40px; 
  border-radius: 16px; 
  box-shadow: 0 10px 25px -5px rgba(0,0,0,0.08); 
  border: 1px solid #f1f5f9;
  display: flex;
  flex-direction: column;
  height: 100%; 
}

.report-description {
  font-size: 0.9rem;
  margin-bottom: 20px;
  color: #666;
}

.form-group { margin-bottom: 25px; }

.form-group label {
  display: block;
  font-weight: 600;
  margin-bottom: 10px;
  color: #334155;
}

.form-input, .form-textarea {
  width: 100%;
  padding: 14px;
  border: 2px solid #e2e8f0; 
  border-radius: 10px;
  font-size: 1rem;
  transition: all 0.2s;
  background: #f8fafc;
}

.form-input:focus, .form-textarea:focus {
  border-color: #2563eb;
  background: white;
  outline: none;
}

.btn-send {
  width: 100%;
  background-color: #2563eb;
  color: white;
  padding: 15px;
  border: none;
  border-radius: 10px;
  font-weight: 700;
  font-size: 1.1rem;
  cursor: pointer;
  transition: background-color 0.2s;
  margin-top: auto;
}

.btn-send:hover { background-color: #1d4ed8; }

.delete-card-style {
  background-color: #fef2f2; 
  border: 2px solid #fee2e2;
  justify-content: center; 
}

.delete-content-centered {
  text-align: center; 
}

.delete-card-style h3 {
  color: #991b1b;
  font-size: 1.8rem;
  margin-bottom: 25px;
}

.delete-card-style p {
  font-size: 1.1rem;
  line-height: 1.7;
  color: #7f1d1d;
}

.email-link-large {
  color: #dc2626;
  font-weight: 800;
  text-decoration: none;
  font-size: 1.6rem; 
  display: block;
  margin: 35px 0;
  padding: 15px;
  background: white;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(220, 38, 38, 0.1);
  transition: transform 0.2s;
}

.email-link-large:hover {
  transform: translateY(-3px);
  text-decoration: none;
  box-shadow: 0 8px 15px rgba(220, 38, 38, 0.15);
}

.delete-warning {
  font-size: 0.85rem;
  margin-top: 20px;
  color: #991b1b;
  font-style: italic;
}

.faq-section { 
  margin-top: 80px; 
  max-width: 800px; 
  margin-left: auto; 
  margin-right: auto;
}

.faq-title { 
  text-align: center; 
  color: #2563eb; 
  margin-bottom: 40px; 
  font-size: 2rem;
}

.faq-item {
  background: white;
  border: 1px solid #e5e7eb;
  margin-bottom: 15px;
  border-radius: 12px;
  overflow: hidden;
}

.faq-question {
  width: 100%;
  text-align: left;
  padding: 20px 25px;
  background: none;
  border: none;
  font-size: 1.1rem;
  font-weight: 600;
  color: #334155;
  cursor: pointer;
  display: flex; 
  justify-content: space-between; 
  align-items: center;
}

.faq-question:hover { 
  background-color: #f8fafc; 
  color: #2563eb;
}

.faq-answer {
  padding: 0 25px;
  max-height: 0;
  overflow: hidden;
  transition: all 0.3s ease-out;
  color: #64748b;
  line-height: 1.7;
}

.faq-answer.open {
  max-height: 300px;
  padding-bottom: 25px;
  padding-top: 10px;
  border-top: 1px solid #f1f5f9;
}

@media (max-width: 768px) {
  .contact-grid-equal { grid-template-columns: 1fr; gap: 30px;}
  .contact-card-equal { height: auto; padding: 30px;}
  .email-link-large { font-size: 1.3rem; }
}
</file>

<file path="src/Styles/DrChapatinSection.css">
.chapatin-section {
  padding: 80px 10%;
  background-color: #f8fafc; 
  overflow: hidden;
  border-top: 1px solid #e2e8f0;
  border-bottom: 1px solid #e2e8f0;
}

.chapatin-container {
  max-width: 1400px; 
  margin: 0 auto;
  display: flex;
  align-items: center;
  gap: 60px;
  position: relative;
}

.chapatin-content {
  flex: 1;
  z-index: 2;
}

.badge-wrapper {
  display: flex;
  gap: 12px;
  margin-bottom: 20px;
  flex-wrap: wrap;
}

.badge-ia {
  background-color: #1e293b; 
  color: #fff;
  padding: 6px 14px;
  border-radius: 50px;
  font-weight: 700;
  font-size: 0.75rem;
  letter-spacing: 0.5px;
  text-transform: uppercase;
}

.badge-humor {
  background-color: #fee2e2;
  color: #dc2626; 
  padding: 6px 14px;
  border-radius: 50px;
  font-weight: 600;
  font-size: 0.75rem;
  border: 1px solid #fecaca;
}

.chapatin-content h2 {
  font-size: 2.8rem;
  color: #1e293b;
  margin-bottom: 20px;
  line-height: 1.1;
  font-weight: 800;
}

.main-description {
  font-size: 1.1rem;
  color: #334155;
  margin-bottom: 15px;
  line-height: 1.6;
}

.main-description strong {
  color: #2563eb; 
  font-weight: 700;
}

.sub-description {
  font-size: 1rem;
  color: #64748b;
  font-style: italic;
  margin-bottom: 35px;
  border-left: 4px solid #ef4444; 
  padding-left: 15px;
}

.trust-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 20px;
  margin-bottom: 40px;
  background: #ffffff;
  padding: 25px;
  border-radius: 16px;
  box-shadow: 0 10px 20px -5px rgba(37, 99, 235, 0.1); 
  border: 1px solid #e0ecff;
}

.trust-item {
  display: flex;
  align-items: flex-start;
  gap: 15px;
}

.trust-icon {
  width: 48px;
  height: 48px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 12px;
  flex-shrink: 0;
  transition: transform 0.2s ease;
}

.trust-item:hover .trust-icon {
  transform: scale(1.1);
}

.icon-blue {
  background-color: #eff6ff;
  color: #2563eb;
}

.icon-purple {
  background-color: #f3e8ff;
  color: #9333ea;
}

.icon-green {
  background-color: #dcfce7;
  color: #16a34a;
}

.trust-item div {
  display: flex;
  flex-direction: column;
}

.trust-item h4 {
  margin: 0 0 4px 0;
  font-size: 0.95rem;
  color: #1e293b;
  font-weight: 700;
}

.trust-item p {
  margin: 0;
  font-size: 0.8rem;
  color: #64748b;
  line-height: 1.3;
}

.cta-button-chapatin {
  background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
  color: white;
  padding: 14px 32px;
  border: none;
  border-radius: 8px; 
  font-size: 1.1rem;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 6px -1px rgba(220, 38, 38, 0.3);
  display: inline-flex;
  align-items: center;
  gap: 10px;
}

.cta-button-chapatin:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 15px -3px rgba(220, 38, 38, 0.4);
}

.disclaimer-text {
  font-size: 0.75rem;
  color: #94a3b8;
  margin-top: 15px;
  max-width: 90%;
}

.chapatin-image-wrapper {
  flex: 1;
  display: flex;
  justify-content: center;
  position: relative;
}

.blob-bg {
  position: absolute;
  width: 400px;
  height: 400px;
  background-color: #dbeafe; 
  border-radius: 46% 54% 50% 50% / 35% 44% 56% 65%;
  z-index: 1;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  animation: blob-pulse 8s infinite alternate;
}

@keyframes blob-pulse {
  0% { border-radius: 46% 54% 50% 50% / 35% 44% 56% 65%; transform: translate(-50%, -50%) scale(1); }
  100% { border-radius: 54% 46% 38% 62% / 63% 58% 42% 37%; transform: translate(-50%, -50%) scale(1.05); }
}

.chapatin-img {
  width: 100%;
  max-width: 450px;
  height: auto;
  z-index: 2;
  filter: drop-shadow(0 20px 25px rgba(37, 99, 235, 0.15));
  transition: transform 0.3s ease;
}

.chapatin-img:hover {
  transform: scale(1.02) rotate(1deg);
}

.floating-card {
  position: absolute;
  bottom: 30px;
  left: -20px;
  background: white;
  padding: 12px 20px;
  border-radius: 12px;
  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
  display: flex;
  align-items: center;
  gap: 15px;
  z-index: 3;
  border-left: 4px solid #10b981; 
  animation: float 4s ease-in-out infinite;
}

.check-icon-wrapper {
  background-color: #d1fae5;
  color: #059669;
  width: 32px;
  height: 32px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.floating-text strong {
  display: block;
  font-size: 0.9rem;
  color: #1e293b;
}

.floating-text span {
  font-size: 0.8rem;
  color: #64748b;
}

@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-10px); }
}

@media (max-width: 1024px) {
  .chapatin-section {
    padding: 60px 5%; 
  }
}

@media (max-width: 768px) {
  .chapatin-container {
    flex-direction: column-reverse; 
    gap: 40px;
    text-align: center;
  }

  .badge-wrapper {
    justify-content: center;
  }

  .sub-description {
    border-left: none; 
    border-top: 3px solid #ef4444; 
    padding-left: 0;
    padding-top: 15px;
  }

  .trust-grid {
    grid-template-columns: 1fr; 
    text-align: left;
  }

  .blob-bg {
    width: 280px;
    height: 280px;
  }

  .floating-card {
    left: 50%;
    transform: translateX(-50%);
    bottom: -20px;
    width: max-content;
    animation: none; 
  }
}
</file>

<file path="src/Styles/HowToUseSection.css">
.tutorial-section {
  padding: 80px 20px;
  background-color: #ffffff; 
  text-align: center;
}

.tutorial-container {
  max-width: 1200px;
  margin: 0 auto;
}

/* Header */
.tutorial-header {
  max-width: 700px;
  margin: 0 auto 60px auto;
}

.tutorial-badge {
  background-color: #f3f4f6;
  color: #4b5563;
  padding: 6px 16px;
  border-radius: 50px;
  font-size: 0.8rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.tutorial-header h2 {
  font-size: 2.5rem;
  color: #111827;
  margin-top: 15px;
  margin-bottom: 10px;
  font-weight: 800;
}

.tutorial-header p {
  font-size: 1.1rem;
  color: #6b7280;
}

/* Grid de Pasos */
.steps-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 40px;
}

.step-card {
  position: relative;
  background: #fff;
  padding: 40px 30px;
  border-radius: 20px;
  border: 1px solid #f3f4f6;
  transition: transform 0.3s ease;
}

.step-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 20px 40px -5px rgba(0, 0, 0, 0.05);
  border-color: #e5e7eb;
}

/* Número Gigante de Fondo (Estilo moderno) */
.step-number {
  position: absolute;
  top: 10px;
  right: 20px;
  font-size: 5rem;
  font-weight: 900;
  color: #f3f4f6;
  z-index: 0;
  pointer-events: none;
}

/* Iconos */
.step-icon-bg {
  width: 70px;
  height: 70px;
  border-radius: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 25px auto;
  position: relative;
  z-index: 1;
}

.step-icon-bg svg {
  z-index: 2;
}

.step-icon-bg.purple { background-color: #f5f3ff; color: #7c3aed; }
.step-icon-bg.blue { background-color: #eff6ff; color: #2563eb; }
.step-icon-bg.green { background-color: #ecfdf5; color: #059669; }

/* Textos de la tarjeta */
.step-card h3 {
  font-size: 1.4rem;
  color: #1f2937;
  margin-bottom: 15px;
  position: relative;
  z-index: 1;
}

.step-card p {
  font-size: 1rem;
  color: #6b7280;
  line-height: 1.6;
  position: relative;
  z-index: 1;
}

.step-card strong {
  color: #4b5563;
}

/* Mobile */
@media (max-width: 768px) {
  .tutorial-header h2 { font-size: 2rem; }
  .steps-grid { gap: 20px; }
}
</file>

<file path="src/Styles/LoaderStyles.css">
.loader-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background-color: #f0f4f8;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 99999;
}

.loader-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
}

.loader-spinner {
  color: #2563eb;
  animation: spin 1s linear infinite;
}

.loader-content p {
  color: #1e40af;
  font-family: 'Segoe UI', sans-serif;
  font-weight: 600;
  font-size: 1.1rem;
  margin: 0;
}

@keyframes spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}
</file>

<file path="src/Styles/ResetPasswordStyles.css">
.reset-container {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, #f0f9ff 0%, #dbeafe 100%);
  font-family: 'Segoe UI', sans-serif;
  padding: 20px;
}

.reset-box {
  background: white;
  padding: 40px;
  border-radius: 16px;
  box-shadow: 0 10px 25px rgba(37, 99, 235, 0.1);
  width: 100%;
  max-width: 400px;
  animation: fadeIn 0.4s ease-out;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.reset-header {
  text-align: center;
  margin-bottom: 30px;
}

.icon-wrapper {
  background-color: #eff6ff;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 15px auto;
}

.icon-lock {
  color: #2563eb;
}

.reset-header h2 {
  color: #1e3a8a;
  margin: 0 0 5px 0;
  font-size: 1.5rem;
}

.email-display {
  color: #64748b;
  font-size: 0.9rem;
  background-color: #f1f5f9;
  padding: 5px 10px;
  border-radius: 6px;
  display: inline-block;
  margin-top: 10px;
}

.input-group-reset {
  margin-bottom: 20px;
}

.input-group-reset label {
  display: block;
  margin-bottom: 8px;
  color: #334155;
  font-weight: 600;
  font-size: 0.9rem;
}

.password-wrapper {
  position: relative;
}

.input-group-reset input {
  width: 100%;
  padding: 12px;
  border: 1px solid #cbd5e1;
  border-radius: 8px;
  font-size: 1rem;
  transition: all 0.2s;
  box-sizing: border-box;
}

.input-group-reset input:focus {
  border-color: #2563eb;
  outline: none;
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

.toggle-btn {
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  color: #94a3b8;
  cursor: pointer;
  display: flex;
  align-items: center;
}

.toggle-btn:hover {
  color: #2563eb;
}

.btn-reset {
  width: 100%;
  padding: 14px;
  background-color: #2563eb;
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 1rem;
  font-weight: bold;
  cursor: pointer;
  transition: background 0.2s;
  margin-top: 10px;
}

.btn-reset:hover {
  background-color: #1d4ed8;
}

.btn-reset:disabled {
  background-color: #94a3b8;
  cursor: not-allowed;
}

.success-box {
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 15px;
}

.icon-success {
  color: #16a34a;
}

.redirect-text {
  color: #64748b;
  font-size: 0.9rem;
  margin-top: 20px;
}
</file>

<file path="src/tests/pages/AboutPage.test.jsx">
import { describe, it, expect, vi } from 'vitest'
import { render, screen, fireEvent } from '@testing-library/react'
import AboutPage from '../../pages/AboutPage'

const mockNavigate = vi.fn()

vi.mock('react-router-dom', () => ({
  useNavigate: () => mockNavigate,
}))

describe('AboutPage', () => {
  it('renderiza el título principal de la página', () => {
    render(<AboutPage />)

    const title = screen.getByText(/Cuidando tu salud con tecnología/i)
    expect(title).toBeInTheDocument()
  })

  it('navega a /signup al hacer click en el botón', () => {
    render(<AboutPage />)

    const button = screen.getByRole('button', {
      name: /Crear Cuenta Ahora/i,
    })

    fireEvent.click(button)

    expect(mockNavigate).toHaveBeenCalledWith('/signup')
  })
})
</file>

<file path="src/tests/pages/AdminPage.test.jsx">
import { describe, it, expect, vi } from 'vitest'
import { render, screen, fireEvent } from '@testing-library/react'
import AdminPage from '../../pages/AdminPage'

// Mockeamos los componentes hijos para probar solo la estructura de la página
// y no la lógica interna de las tablas o estadísticas.
vi.mock('../../components/Admin/AdminStats', () => ({
  default: () => <div>AdminStats Mock</div>,
}))

vi.mock('../../components/Admin/UserTable', () => ({
  default: () => <div>UserTable Mock</div>,
}))

vi.mock('../../components/Admin/RegisterSpecialistModal', () => ({
  default: ({ onClose }) => (
    <div>
      <p>RegisterSpecialistModal Mock</p>
      <button onClick={onClose}>Cerrar Modal</button>
    </div>
  ),
}))

vi.mock('lucide-react', () => ({
  UserPlus: () => <span>Icon</span>,
}))

describe('AdminPage', () => {
  it('renderiza el título y la sección de usuarios', () => {
    render(<AdminPage />)

    expect(
      screen.getByText(/Panel de Control/i)
    ).toBeInTheDocument()

    expect(
      screen.getByText(/Lista de Usuarios/i)
    ).toBeInTheDocument()
  })

  it('muestra el modal al hacer click en "Nuevo Especialista"', () => {
    render(<AdminPage />)

    const button = screen.getByRole('button', {
      name: /Nuevo Especialista/i,
    })

    fireEvent.click(button)

    expect(
      screen.getByText(/RegisterSpecialistModal Mock/i)
    ).toBeInTheDocument()
  })
})
</file>

<file path="src/tests/pages/Dashboard.test.jsx">
import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import Dashboard from '../../pages/Dashboard';

const mockNavigate = vi.fn();

vi.mock('react-router-dom', () => ({
  useNavigate: () => mockNavigate,
}));

vi.mock('../../components/Dashboard/GlucoseCard', () => ({
  default: () => <div data-testid="glucose-card">GlucoseCard Mock</div>,
}));

vi.mock('../../components/Dashboard/PressureCard', () => ({
  default: () => <div data-testid="pressure-card">PressureCard Mock</div>,
}));

vi.mock('react-icons/fa', () => ({
  FaPlusCircle: () => <span>PlusIcon</span>,
  FaChartBar: () => <span>ChartIcon</span>,
}));

describe('Dashboard', () => {

  const fetchMock = vi.fn();
  global.fetch = fetchMock;

  beforeEach(() => {
    localStorage.setItem('user_id', '123');
    vi.clearAllMocks(); 
  });

  afterEach(() => {
    localStorage.clear();
  });

  it('renderiza el título y hace la petición de datos inicial', async () => {
    fetchMock.mockResolvedValueOnce({
      ok: true,
      json: async () => ({
        glucose: { value: 100, date: '2024-01-01' },
        pressure: { systolic: 120, diastolic: 80 },
      }),
    });

    render(<Dashboard />);

    expect(screen.getByText(/Panel de Control/i)).toBeInTheDocument();
    expect(screen.getByTestId('glucose-card')).toBeInTheDocument();
    expect(screen.getByTestId('pressure-card')).toBeInTheDocument();

    await waitFor(() => {
      expect(fetchMock).toHaveBeenCalledWith(
        expect.stringContaining('/api/registros/dashboard/123')
      );
    });
  });

  it('navega a registro e historial al hacer click en las tarjetas', () => {
    fetchMock.mockResolvedValueOnce({
        ok: true,
        json: async () => ({}),
    });

    render(<Dashboard />);

    fireEvent.click(screen.getByText(/Registrar Información/i));
    expect(mockNavigate).toHaveBeenCalledWith('/registro-salud');

    fireEvent.click(screen.getByText(/Ver Historial/i));
    expect(mockNavigate).toHaveBeenCalledWith('/historial');
  });
});
</file>

<file path="src/tests/pages/HistoryPage.test.jsx">
import { describe, it, expect, vi, beforeEach } from 'vitest';
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import HistoryPage from '../../pages/HistoryPage';
import axios from 'axios';
import { descargarHistorial } from '../../services/downloadService';

vi.mock('axios');
vi.mock('../../services/downloadService', () => ({
  descargarHistorial: vi.fn(),
}));

vi.mock('../../utils/formatDate', () => ({
  formatDateLong: () => '01 de Enero 2024',
}));

describe('HistoryPage', () => {
  beforeEach(() => {
    localStorage.setItem('user_id', '123');
    vi.clearAllMocks(); 
  });

  it('renderiza el título y mensaje cuando no hay registros', async () => {
    axios.get.mockResolvedValueOnce({ data: [] });

    render(<HistoryPage />);

    expect(screen.getByText(/Historial de Mediciones/i)).toBeInTheDocument();

    await waitFor(() => {
      expect(screen.getByText(/No hay registros disponibles/i)).toBeInTheDocument();
    });
  });

  it('renderiza registros cuando la API devuelve datos', async () => {
    const mockData = [
      { date: '2024-01-01', glucose: 100, systolic: 120, diastolic: 80 }
    ];
    axios.get.mockResolvedValueOnce({ data: mockData });

    render(<HistoryPage />);

    await waitFor(() => {
      expect(screen.getByText(/Glucosa: 100 mg\/dL/i)).toBeInTheDocument();
    });
  });

  it('llama a descargarHistorial al hacer click en los botones', async () => {
    axios.get.mockResolvedValueOnce({ data: [] });

    render(<HistoryPage />);

    fireEvent.click(screen.getByRole('button', { name: /Descargar PDF/i }));
    expect(descargarHistorial).toHaveBeenCalledWith('123', 'pdf');

    fireEvent.click(screen.getByRole('button', { name: /Descargar CSV/i }));
    expect(descargarHistorial).toHaveBeenCalledWith('123', 'csv');
  });
});
</file>

<file path="src/tests/pages/Login.test.jsx">
import { describe, it, expect, vi, beforeEach } from 'vitest';
import { render, screen, fireEvent } from '@testing-library/react';
import Login from '../../pages/LoginPage'; 

const mockNavigate = vi.fn();

vi.mock('react-router-dom', () => ({
  useNavigate: () => mockNavigate,
  Link: ({ children }) => <a href="#">{children}</a>, 
}));

vi.mock('../../services/AuthService', () => ({
  requestPublicPasswordReset: vi.fn(),
  getUserProfile: vi.fn(),
}));

vi.mock('axios', () => ({
  default: {
    post: vi.fn(),
  },
}));

vi.mock('../../assets/logo.png', () => ({
  default: 'logo.png',
}));

describe('Login Page', () => {
  beforeEach(() => {
    vi.clearAllMocks();
    localStorage.clear(); 
  });

  it('renderiza el formulario de login correctamente', () => {
    render(<Login />);

    const logo = screen.getByRole('img', { name: /Salud Al Día/i });
    expect(logo).toBeInTheDocument();

    expect(screen.getByPlaceholderText(/ejemplo@correo.com/i)).toBeInTheDocument();
    expect(screen.getByPlaceholderText(/••••••••/i)).toBeInTheDocument();

    expect(screen.getByRole('button', { name: /Entrar al Panel/i })).toBeInTheDocument();
  });

  it('muestra el modal de recuperación al hacer clic en "¿Olvidaste tu contraseña?"', () => {
    render(<Login />);

    // Nos aseguramos que al principio NO esté visible
    expect(screen.queryByText(/Recuperar Contraseña/i)).not.toBeInTheDocument();

    fireEvent.click(
      screen.getByRole('button', { name: /¿Olvidaste tu contraseña\?/i })
    );

    // Ahora sí debería aparecer
    expect(screen.getByText(/Recuperar Contraseña/i)).toBeInTheDocument();
    
    expect(screen.getByPlaceholderText(/tu@correo.com/i)).toBeInTheDocument();
  });
});
</file>

<file path="src/tests/pages/MedicalRecords.test.jsx">
import { describe, it, expect, vi, beforeEach } from 'vitest';
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import MedicalRecords from '../../pages/MedicalRecords';
import { createMedicalRecord } from '../../services/MedicalService';

const mockNavigate = vi.fn();

vi.mock('react-router-dom', () => ({
  useNavigate: () => mockNavigate,
}));

vi.mock('../../services/MedicalService', () => ({
  createMedicalRecord: vi.fn(),
}));

vi.mock('../../assets/logo.png', () => ({
  default: 'logo-mock',
}));

describe('MedicalRecords', () => {
  beforeEach(() => {
    localStorage.clear();
    vi.clearAllMocks();
    // Silenciamos el alert para que no falle el test al simular errores
    vi.spyOn(window, 'alert').mockImplementation(() => {});
  });

  it('renderiza el formulario de ficha médica', () => {
    localStorage.setItem('user_id', '123');
    localStorage.setItem('token', 'token-test');

    render(<MedicalRecords />);

    expect(screen.getByText(/Ficha Médica Inicial/i)).toBeInTheDocument();
    expect(screen.getByPlaceholderText(/Ej: 170/i)).toBeInTheDocument();
    expect(screen.getByText(/Autorizo el tratamiento de mis datos/i)).toBeInTheDocument();
  });

  it('redirige a login si no existe sesión', () => {
    render(<MedicalRecords />);
    expect(mockNavigate).toHaveBeenCalledWith('/login');
  });

  it('deshabilita el botón si el formulario está incompleto', () => {
    localStorage.setItem('user_id', '123');
    localStorage.setItem('token', 'token-test');

    render(<MedicalRecords />);

    const submitButton = screen.getByRole('button', { name: /Finalizar y Entrar/i });
    expect(submitButton).toBeDisabled();
  });

  it('habilita el botón y envía datos correctamente formateados', async () => {
    localStorage.setItem('user_id', '123');
    localStorage.setItem('token', 'token-test');
    
    createMedicalRecord.mockResolvedValueOnce({});

    render(<MedicalRecords />);

    fireEvent.change(screen.getByRole('combobox'), { target: { value: 'O+' } });
    fireEvent.change(screen.getByPlaceholderText(/Ej: 170/i), { target: { value: '175' } });
    fireEvent.change(screen.getByPlaceholderText(/Ej: 75/i), { target: { value: '80' } });
    fireEvent.change(screen.getByPlaceholderText(/Nombre completo/i), { target: { value: 'Mamá' } });
    
    // El teléfono debe empezar con 9 para pasar la validación interna
    const phoneInput = screen.getByPlaceholderText(/9 1234 5678/i);
    fireEvent.change(phoneInput, { target: { value: '987654321' } });

    const checkbox = screen.getByRole('checkbox');
    fireEvent.click(checkbox);

    const submitButton = screen.getByRole('button', { name: /Finalizar y Entrar/i });
    expect(submitButton).toBeEnabled();

    fireEvent.click(submitButton);

    await waitFor(() => {
        // Verificamos que se agregue el prefijo +56 automáticamente antes de enviar
        expect(createMedicalRecord).toHaveBeenCalledWith(expect.objectContaining({
            blood_type: 'O+',
            height: '175',
            initial_weight: '80',
            emergency_contact_name: 'Mamá',
            emergency_contact_phone: '+56987654321', 
            user_id: '123'
        }));
    });

    expect(mockNavigate).toHaveBeenCalledWith('/dashboard');
  });
});
</file>

<file path="src/tests/pages/PatientFile.test.jsx">
import { render, screen, waitFor } from "@testing-library/react";
import { describe, it, expect, vi, beforeEach } from "vitest";
import PatientFile from "../../pages/PatientFile";
import {
  getMedicalRecord,
  getPatientDashboardData,
  getPatientHistory,
  getPatientById,
} from "../../services/SpecialistService";

// Mockeamos el router para simular que estamos visitando el perfil del usuario "123"
vi.mock("react-router-dom", () => ({
  useParams: () => ({ id: "123" }),
  useNavigate: () => vi.fn(),
}));

// Mockeamos todos los servicios para no depender del backend real
vi.mock("../../services/SpecialistService", () => ({
  getMedicalRecord: vi.fn(),
  getPatientDashboardData: vi.fn(),
  getPatientHistory: vi.fn(),
  getPatientById: vi.fn(),
  getDownloadUrl: vi.fn(() => "http://fake-url/pdf"),
}));

// Mockeamos las tarjetas del dashboard para no probar su lógica interna aquí
vi.mock("../../components/Dashboard/GlucoseCard", () => ({
  default: () => <div data-testid="glucose-card">GlucoseCard</div>,
}));

vi.mock("../../components/Dashboard/PressureCard", () => ({
  default: () => <div data-testid="pressure-card">PressureCard</div>,
}));

describe("PatientFile", () => {
  beforeEach(() => {
    vi.clearAllMocks();
    localStorage.setItem("token", "fake-token");
  });

  it("muestra el mensaje de carga al iniciar", () => {
    // Dejamos las promesas pendientes para que el componente se quede en estado "loading"
    getMedicalRecord.mockReturnValue(new Promise(() => {}));
    getPatientById.mockReturnValue(new Promise(() => {}));

    render(<PatientFile />);

    expect(screen.getByText(/Cargando información clínica/i)).toBeInTheDocument();
  });

  it("muestra mensaje de ficha médica inexistente pero carga los datos básicos", async () => {
    // Caso: El usuario existe (profile) pero no tiene ficha médica (null)
    getMedicalRecord.mockResolvedValueOnce(null);
    getPatientDashboardData.mockResolvedValueOnce({});
    getPatientHistory.mockResolvedValueOnce([]);
    getPatientById.mockResolvedValueOnce({
      first_names: "Maria",
      last_names: "Gonzalez",
      rut: "11.222.333-K"
    });

    render(<PatientFile />);

    await waitFor(() => {
      // Esperamos que se vaya el loader
      expect(screen.queryByText(/Cargando información/i)).not.toBeInTheDocument();
    });

    // Verificamos que cargó el nombre aunque no tenga ficha
    expect(screen.getByText(/Paciente: Maria Gonzalez/i)).toBeInTheDocument();
    
    // Y que muestre el aviso de que falta la ficha
    expect(screen.getByText(/Ficha Médica Inexistente/i)).toBeInTheDocument();
  });

  it("renderiza la ficha clínica completa del paciente cuando hay datos", async () => {
    // Simulamos que la API responde con todo perfecto
    getMedicalRecord.mockResolvedValueOnce({
      blood_type: "A+",
      allergies: "Polen",
      chronic_diseases: "Asma",
      initial_weight: 80,
      height: 180,
      emergency_contact_name: "Pedro",
      emergency_contact_phone: "+56912345678"
    });

    getPatientDashboardData.mockResolvedValueOnce({
      glucose: { value: 110, date: new Date() },
      pressure: { systolic: 120, diastolic: 80, date: new Date() },
    });

    getPatientHistory.mockResolvedValueOnce([
        { date: '2024-01-01', glucose: 100, systolic: 120, diastolic: 80 }
    ]);
    
    getPatientById.mockResolvedValueOnce({
      first_names: "Juan",
      last_names: "Pérez",
      rut: "12.345.678-9",
    });

    render(<PatientFile />);

    await waitFor(() => {
      expect(screen.getByText(/Paciente: Juan Pérez/i)).toBeInTheDocument();
    });

    // Revisamos que pinte los datos médicos
    expect(screen.getByText("A+")).toBeInTheDocument();
    expect(screen.getByText("Asma")).toBeInTheDocument();
    expect(screen.getByText("80 kg")).toBeInTheDocument();
    
    // Revisamos que las tarjetas y el contacto estén ahí
    expect(screen.getByTestId("glucose-card")).toBeInTheDocument();
    expect(screen.getByText("Pedro")).toBeInTheDocument();
  });
});
</file>

<file path="src/tests/pages/ProfilePage.test.jsx">
import { describe, it, expect, vi, beforeEach } from 'vitest';
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import ProfilePage from '../../pages/ProfilePage';
import { getMedicalRecord, updateMedicalRecord } from '../../services/MedicalService';
import { requestAccountDeletion } from '../../services/AdminService';

const mockNavigate = vi.fn();

vi.mock('react-router-dom', () => ({
  useNavigate: () => mockNavigate,
  Link: ({ children }) => <a href="#">{children}</a>,
}));

vi.mock('../../services/MedicalService', () => ({
  getMedicalRecord: vi.fn(),
  updateMedicalRecord: vi.fn(),
}));

vi.mock('../../services/AdminService', () => ({
  requestAccountDeletion: vi.fn(),
}));

vi.mock('lucide-react', () => ({
  User: () => <span>Icon</span>,
  Ruler: () => <span>Icon</span>,
  AlertTriangle: () => <span>Icon</span>,
  Phone: () => <span>Icon</span>,
  AlertCircle: () => <span>Icon</span>,
  Save: () => <span>Icon</span>,
  X: () => <span>Icon</span>,
}));

describe('ProfilePage', () => {
  beforeEach(() => {
    vi.clearAllMocks();
    localStorage.clear();
    vi.spyOn(window, 'alert').mockImplementation(() => {});
  });

  it('muestra el mensaje de carga inicialmente', () => {
    getMedicalRecord.mockReturnValue(new Promise(() => {}));
    
    render(<ProfilePage />);
    expect(screen.getByText(/Cargando perfil.../i)).toBeInTheDocument();
  });

  it('muestra mensaje cuando no existe ficha médica', async () => {
    localStorage.setItem('user_id', '123');
    localStorage.setItem('user_name', 'Juan Pérez');
    getMedicalRecord.mockResolvedValueOnce(null);

    render(<ProfilePage />);

    expect(await screen.findByText(/Ficha médica no encontrada/i)).toBeInTheDocument();
    expect(screen.getByText(/Crear Ficha Médica/i)).toBeInTheDocument();
  });

  it('renderiza la información del perfil médico', async () => {
    localStorage.setItem('user_id', '123');
    localStorage.setItem('user_name', 'Juan Pérez');
    
    getMedicalRecord.mockResolvedValueOnce({
      height: 170,
      initial_weight: 75,
      blood_type: 'O+',
      allergies: 'Ninguna',
      chronic_diseases: 'Ninguna',
      emergency_contact_name: 'María',
      emergency_contact_phone: '+56912345678',
    });

    render(<ProfilePage />);

    expect(await screen.findByText(/Juan Pérez/i)).toBeInTheDocument();
    expect(screen.getByText(/Datos Corporales/i)).toBeInTheDocument();
    expect(screen.getByText('170 cm')).toBeInTheDocument();
    expect(screen.getByText('María')).toBeInTheDocument();
  });

  it('entra en modo edición y muestra inputs', async () => {
    localStorage.setItem('user_id', '123');
    getMedicalRecord.mockResolvedValueOnce({ height: 170, initial_weight: 75 });

    render(<ProfilePage />);
    
    await waitFor(() => expect(screen.getByText('170 cm')).toBeInTheDocument());

    fireEvent.click(screen.getByText('Editar'));

    const saveButton = await screen.findByText(/Guardar Cambios/i);
    expect(saveButton).toBeInTheDocument();

    const numberInputs = screen.getAllByRole('spinbutton');
    expect(numberInputs.length).toBeGreaterThanOrEqual(1); 
    
    expect(numberInputs[0]).toHaveValue(170); 
  });

  it('abre el modal de eliminación de cuenta', async () => {
    localStorage.setItem('user_id', '123');
    getMedicalRecord.mockResolvedValueOnce({}); 

    render(<ProfilePage />);
    await waitFor(() => screen.getByText(/Información Médica/i));

    fireEvent.click(screen.getByText(/Solicitar Eliminación/i));

    expect(screen.getByText(/¿Confirmar solicitud?/i)).toBeInTheDocument();
  });
});
</file>

<file path="src/tests/pages/RegisterPage.test.jsx">
import { describe, it, expect, vi, beforeEach } from 'vitest';
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import axios from 'axios';
import RegisterPage from '../../pages/RegisterPage';

const mockNavigate = vi.fn();

vi.mock('react-router-dom', () => ({
  useNavigate: () => mockNavigate,
  Link: ({ children, to }) => <a href={to}>{children}</a>,
}));

vi.mock('axios', () => ({
  default: {
    post: vi.fn(),
  },
}));

vi.mock('../../assets/logo.png', () => ({
  default: 'logo-mock',
}));

// Mockeamos las validaciones para tener control total en el test
vi.mock('../../utils/validations', () => ({
  formatRut: (val) => val, 
  isValidEmail: (email) => email === 'test@mail.com', // Solo este email pasará
}));

describe('RegisterPage', () => {
  beforeEach(() => {
    vi.clearAllMocks();
    vi.spyOn(window, 'alert').mockImplementation(() => {});
  });

  it('renderiza el formulario de registro correctamente', () => {
    render(<RegisterPage />);

    expect(screen.getByPlaceholderText(/12\.345\.678-9/i)).toBeInTheDocument();
    expect(screen.getByPlaceholderText(/juan ignacio/i)).toBeInTheDocument();
    expect(screen.getByRole('button', { name: /Crear Cuenta/i })).toBeInTheDocument();
  });

  it('muestra error y no envía datos si el email es inválido', async () => {
    render(<RegisterPage />);

    fireEvent.change(screen.getByPlaceholderText(/12\.345\.678-9/i), { target: { value: '12345678-9' } });
    fireEvent.change(screen.getByPlaceholderText(/juan ignacio/i), { target: { value: 'Juan' } });
    fireEvent.change(screen.getByPlaceholderText(/pérez soto/i), { target: { value: 'Perez' } });
    fireEvent.change(screen.getByPlaceholderText(/••••••••/i), { target: { value: '123456' } });
    
    // Probamos con un email que nuestro mock rechazará
    const emailInput = screen.getByPlaceholderText(/correo@ejemplo.com/i);
    fireEvent.change(emailInput, { target: { value: 'malo@prueba.com' } });

    fireEvent.click(screen.getByRole('button', { name: /Crear Cuenta/i }));

    expect(await screen.findByText(/El correo electrónico no es válido/i)).toBeInTheDocument();
    
    expect(axios.post).not.toHaveBeenCalled();
  });

  it('envía el formulario y redirige si todo es correcto', async () => {
    axios.post.mockResolvedValueOnce({
      data: {
        user: { id: '123' },
        session: { access_token: 'fake-token' }
      }
    });

    render(<RegisterPage />);

    fireEvent.change(screen.getByPlaceholderText(/12\.345\.678-9/i), { target: { value: '12.345.678-9' } });
    fireEvent.change(screen.getByPlaceholderText(/juan ignacio/i), { target: { value: 'Juan' } });
    fireEvent.change(screen.getByPlaceholderText(/pérez soto/i), { target: { value: 'Perez' } });
    fireEvent.change(screen.getByPlaceholderText(/••••••••/i), { target: { value: '123456' } });
    
    // Usamos el email válido definido en el mock
    fireEvent.change(screen.getByPlaceholderText(/correo@ejemplo.com/i), { target: { value: 'test@mail.com' } });

    fireEvent.click(screen.getByRole('button', { name: /Crear Cuenta/i }));

    await waitFor(() => {
        expect(axios.post).toHaveBeenCalled();
    });

    expect(mockNavigate).toHaveBeenCalledWith('/ficha-medica');
  });
});
</file>

<file path="src/tests/pages/ResetPassword.test.jsx">
import { describe, it, expect, vi, beforeEach } from 'vitest';
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import { MemoryRouter, Route, Routes } from 'react-router-dom';
import ResetPassword from '../../pages/ResetPassword';
import * as AdminService from '../../services/AdminService';

const mockNavigate = vi.fn();

vi.mock('react-router-dom', async () => {
  const actual = await vi.importActual('react-router-dom');
  return {
    ...actual,
    useNavigate: () => mockNavigate,
  };
});

vi.spyOn(AdminService, 'updatePasswordFinal');

describe('ResetPassword Page', () => {

  beforeEach(() => {
    vi.clearAllMocks();
    vi.spyOn(window, 'alert').mockImplementation(() => {});
  });

  const renderWithEmail = () => {
    render(
      <MemoryRouter initialEntries={['/reset?email=test@mail.com']}>
        <Routes>
          <Route path="/reset" element={<ResetPassword />} />
        </Routes>
      </MemoryRouter>
    );
  };

  it('renderiza el formulario con el email obtenido de la URL', () => {
    renderWithEmail();

    expect(screen.getByText(/Restablecer Contraseña/i)).toBeInTheDocument();
    expect(screen.getByText(/cuenta: test@mail.com/i)).toBeInTheDocument();
    
    expect(screen.getByPlaceholderText(/Mínimo 6 caracteres/i)).toBeInTheDocument();
    expect(screen.getByPlaceholderText(/Repite la contraseña/i)).toBeInTheDocument();
  });

  it('redirige al login si no hay email en la URL', () => {
    render(
      <MemoryRouter initialEntries={['/reset']}>
         <Routes>
          <Route path="/reset" element={<ResetPassword />} />
        </Routes>
      </MemoryRouter>
    );
    
    expect(mockNavigate).toHaveBeenCalledWith('/login');
  });

  it('no envía datos si las contraseñas no coinciden', () => {
    renderWithEmail();

    fireEvent.change(screen.getByPlaceholderText(/Mínimo 6 caracteres/i), { target: { value: '123456' } });
    fireEvent.change(screen.getByPlaceholderText(/Repite la contraseña/i), { target: { value: '654321' } });

    fireEvent.click(screen.getByRole('button', { name: /Cambiar Contraseña/i }));

    expect(AdminService.updatePasswordFinal).not.toHaveBeenCalled();
    expect(window.alert).toHaveBeenCalledWith("Las contraseñas no coinciden");
  });

  it('muestra mensaje de éxito y redirige cuando la contraseña se actualiza', async () => {
    AdminService.updatePasswordFinal.mockResolvedValue({ success: true });

    renderWithEmail();

    fireEvent.change(screen.getByPlaceholderText(/Mínimo 6 caracteres/i), { target: { value: '123456' } });
    fireEvent.change(screen.getByPlaceholderText(/Repite la contraseña/i), { target: { value: '123456' } });

    fireEvent.click(screen.getByRole('button', { name: /Cambiar Contraseña/i }));

    await waitFor(() => {
      expect(screen.getByText(/Contraseña Actualizada/i)).toBeInTheDocument();
    });

    expect(AdminService.updatePasswordFinal).toHaveBeenCalledWith('test@mail.com', '123456');
  });
});
</file>

<file path="src/tests/pages/SpecialistDashboard.test.jsx">
import { describe, it, expect, vi, beforeEach } from 'vitest';
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import { MemoryRouter } from 'react-router-dom';
import SpecialistDashboard from '../../pages/SpecialistDashboard';
import { getPatients, getPatientDashboardData } from '../../services/SpecialistService';

const mockNavigate = vi.fn();

vi.mock('react-router-dom', async () => {
  const actual = await vi.importActual('react-router-dom');
  return {
    ...actual,
    useNavigate: () => mockNavigate,
  };
});

vi.mock('../../services/SpecialistService', () => ({
  getPatients: vi.fn(),
  getPatientDashboardData: vi.fn(),
}));

vi.mock('lucide-react', () => ({
  Search: () => <span data-testid="search-icon">Search</span>,
  FileText: () => <span>File</span>,
  User: () => <span>User</span>,
}));

describe('SpecialistDashboard', () => {
  
  beforeEach(() => {
    vi.clearAllMocks();
  });

  const mockPatients = [
    { id: 1, first_names: 'Juan', last_names: 'Pérez', rut: '11.111.111-1' },
    { id: 2, first_names: 'Ana', last_names: 'Gómez', rut: '22.222.222-2' },
  ];

  it('renderiza el panel y muestra el título', async () => {
    getPatients.mockResolvedValue([]);
    
    render(
      <MemoryRouter>
        <SpecialistDashboard />
      </MemoryRouter>
    );

    expect(screen.getByText(/Panel de Control Medico/i)).toBeInTheDocument();
    expect(screen.getByText(/Monitoreo de pacientes/i)).toBeInTheDocument();
  });

  it('carga y muestra la lista de pacientes', async () => {
    getPatients.mockResolvedValue(mockPatients);
    
    getPatientDashboardData.mockResolvedValue({
      glucose: { value: 100, date: '2024-01-01' },
      pressure: { systolic: 120, diastolic: 80, date: '2024-01-01' },
    });

    render(
      <MemoryRouter>
        <SpecialistDashboard />
      </MemoryRouter>
    );

    await waitFor(() => {
      expect(screen.getByText(/Juan Pérez/i)).toBeInTheDocument();
      expect(screen.getByText(/Ana Gómez/i)).toBeInTheDocument();
    });
  });

  it('filtra pacientes en estado crítico (Alertas)', async () => {
    getPatients.mockResolvedValue(mockPatients);

    getPatientDashboardData.mockImplementation(async (id) => {
      if (id === 1) {
        return { 
            glucose: { value: 180, date: '2024-01-01' }, // Crítico
            pressure: { systolic: 150, diastolic: 95 } 
        };
      }
      return { 
          glucose: { value: 90, date: '2024-01-01' }, // Estable
          pressure: { systolic: 120, diastolic: 80 } 
      };
    });

    render(
      <MemoryRouter>
        <SpecialistDashboard />
      </MemoryRouter>
    );

    await waitFor(() => expect(screen.getByText(/Juan Pérez/i)).toBeInTheDocument());

    fireEvent.click(screen.getByRole('button', { name: /Alertas/i }));

    expect(screen.getByText(/Juan Pérez/i)).toBeInTheDocument();
    expect(screen.queryByText(/Ana Gómez/i)).not.toBeInTheDocument();
  });

  it('filtra pacientes por nombre en el buscador', async () => {
    getPatients.mockResolvedValue(mockPatients);
    getPatientDashboardData.mockResolvedValue({ glucose: {}, pressure: {} });

    render(
      <MemoryRouter>
        <SpecialistDashboard />
      </MemoryRouter>
    );

    await waitFor(() => expect(screen.getByText(/Juan Pérez/i)).toBeInTheDocument());

    const searchInput = screen.getByPlaceholderText(/Buscar paciente/i);
    fireEvent.change(searchInput, { target: { value: 'Ana' } });

    expect(screen.getByText(/Ana Gómez/i)).toBeInTheDocument();
    expect(screen.queryByText(/Juan Pérez/i)).not.toBeInTheDocument();
  });

  it('navega a la ficha del paciente al hacer click en "Ver Ficha"', async () => {
    getPatients.mockResolvedValue([mockPatients[0]]); // Solo Juan
    getPatientDashboardData.mockResolvedValue({});

    render(
      <MemoryRouter>
        <SpecialistDashboard />
      </MemoryRouter>
    );

    await waitFor(() => expect(screen.getByText(/Juan Pérez/i)).toBeInTheDocument());

    fireEvent.click(screen.getByRole('button', { name: /Ver Ficha/i }));

    expect(mockNavigate).toHaveBeenCalledWith('/paciente/1');
  });
});
</file>

<file path="src/utils/formatDate.js">
export function formatDateLong(dateString) {
  if (!dateString) return "";

  const date = new Date(dateString);

  const fecha = date.toLocaleDateString("es-CL", {
    weekday: "long",
    day: "2-digit",
    month: "long",
  });

  const hora24 = date.getHours().toString().padStart(2, "0");
  const minutos = date.getMinutes().toString().padStart(2, "0");

  const ampm = date.getHours() < 12 ? "am" : "pm";

  return `${fecha} · ${hora24}:${minutos} ${ampm}`
    .replace(/^./, c => c.toUpperCase());
}
</file>

<file path="src/utils/formatDateDownload.js">
export function formatDateDownload(dateString) {
  if (!dateString) return "";

  const date = new Date(dateString);

  const fecha = date.toLocaleDateString("es-CL", {
    weekday: "long",
    day: "2-digit",
    month: "long",
    year: "numeric",
  });

  const hora = date.getHours().toString().padStart(2, "0");
  const minutos = date.getMinutes().toString().padStart(2, "0");
  const ampm = date.getHours() < 12 ? "am" : "pm";

  return `${fecha} · ${hora}:${minutos} ${ampm}`
    .replace(/^./, c => c.toUpperCase());
}
</file>

<file path="src/utils/validations.js">
export const formatRut = (rut) => {
  if (!rut) return "";
  const value = rut.replace(/[^0-9kK]/g, "");
  if (value.length <= 1) return value;
  
  const body = value.slice(0, -1);
  const dv = value.slice(-1).toUpperCase();
  const formattedBody = body.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
  
  return `${formattedBody}-${dv}`;
};

export const isValidEmail = (email) => {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return emailRegex.test(email);
};
</file>

<file path="vite.config.js">
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  test: {
    environment: 'jsdom',
    globals: true,
    setupFiles: './src/setupTests.js',
  },
})
</file>

<file path="README.md">
# Frontend - Salud Al Día 

Esta es la interfaz de usuario de **Salud Al Día**, una plataforma web moderna desarrollada con **React** y **Vite**. Permite a los usuarios gestionar su salud mediante un flujo de registro, autenticación y creación de fichas médicas detalladas.

##  Tecnologías y Herramientas

* **React (Vite)**: Framework principal enfocado en el rendimiento y velocidad de desarrollo.
* **Axios**: Cliente HTTP para la comunicación con el microservicio de usuarios.
* **React Router**: Gestión de navegación entre páginas (SPA).
* **CSS3**: Estilos personalizados organizados en la carpeta `/Styles`.

## ⚙️ Configuración del Entorno

Para que la aplicación funcione correctamente, debe conectarse al Backend mediante variables de entorno.

### Desarrollo Local (`.env`):
Crea un archivo llamado `.env` en la raíz del proyecto:
```env
VITE_API_URL=http://localhost:3000
Producción (Railway):
Configura estas variables en el panel de Railway para conectar con el servidor en vivo:

VITE_API_URL: https://ms-users-service-salud-production.up.railway.app.

 Estructura de Rutas y Navegación
El flujo de usuario está diseñado de forma lógica:

/signup: Formulario de registro de nuevos pacientes.

/login: Acceso para usuarios registrados.

/ficha-medica: Formulario inicial de salud (se requiere registro previo).

/Dashboard: Panel principal de control del usuario.

 Instalación y Uso
Clonar el repositorio:

Bash

git clone [https://github.com/victor99a/front-salud-al-dia.git](https://github.com/victor99a/front-salud-al-dia.git)
Instalar dependencias:

Bash

npm install
Ejecutar en modo desarrollo:

Bash

npm run dev
 Notas de Despliegue en Railway
Target Port: La aplicación debe escuchar en el puerto 4173 (Vite Preview) para que el dominio público funcione.

URL Pública: https://front-salud-al-dia-production.up.railway.app.

Importante: Se debe respetar estrictamente el uso de mayúsculas en las rutas de carpetas (ej: /Styles/) para evitar errores de compilación en Linux/Railway.
</file>

<file path="src/Styles/ChatWidgetStyles.css">
.chat-container {
  position: fixed !important;
  bottom: 30px !important;
  right: 30px !important;
  z-index: 999999 !important;
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  display: flex;
  flex-direction: column;
  align-items: flex-end;
}

.chat-button {
  width: 70px;
  height: 70px;
  border-radius: 50%;
  background: linear-gradient(135deg, #22c55e, #16a34a);
  color: white;
  border: none;
  box-shadow: 0 4px 20px rgba(34, 197, 94, 0.4);
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  display: flex;
  align-items: center;
  justify-content: center;
  outline: none;
  position: relative;
  animation: pulse-heartbeat 2s infinite;
}

.chat-button:hover {
  transform: scale(1.05);
  background: linear-gradient(135deg, #4ade80, #22c55e);
}

.chat-button.open {
  background: #334155;
  transform: rotate(90deg);
  animation: none;
  box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}

.notification-dot {
  position: absolute;
  top: 2px;
  right: 2px;
  width: 15px;
  height: 15px;
  background-color: #2563eb;
  border: 2px solid white;
  border-radius: 50%;
  box-shadow: 0 0 0 1px rgba(0,0,0,0.1);
}

@keyframes pulse-heartbeat {
  0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
  50% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
  100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
}

.chat-window {
  position: absolute;
  bottom: 95px;
  right: 0;
  width: 380px;
  max-width: 90vw;
  height: 600px;
  max-height: 75vh;
  background: #ffffff;
  border-radius: 20px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  border: 1px solid #e2e8f0;
  animation: chatFadeIn 0.25s ease-out;
  transform-origin: bottom right;
}

@keyframes chatFadeIn {
  from { opacity: 0; transform: scale(0.9); }
  to { opacity: 1; transform: scale(1); }
}

.chat-header {
  background: linear-gradient(135deg, #1e40af, #2563eb);
  color: white;
  padding: 16px 20px;
}

.header-info {
  display: flex;
  align-items: center;
  gap: 12px;
}

.bot-avatar-container {
  width: 44px;
  height: 44px;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(5px);
  border: 2px solid rgba(255,255,255,0.3);
}

.bot-avatar-icon {
  color: #ffffff;
  stroke-width: 2px;
}

.bot-name {
  margin: 0;
  font-size: 1.05rem;
  font-weight: 700;
}

.online-indicator {
  font-size: 0.85rem;
  color: #bfdbfe;
  display: flex;
  align-items: center;
}

.status-icon {
  margin-right: 4px;
}

.chat-messages {
  flex: 1;
  padding: 20px;
  overflow-y: auto;
  background-color: #f8fafc;
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.message {
  max-width: 85%;
  padding: 12px 16px;
  font-size: 0.95rem;
  line-height: 1.5;
  position: relative;
  word-wrap: break-word;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.message.user {
  background: #2563eb;
  color: white;
  align-self: flex-end;
  border-radius: 18px 18px 4px 18px;
}

.message.ai {
  background: #ffffff;
  color: #334155;
  align-self: flex-start;
  border-radius: 4px 18px 18px 18px;
  border: 1px solid #e2e8f0;
}

.loading-container {
  display: flex;
  align-items: center;
  gap: 8px;
  color: #64748b;
  font-style: italic;
  padding: 10px 16px;
}

.animate-spin {
  animation: spin 1s linear infinite;
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.chat-input-area {
  padding: 15px;
  background: white;
  border-top: 1px solid #f1f5f9;
  display: flex;
  gap: 10px;
  align-items: center;
}

.chat-input {
  flex: 1;
  border: 1px solid #cbd5e1;
  border-radius: 25px;
  padding: 12px 18px;
  outline: none;
  font-size: 0.95rem;
  transition: border-color 0.2s;
}

.chat-input:focus {
  border-color: #2563eb;
}

.send-button {
  background: #2563eb;
  color: white;
  border: none;
  width: 42px;
  height: 42px;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.2s;
}

.send-button:hover:not(:disabled) {
  background: #1d4ed8;
}

.send-button:disabled {
  background: #94a3b8;
  cursor: not-allowed;
}
</file>

<file path="src/Styles/DashboardStyles.css">
.dashboard-bg {
  min-height: 100vh;
  background: linear-gradient(180deg, #eef2ff, #e0e7ff);
  display: flex;
  justify-content: center;
  padding: 2rem 1rem;
}

.dashboard-container {
  width: 100%;
  max-width: 1100px;
  background: white;
  border-radius: 28px;
  padding: 2.5rem;
  box-shadow: 0 30px 70px rgba(0,0,0,0.08);
}

.dashboard-header h1 {
  font-size: 2.2rem;
  font-weight: 700;
}

.dashboard-header p {
  margin-top: 0.4rem;
  color: #64748b;
}

.cards-container {
  margin-top: 2.5rem;
  padding: 2.5rem;

  background: linear-gradient(180deg, #ffffff, #f4f7ff);
  border-radius: 26px;

  display: grid;

  grid-template-columns: repeat(2, 1fr);
  gap: 2rem;

  box-shadow: inset 0 0 0 1px rgba(226, 232, 255, 0.8);
}

.card {
  background: #fff;
  border-radius: 22px;
  padding: 1.8rem;
  box-shadow: 0 12px 30px rgba(0,0,0,0.06);
  display: flex;
  flex-direction: column;
  gap: 0.8rem;
}

.card-header {
  display: flex;
  align-items: center;
  gap: 0.8rem;
}

.icon {
  width: 52px;
  height: 52px;
  border-radius: 50%;
  display: grid;
  place-items: center;
  font-size: 1.7rem;
}

.glucose-icon {
  background: #fee2e2;
  color: #b91c1c;
}

.pressure-icon {
  background: #e0f2fe;
  color: #0369a1;
}

.value {
  font-size: 2.4rem;
  font-weight: 700;
}

.value span {
  font-size: 1rem;
  color: #64748b;
}

.date {
  font-size: 0.9rem;
  color: #64748b;
}

.normal {
  border-left: 6px solid #22c55e;
}

.warning {
  border-left: 6px solid #f59e0b;
}

.danger {
  border-left: 6px solid #ef4444;
}




@media (max-width: 768px) {
  .cards-container {
    grid-template-columns: 1fr;
    padding: 1.5rem;
  }

  .register-card,
  .history-card {
    grid-column: 1;
  }
}

.card.normal {
  background: linear-gradient(135deg, #e0f2fe, #f0f9ff);
  border-left: 6px solid #0284c7;
}

.card.warning {
  background: linear-gradient(135deg, #fff7ed, #ffedd5);
  border-left: 6px solid #f97316;
}

.card.danger {
  background: linear-gradient(135deg, #fee2e2, #fff1f2);
  border-left: 6px solid #dc2626;
}


.status {
  font-size: 0.85rem;
  font-weight: 600;
  padding: 4px 10px;
  border-radius: 12px;
}

.status.normal {
  background: #0284c7;
  color: white;
}

.status.warning {
  background: #f97316;
  color: white;
}

.status.danger {
  background: #dc2626;
  color: white;
}
.action-card {
  background-color: #f5f8ff; 
  border-radius: 20px;
  padding: 2rem;

  border: 2px solid #c7d7fe;

  box-shadow: 0 8px 22px rgba(0, 0, 0, 0.05);

  cursor: pointer;

  transition: transform 0.25s ease, box-shadow 0.25s ease;
}

.action-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 14px 28px rgba(37, 99, 235, 0.18);
}
</file>

<file path="src/Styles/healthRegister.css">
.health-page {
  padding: 20px;
  max-width: 900px;
  margin: auto;
}

.health-page h1 {
  font-size: 2.2rem;
  color: #1f4fd8;
}

.health-page p {
  font-size: 1.2rem;
  margin-bottom: 20px;
}

.health-form {
  display: grid;
  gap: 20px;
}

.form-card {
  background: white;
  padding: 25px;
  border-radius: 16px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.08);
}

.form-card.blue {
  border: 3px solid #2b63e0;
}

.form-card.red {
  border: 3px solid #d92c2c;
}

.form-card h2 {
  font-size: 1.6rem;
  margin-bottom: 15px;
}

.form-card input {
  width: 100%;
  font-size: 1.5rem;
  padding: 15px;
  border-radius: 10px;
  border: 2px solid #ccc;
}

.pressure-inputs {
  display: flex;
  align-items: center;
  gap: 10px;
}

.pressure-inputs span {
  font-size: 2rem;
}

.save-btn {
  margin-top: 20px;
  background: linear-gradient(135deg, #2563eb, #1e40af);
  color: white;
  border: none;
  padding: 20px;
  font-size: 1.6rem;
  border-radius: 15px;
  cursor: pointer;
}


.save-btn:hover {
  opacity: 0.9;
}

@media (max-width: 600px) {
  .health-page h1 {
    font-size: 1.8rem;
  }

  .form-card h2 {
    font-size: 1.4rem;
  }

  .form-card input {
    font-size: 1.3rem;
  }

  .save-btn {
    font-size: 1.4rem;
  }
}
.bp-inputs {
  display: flex;
  gap: 10px;
  width: 100%;
  box-sizing: border-box;
}
.bp-inputs input {
  flex: 1;
  width: 100%;
  min-width: 0;
  box-sizing: border-box;
}

.bp-inputs input {
  flex: 1;
  min-width: 0;
}

@media (max-width: 480px) {
  .bp-inputs {
    flex-direction: column;
    align-items: stretch;
  }

  .bp-inputs span {
    display: none;
  }

  .bp-inputs input {
    width: 100%;
    font-size: 18px;
    padding: 14px;
  }
}
</file>

<file path="src/Styles/HistoryStyles.css">
.history-page {
  padding: 2rem;
  max-width: 900px;
  margin: auto;
}

.history-page h1 {
  font-size: 2.4rem;
  margin-bottom: 2rem;
  color: #1e3a8a;
}

/* TARJETA */
.history-item {
  background: linear-gradient(135deg, #f8fafc, #eef2ff);
  padding: 1.6rem;
  border-radius: 18px;
  margin-bottom: 1.4rem;
  box-shadow: 0 10px 30px rgba(30, 64, 175, 0.15);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  border-left: 6px solid #2563eb;   
  border-right: 6px solid #93c5fd; 
}


.history-item:hover {
  transform: translateY(-4px);
  box-shadow: 0 16px 40px rgba(30, 64, 175, 0.25);
}

.history-header {
  display: flex;
  justify-content: flex-end;
  margin-bottom: 1rem;
}

.history-date {
  font-size: 0.95rem;
  color: #475569;
}

.history-values {
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
}

.badge {
  padding: 0.7rem 1.2rem;
  border-radius: 999px;
  font-weight: 600;
  font-size: 1.05rem;
}


.badge.glucose {
  background: #dbeafe;
  color: #1e40af;
}

.badge.pressure {
  background: #fee2e2;
  color: #b91c1c;
}


.badge.danger {
  background: linear-gradient(135deg, #ef4444, #dc2626);
  color: #ffffff;
}


.history-item.alert {
  border-left: 6px solid #dc2626;
}


@media (max-width: 768px) {
  .history-page {
    padding: 1.5rem 1rem;
  }

  .history-page h1 {
    font-size: 2rem;
    text-align: center;
  }

  .history-item {
    padding: 1.4rem;
  }

  .history-values {
    flex-direction: column;
    gap: 0.8rem;
  }

  .badge {
    width: 100%;
    text-align: center;
    font-size: 1.2rem;
    padding: 1rem;
  }
}

@media (max-width: 480px) {
  .history-page h1 {
    font-size: 1.8rem;
  }

  .history-item {
    padding: 1.2rem;
  }

  .history-date {
    font-size: 0.9rem;
    text-align: center;
  }
}
.action-card {
  background: #ffffff;
  border-radius: 20px;
  padding: 32px;
  cursor: pointer;
  transition: all 0.35s ease;
  box-shadow: 0 14px 32px rgba(0, 0, 0, 0.08);
  border-left: 7px solid transparent;
}

.action-card h2 {
  font-size: 1.5rem;
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 12px;
}

.action-card p {
  font-size: 0.95rem;
  color: #475569;
}





.register-card {
  background: linear-gradient(
    135deg,
    #e8efff,
    #ffffff
  );
  border-left-color: #2563eb;
}

.register-card h2 {
  color: #2563eb;
}

.register-card:hover {
  background: linear-gradient(
    135deg,
    #dbe8ff,
    #ffffff
  );
  transform: translateY(-8px);
  box-shadow: 0 22px 48px rgba(37, 99, 235, 0.45);
}

.history-card {
  background: linear-gradient(
    135deg,
    #fdecec,
    #eef3ff
  );
  border-left-color: #dc2626;
}

.history-card h2 {
  color: #1e40af; 
}

.history-card:hover {
  background: linear-gradient(
    135deg,
    #fbd0d0,
    #dbe8ff
  );
  transform: translateY(-8px);
  box-shadow: 0 22px 48px rgba(220, 38, 38, 0.35);
}
.download-buttons {
  display: flex;
  gap: 16px;
  margin-bottom: 20px;
}

.download-btn {
  padding: 14px 20px;
  font-size: 1.1rem;
  border-radius: 12px;
  border: none;
  cursor: pointer;
  color: white;
}

.download-btn.pdf {
  background: #2563eb;
}

.download-btn.csv {
  background: #16a34a;
}

.download-btn:hover {
  opacity: 0.9;
}
</file>

<file path="src/Styles/loginStyles.css">
.login-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  padding: 20px;
  background-color: #f0f4f8;
}

.login-box {
  background: white;
  padding: 2.5rem;
  border-radius: 12px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.1);
  width: 100%;
  max-width: 400px;
  border-top: 6px solid #1e40af; 
  text-align: center;
}

.login-logo {
  width: 220px;
  height: auto;
  margin-bottom: 20px;
}

.input-group-login {
  margin-bottom: 15px;
  text-align: left;
}

.input-group-login label {
  display: block;
  margin-bottom: 5px;
  font-size: 0.9rem;
  color: #1e3a8a;
  font-weight: bold;
}

.input-group-login input {
  width: 100%;
  padding: 12px;
  border-radius: 6px;
  border: 1px solid #d1d5db;
  box-sizing: border-box;
}

.btn-login {
  width: 100%;
  padding: 14px;
  background-color: #1e40af; 
  color: white;
  border: none;
  border-radius: 6px;
  font-weight: bold;
  font-size: 1rem;
  cursor: pointer;
  transition: background 0.3s;
  margin-top: 10px;
}

.btn-login:hover {
  background-color: #1d4ed8;
}

.auth-footer {
  margin-top: 20px;
  font-size: 0.9rem;
  color: #64748b;
}

.auth-footer a {
  color: #2563eb;
  font-weight: bold;
  text-decoration: none;
}

@media (max-width: 480px) {
  .login-box {
    padding: 1.5rem;
    box-shadow: none;
    border-radius: 8px;
  }
  .login-logo {
    width: 180px;
  }
}

.btn-link {
  background: none;
  border: none;
  color: #2563eb;
  text-decoration: underline;
  cursor: pointer;
  font-size: 0.9rem;
  margin-bottom: 15px;
  display: block;
  width: 100%;
  text-align: right;
  padding: 0;
}

.btn-link:hover {
  color: #1e40af;
}

.modal-overlay {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.6);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 2000;
  padding: 20px;
}

.modal-content {
  background: white;
  padding: 2rem;
  border-radius: 12px;
  width: 100%;
  max-width: 380px;
  text-align: center;
  box-shadow: 0 4px 20px rgba(0,0,0,0.3);
}

.modal-content h3 {
  color: #1e3a8a;
  margin-top: 0;
}

.input-reset {
  width: 100%;
  padding: 12px;
  margin: 15px 0;
  border: 1px solid #ccc;
  border-radius: 6px;
  box-sizing: border-box;
}

.modal-actions {
  display: flex;
  gap: 10px;
  justify-content: center;
  margin-top: 15px;
}

.btn-cancel {
  padding: 10px 18px;
  border: 1px solid #ccc;
  background: white;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 500;
}

.btn-confirm {
  padding: 10px 18px;
  background: #2563eb;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 500;
}

.btn-confirm.disabled {
  background: #93c5fd;
  cursor: not-allowed;
}

.status-msg {
  font-size: 0.9rem;
  margin-bottom: 10px;
  font-weight: bold;
}
.status-msg.success { color: #16a34a; }
.status-msg.error { color: #dc2626; }

.cooldown-text {
  color: #d97706;
  font-weight: bold;
  font-size: 0.9rem;
  margin-top: 10px;
}
</file>

<file path="src/Styles/SpecialistStyles.css">
.specialist-bg, .file-bg {
    min-height: 100vh;
    background-color: #f8fafc;
    padding: 30px;
    font-family: 'Inter', system-ui, sans-serif;
}

.specialist-container, .file-container {
    max-width: 1200px;
    margin: 0 auto;
}

.dashboard-header, .file-header {
    margin-bottom: 25px;
}

.header-title-wrapper {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 5px;
}

.badge-pro {
    background-color: #dbeafe;
    color: #1e40af;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 0.5px;
    text-transform: uppercase;
}

.dashboard-header h1, .file-header h1 {
    color: #0f172a;
    font-size: 1.8rem;
    margin: 0;
}

.dashboard-header p, .patient-subtitle { 
    color: #64748b; 
    margin-top: 5px; 
}

.file-top-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 1px solid #e2e8f0;
}

.header-center-info {
    text-align: center;
    flex: 1;
}

.header-center-info h1 {
    color: #0f172a;
    font-size: 1.6rem;
    margin: 0;
    font-weight: 800;
}

.toolbar-card {
    background: white;
    padding: 20px;
    border-radius: 12px;
    margin-top: 25px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 4px rgba(0,0,0,0.02);
    border: 1px solid #e2e8f0;
    gap: 15px;
    flex-wrap: wrap;
}

.search-bar {
    position: relative;
    flex: 1;
    max-width: 450px;
    border-top: 4px solid #1e40af;
    border-radius: 10px;
    overflow: hidden;
}

.search-icon-input {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: #94a3b8;
}

.search-bar input {
    width: 100%;
    padding: 10px 12px 10px 40px;
    border: 1px solid #e2e8f0;
    border-top: none;
    border-radius: 0 0 8px 8px;
    background: #f8fafc;
    font-size: 0.95rem;
    transition: all 0.2s;
    outline: none;
}

.search-bar input:focus {
    background: white;
    border-color: #2563eb;
}

.filter-buttons {
    display: flex;
    gap: 10px;
}

.filter-btn {
    padding: 8px 16px;
    border: 1px solid #e2e8f0;
    background: white;
    border-radius: 6px;
    color: #64748b;
    font-weight: 600;
    cursor: pointer;
    font-size: 0.9rem;
    transition: all 0.2s;
}

.filter-btn:hover { background: #f8fafc; }
.filter-btn.active.blue { background: #eff6ff; color: #2563eb; border-color: #bfdbfe; }
.filter-btn.active.red { background: #fef2f2; color: #dc2626; border-color: #fecaca; }
.filter-btn.active.green { background: #f0fdf4; color: #16a34a; border-color: #bbf7d0; }

.table-container-medical {
    background: white;
    margin-top: 25px;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    border: 1px solid #e2e8f0;
    border-top: 5px solid #1e40af; 
}

.table-wrapper-scroll {
    max-height: 580px;
    overflow-y: auto;
    width: 100%;
}

.medical-table {
    width: 100%;
    border-collapse: collapse;
}

.medical-table th {
    background-color: #f1f5f9;
    color: #1e3a8a;
    text-align: left;
    padding: 18px 20px;
    font-size: 0.85rem;
    font-weight: 800; 
    text-transform: uppercase;
    letter-spacing: 1px;
    border-bottom: 2px solid #cbd5e1;
    position: sticky;
    top: 0;
    z-index: 10;
}

.medical-table td {
    padding: 16px 20px;
    border-bottom: 1px solid #f1f5f9;
    color: #334155;
    vertical-align: middle;
}

.medical-table tbody tr:nth-child(even) {
    background-color: #f8fafc; 
}

.medical-table tbody tr:hover {
    background-color: #eff6ff; 
}

.patient-cell {
    display: flex;
    align-items: center;
    gap: 15px;
}

.avatar-circle {
    width: 36px;
    height: 36px;
    background: #3b82f6;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.patient-info {
    display: flex;
    flex-direction: column;
}

.patient-name {
    font-weight: 700;
    color: #1e293b;
}

.status-badge-medical {
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 800;
    text-transform: uppercase;
    display: inline-block;
}

.status-badge-medical.stable { background: #dcfce7; color: #166534; }
.status-badge-medical.critical { background: #fee2e2; color: #991b1b; }

.btn-view-file {
    background: #ffffff;
    color: #2563eb;
    border: 1px solid #bfdbfe;
    padding: 6px 12px;
    border-radius: 6px;
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.85rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
}

.btn-view-file:hover { background: #eff6ff; border-color: #2563eb; }

.btn-back {
    background: white;
    border: 1px solid #e2e8f0;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    color: #475569;
    font-weight: 500;
    transition: all 0.2s;
}

.btn-back:hover { background: #f8fafc; color: #1e293b; }

.file-grid {
    display: grid;
    grid-template-columns: 320px 1fr;
    gap: 30px;
}

.patient-info-card {
    background: white;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
    border: 1px solid #e2e8f0;
    border-top: 6px solid #2563eb;
    height: fit-content;
}

.profile-avatar-large {
    width: 90px;
    height: 90px;
    background: #eff6ff;
    color: #2563eb;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 20px;
    border: 4px solid #f8fafc;
}

.info-group { margin-bottom: 20px; }

.info-group label { 
    display: flex; 
    align-items: center; 
    gap: 6px; 
    font-size: 0.8rem; 
    color: #64748b; 
    margin-bottom: 6px; 
    font-weight: 700; 
    text-transform: uppercase; 
}

.badge-blood { 
    background: #2563eb; 
    color: white; 
    padding: 4px 10px; 
    border-radius: 4px; 
    font-size: 0.9rem; 
    font-weight: 600; 
}

.divider { height: 1px; background: #e2e8f0; margin: 20px 0; }

.physical-data {
    background: #f8fafc;
    padding: 20px;
    border-radius: 10px;
    display: flex;
    justify-content: space-between;
    border: 1px solid #e2e8f0;
}

.phy-item { text-align: center; }

.phy-item small { 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    gap: 4px; 
    font-size: 0.75rem; 
    color: #64748b; 
    margin-bottom: 4px; 
    text-transform: uppercase; 
    font-weight: 700; 
}

.phy-item strong { font-size: 1.1rem; color: #1e293b; font-weight: 800; }

.sos-section-embedded {
    margin-top: 25px;
    padding: 15px;
    background: #fffcfc;
    border-radius: 10px;
    border: 1px solid #fee2e2;
    border-left: 5px solid #dc2626;
    border-right: 5px solid #dc2626;
}

.sos-label {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #dc2626;
    font-size: 0.75rem;
    font-weight: 800;
    text-transform: uppercase;
    margin-bottom: 12px;
}

.sos-data-row { margin-bottom: 8px; }
.sos-data-row strong { font-size: 0.8rem; color: #64748b; display: block; margin-bottom: 2px; font-weight: 700; }
.sos-data-row span { display: block; font-size: 0.95rem; font-weight: 700; color: #1e293b; }
.sos-phone-black { display: block; font-size: 1.1rem; color: #000000; font-weight: 800; }

.vitals-cards-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 25px;
    margin-bottom: 30px;
}

.history-section-mini {
    background: white;
    border-radius: 12px;
    padding: 25px;
    box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
    border: 1px solid #e2e8f0;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid #f1f5f9;
}

.btn-download {
    background: #1e293b;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    font-size: 0.85rem;
    font-weight: 500;
}

.mini-table { width: 100%; border-collapse: collapse; }
.mini-table th { text-align: left; color: #64748b; padding-bottom: 12px; font-size: 0.85rem; text-transform: uppercase; border-bottom: 2px solid #e2e8f0; font-weight: 700; }
.mini-table td { padding: 14px 0; border-bottom: 1px solid #f1f5f9; font-size: 0.9rem; color: #334155; }

.status-dot { padding: 4px 10px; border-radius: 12px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; }
.status-dot.red { background: #fee2e2; color: #991b1b; }
.status-dot.green { background: #dcfce7; color: #166534; }

.card-title {
    text-align: center;
    margin-bottom: 20px;
    font-size: 1.1rem;
    color: #1e3a8a;
    font-weight: 800;
}

.value-text { font-weight: 700; color: #1e293b; }

.loading-screen {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    font-size: 1.2rem;
    color: #64748b;
}

.no-data {
    text-align: center;
    padding: 20px;
    color: #64748b;
}

.capitalize-text {
    text-transform: capitalize;
}

.sos-section-embedded.no-record {
    border-color: #e2e8f0;
    border-left-color: #94a3b8;
    border-right-color: #94a3b8;
    background: #f8fafc;
}

.sos-label.gray {
    color: #64748b;
}

.no-record-text {
    font-size: 0.85rem;
    color: #64748b;
    margin: 0;
}

.condition-text {
    font-size: 0.9rem;
    color: #334155;
    font-weight: 700;
    margin: 0;
}

.imc-value {
    color: #1e40af;
}

.section-header h3 {
    margin: 0;
    color: #1e293b;
    font-weight: 800;
}

.badges-container {
    display: flex;
    flex-direction: column;
    gap: 4px;
    align-items: flex-start;
}

.status-badge-mini {
    padding: 3px 8px;
    border-radius: 4px;
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    white-space: nowrap;
}

.status-badge-mini.badge-danger {
    background-color: #fee2e2;
    color: #991b1b;
    border: 1px solid #fecaca;
}

.status-badge-mini.badge-warning {
    background-color: #ffedd5;
    color: #9a3412;
    border: 1px solid #fed7aa;
}

.status-cell {
    vertical-align: top;
}

.icon-white {
    color: #ffffff;
}

@media (max-width: 900px) {
    .file-grid { grid-template-columns: 1fr; }
    .vitals-cards-grid { grid-template-columns: 1fr; }
    .toolbar-card { flex-direction: column; align-items: stretch; }
    .search-bar { max-width: 100%; }
}
</file>

<file path="src/pages/PatientFile.jsx">
import React, { useEffect, useState } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import { 
    Phone, 
    ArrowLeft, 
    User, 
    AlertTriangle, 
    HeartPulse, 
    ShieldCheck, 
    Download, 
    Activity, 
    Droplets, 
    CreditCard, 
    Scale, 
    Ruler, 
    Heart as HeartIcon, 
    FileWarning 
} from 'lucide-react';
import { 
    getMedicalRecord, 
    getPatientDashboardData, 
    getPatientHistory, 
    getDownloadUrl,
    getPatientById 
} from '../services/SpecialistService';
import GlucoseCard from '../components/Dashboard/GlucoseCard';
import PressureCard from '../components/Dashboard/PressureCard';
import '../Styles/SpecialistStyles.css';

const PatientFile = () => {
  const { id: userId } = useParams(); 
  const navigate = useNavigate();
  const [medicalRecord, setMedicalRecord] = useState(null);
  const [userProfile, setUserProfile] = useState(null);
  const [dashboardData, setDashboardData] = useState({ glucose: null, pressure: null });
  const [history, setHistory] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const loadData = async () => {
      try {
        const token = localStorage.getItem('token');
        if (!token) {
            navigate('/login');
            return;
        }
        
        const [record, dash, hist, profile] = await Promise.all([
            getMedicalRecord(userId),
            getPatientDashboardData(userId),
            getPatientHistory(userId),
            getPatientById(userId)
        ]);

        setMedicalRecord(record);
        setDashboardData(dash);
        setHistory(hist);
        setUserProfile(profile);

      } catch (error) {
        console.error(error);
      } finally {
        setLoading(false);
      }
    };
    if (userId) loadData();
  }, [userId, navigate]);

  const calculateIMC = (weight, height) => {
    if (!weight || !height || height === 0) return '-';
    const heightInMeters = height / 100;
    return (weight / (heightInMeters * heightInMeters)).toFixed(1);
  };

  const renderStatusBadges = (record) => {
    const alerts = [];

    if (record.glucose) {
        if (record.glucose > 140) {
            alerts.push({ text: 'Glucosa Alta', className: 'badge-warning' });
        } else if (record.glucose < 70) {
            alerts.push({ text: 'Hipoglucemia', className: 'badge-danger' });
        }
    }

    if (record.systolic && record.diastolic) {
        if (record.systolic >= 140 || record.diastolic >= 90) {
            alerts.push({ text: 'Hipertensión', className: 'badge-danger' });
        } else if (record.systolic >= 130 || record.diastolic >= 85) {
            alerts.push({ text: 'Presión Elevada', className: 'badge-warning' });
        }
    }

    if (alerts.length === 0) {
        return <span className="status-dot green">Estable</span>;
    }

    return (
        <div className="badges-container">
            {alerts.map((alert, index) => (
                <span key={index} className={`status-badge-mini ${alert.className}`}>
                    {alert.text}
                </span>
            ))}
        </div>
    );
  };

  if (loading) return <div className="loading-screen">Cargando información clínica del paciente...</div>;

  return (
    <div className="file-bg">
      <div className="file-container">
        <header className="file-top-bar">
            <button className="btn-back" onClick={() => navigate(-1)}>
                <ArrowLeft size={18} /> Volver al Panel
            </button>
            <div className="header-center-info">
                <h1>Ficha Clínica Digital</h1>
                <p className="patient-subtitle">
                    Paciente: {userProfile ? `${userProfile.first_names} ${userProfile.last_names}` : userId}
                </p>
            </div>
            <div className="placeholder-side"></div>
        </header>

        <div className="file-grid">
            <aside className="patient-info-card">
                <div className="profile-avatar-large"><User size={40} /></div>
                <h3 className="card-title">Resumen Clínico</h3>
                
                <div className="info-group">
                    <label><User size={14}/> Nombre Completo</label>
                    <span className="value-text capitalize-text">
                        {userProfile ? `${userProfile.first_names} ${userProfile.last_names}` : 'No disponible'}
                    </span>
                </div>

                <div className="info-group">
                    <label><CreditCard size={14}/> RUT</label>
                    <span className="value-text">{userProfile?.rut || 'No disponible'}</span>
                </div>

                <div className="divider"></div>

                {!medicalRecord ? (
                  <div className="sos-section-embedded no-record">
                      <div className="sos-label gray">
                          <FileWarning size={14} /> Ficha Médica Inexistente
                      </div>
                      <p className="no-record-text">
                          Este usuario no ha completado su registro inicial de salud.
                      </p>
                  </div>
                ) : (
                  <>
                    <div className="info-group">
                        <label><HeartPulse size={14}/> Sangre</label>
                        <span className="badge-blood">{medicalRecord.blood_type || '---'}</span>
                    </div>
                    
                    <div className="info-group">
                        <label className="alert-label"><AlertTriangle size={14}/> Alergias</label>
                        <p className="condition-text">
                          {medicalRecord.allergies || 'Ninguna'}
                        </p>
                    </div>

                    <div className="info-group">
                        <label><ShieldCheck size={14}/> Enf. Crónicas</label>
                        <p className="condition-text">
                          {medicalRecord.chronic_diseases || 'Ninguna'}
                        </p>
                    </div>

                    <div className="divider"></div>

                    <div className="physical-data">
                        <div className="phy-item">
                            <small><Scale size={14}/> Peso</small>
                            <strong>{medicalRecord.initial_weight || '---'} kg</strong>
                        </div>
                        <div className="phy-item">
                            <small><Ruler size={14}/> Altura</small>
                            <strong>{medicalRecord.height || '---'} cm</strong>
                        </div>
                        <div className="phy-item">
                            <small><HeartIcon size={14}/> IMC</small>
                            <strong className="imc-value">
                                {calculateIMC(medicalRecord.initial_weight, medicalRecord.height)}
                            </strong>
                        </div>
                    </div>

                    <div className="sos-section-embedded">
                        <div className="sos-label">
                            <Phone size={14} /> Contacto Emergencia
                        </div>
                        <div className="sos-data-row">
                            <strong>Nombre:</strong>
                            <span>{medicalRecord.emergency_contact_name || 'No registrado'}</span>
                        </div>
                        <div className="sos-data-row">
                            <strong>Número:</strong>
                            <span className="sos-phone-black">{medicalRecord.emergency_contact_phone || '---'}</span>
                        </div>
                    </div>
                  </>
                )}
            </aside>

            <section className="vitals-section">
                <div className="vitals-cards-grid">
                    <GlucoseCard 
                        glucose={dashboardData.glucose?.value || 0}
                        date={dashboardData.glucose?.date}
                    />
                    <PressureCard 
                        systolic={dashboardData.pressure?.systolic || 0}
                        diastolic={dashboardData.pressure?.diastolic || 0}
                        date={dashboardData.pressure?.date} 
                    />
                </div>

                <div className="history-section-mini">
                    <div className="section-header">
                        <h3>Historial de Controles</h3>
                        <button className="btn-download" onClick={() => window.open(getDownloadUrl(userId), '_blank')}>
                            <Download size={16} /> Exportar PDF
                        </button>
                    </div>
                    <div className="mini-table-container">
                        <table className="mini-table">
                            <thead>
                                <tr>
                                    <th>FECHA</th>
                                    <th><Droplets size={14}/> GLUCOSA</th>
                                    <th><Activity size={14}/> PRESION</th>
                                    <th>ESTADO</th>
                                </tr>
                            </thead>
                            <tbody>
                                {history.length > 0 ? history.map((h, i) => (
                                    <tr key={i}>
                                        <td>{new Date(h.date).toLocaleDateString()}</td>
                                        <td>
                                            {h.glucose ? <span className={`value-box ${h.glucose > 140 ? 'val-high' : h.glucose < 70 ? 'val-low' : 'val-normal'}`}>{h.glucose} mg/dL</span> : '--'}
                                        </td>
                                        <td>
                                            {h.systolic ? <span className={`value-box ${h.systolic >= 140 || h.diastolic >= 90 ? 'val-high' : 'val-normal'}`}>{h.systolic}/{h.diastolic} mmHg</span> : '--'}
                                        </td>
                                        <td className="status-cell">
                                            {renderStatusBadges(h)}
                                        </td>
                                    </tr>
                                )) : <tr><td colSpan="4" className="no-data">Sin registros históricos</td></tr>}
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </div>
      </div>
    </div>
  );
};

export default PatientFile;
</file>

<file path="src/pages/ProfilePage.jsx">
import React, { useEffect, useState } from 'react';
import { useNavigate, Link } from 'react-router-dom';
import { User, Ruler, AlertTriangle, Phone, AlertCircle, Save, X } from 'lucide-react';
import { getMedicalRecord, updateMedicalRecord } from '../services/MedicalService'; 
import { requestAccountDeletion } from '../services/AdminService';
import '../Styles/ProfileStyles.css';

const ProfilePage = () => {
  const navigate = useNavigate();
  const [profile, setProfile] = useState(null);
  const [loading, setLoading] = useState(true);
  const [userName, setUserName] = useState("Mi Perfil"); 
  const [isEditing, setIsEditing] = useState(false);
  const [formData, setFormData] = useState({});
  const [showDeleteModal, setShowDeleteModal] = useState(false);
  const [phoneEdit, setPhoneEdit] = useState("");

  const fetchProfile = async () => {
    const userId = localStorage.getItem('user_id');
    const storedName = localStorage.getItem('user_name');
    
    if (storedName) setUserName(storedName);
    if (!userId) { navigate('/login'); return; }

    try {
      const data = await getMedicalRecord(userId);
      setProfile(data);
      
      const initialForm = data || {};
      setFormData(initialForm);

      if (initialForm.emergency_contact_phone) {
          const rawPhone = initialForm.emergency_contact_phone.toString();
          setPhoneEdit(rawPhone.replace(/^\+56/, ''));
      }
    } catch (error) {
      console.error(error);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => { fetchProfile(); }, [navigate]);

  const handleChange = (e) => {
    const { name, value } = e.target;
    if (name === 'height' && (value < 0 || value > 300)) return;
    if (name === 'initial_weight' && (value < 0 || value > 600)) return;
    setFormData({ ...formData, [name]: value });
  };

  const handlePhoneEditChange = (e) => {
      const val = e.target.value.replace(/[^0-9]/g, '');
      if (val.length <= 9) setPhoneEdit(val);
  };

  const handleSave = async () => {
    if (phoneEdit.length !== 9 || !phoneEdit.startsWith('9')) {
        alert("El teléfono de emergencia debe tener 9 dígitos y comenzar con 9.");
        return;
    }

    try {
      const userId = localStorage.getItem('user_id');
      const finalPhone = `+56${phoneEdit}`;
      const payload = {
        ...formData,
        emergency_contact_phone: finalPhone,
        current_weight: formData.initial_weight 
      };

      await updateMedicalRecord(userId, payload);
      setProfile(payload);
      setFormData(payload);
      setIsEditing(false);  
      alert("¡Perfil actualizado!");
    } catch (error) {
      alert("Error al guardar cambios: " + error.message);
    }
  };

  const confirmDeletion = async () => {
    const userId = localStorage.getItem('user_id');
    if (!userId) return;
    const { success, error } = await requestAccountDeletion(userId);
    if (success) {
      setShowDeleteModal(false);
      alert("Solicitud enviada correctamente.");
    } else {
      alert("Error: " + error);
    }
  };

  if (loading) return <div className="loading-container">Cargando perfil...</div>;
  
  if (!profile) return (
    <div className="profile-container">
        <div className="empty-state">
          <h2>Ficha médica no encontrada</h2>
          <p>Hola <b>{userName}</b>, necesitamos tus datos para comenzar.</p>
          <Link to="/ficha-medica" className="btn-create-record">Crear Ficha Médica</Link>
        </div>
    </div>
  );

  return (
    <div className="profile-container">
      <div className="profile-header">
        <div className="profile-avatar">
          <User size={40} />
        </div>
        <div className="profile-title">
          <h1>{userName}</h1>
          <p>Información Médica Personal</p>
        </div>
        {!isEditing && (
          <button className="btn-edit" onClick={() => setIsEditing(true)}>Editar</button>
        )}
      </div>

      <div className="profile-grid">
        <div className="info-card">
          <div className="card-header">
            <Ruler size={24} className="icon-blue" />
            <h3>Datos Corporales</h3>
          </div>
          <div className="info-item">
            <span className="info-label">Estatura (cm)</span>
            {isEditing ? <input type="number" name="height" value={formData.height} onChange={handleChange} className="form-input-edit" /> : <span className="info-value">{profile.height} cm</span>}
          </div>
          <div className="info-item">
            <span className="info-label">Peso (kg)</span>
            {isEditing ? <input type="number" name="initial_weight" value={formData.initial_weight} onChange={handleChange} className="form-input-edit" /> : <span className="info-value">{profile.initial_weight} kg</span>}
          </div>
          <div className="info-item">
            <span className="info-label">Grupo Sanguíneo</span>
            {isEditing ? (
              <select name="blood_type" value={formData.blood_type} onChange={handleChange} className="form-input-edit">
                  <option value="A+">A+</option>
                  <option value="O+">O+</option>
                  <option value="B+">B+</option>
                  <option value="AB+">AB+</option>
                  <option value="A-">A-</option>
                  <option value="O-">O-</option>
                  <option value="B-">B-</option>
                  <option value="AB-">AB-</option>
              </select>
            ) : <span className="info-value">{profile.blood_type}</span>}
          </div>
        </div>

        <div className="info-card">
          <div className="card-header">
            <AlertTriangle size={24} className="icon-blue" />
            <h3>Alertas Médicas</h3>
          </div>
          <div className="info-item">
            <span className="info-label">Alergias</span>
            {isEditing ? <input type="text" name="allergies" value={formData.allergies} onChange={handleChange} className="form-input-edit" /> : <span className="info-value">{profile.allergies || 'Ninguna'}</span>}
          </div>
          <div className="info-item">
            <span className="info-label">Enf. Crónicas</span>
            {isEditing ? <input type="text" name="chronic_diseases" value={formData.chronic_diseases} onChange={handleChange} className="form-input-edit" /> : <span className="info-value">{profile.chronic_diseases || 'Ninguna'}</span>}
          </div>
        </div>

        <div className="info-card">
          <div className="card-header">
            <Phone size={24} className="icon-blue" />
            <h3>Emergencia</h3>
          </div>
          <div className="info-item">
            <span className="info-label">Nombre Contacto</span>
            {isEditing ? <input type="text" name="emergency_contact_name" value={formData.emergency_contact_name} onChange={handleChange} className="form-input-edit" /> : <span className="info-value">{profile.emergency_contact_name}</span>}
          </div>
          <div className="info-item">
            <span className="info-label">Teléfono (+56)</span>
            {isEditing ? (
                <div className="phone-edit-wrapper">
                    <span className="prefix-span">+56</span>
                    <input 
                        type="tel" 
                        value={phoneEdit} 
                        onChange={handlePhoneEditChange} 
                        className="form-input-edit phone-input" 
                        placeholder="9XXXXXXXX"
                    />
                </div>
            ) : (
                <span className="info-value phone-display">{profile.emergency_contact_phone}</span>
            )}
          </div>
        </div>
      </div>
      
      {!isEditing && (
        <div className="danger-zone">
          <div className="danger-content">
            <h3>Eliminar Cuenta</h3>
            <p>Esta acción solicitará el borrado permanente de tus datos.</p>
          </div>
          <button className="btn-request-delete" onClick={() => setShowDeleteModal(true)}>Solicitar Eliminación</button>
        </div>
      )}

      {isEditing && (
        <div className="edit-actions">
          <button onClick={handleSave} className="btn-create-record">
              <Save size={18} className="btn-icon"/> Guardar Cambios
          </button>
          <button onClick={() => { setIsEditing(false); setFormData(profile); setPhoneEdit(profile.emergency_contact_phone?.replace(/^\+56/, '')); }} className="btn-cancel-edit">
              <X size={18} className="btn-icon"/> Cancelar
          </button>
        </div>
      )}

      {showDeleteModal && (
        <div className="custom-modal-overlay">
          <div className="custom-modal-content">
            <div className="modal-icon-warning">
              <AlertCircle size={32} className="icon-red" />
            </div>
            <h3>¿Confirmar solicitud?</h3>
            <p>Un administrador revisará la solicitud para borrar tus datos permanentemente.</p>
            <div className="modal-actions">
              <button className="btn-modal-cancel" onClick={() => setShowDeleteModal(false)}>Cancelar</button>
              <button className="btn-modal-confirm" onClick={confirmDeletion}>Confirmar</button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default ProfilePage;
</file>

<file path="src/services/downloadService.js">
import axios from 'axios';
import { formatDateDownload } from "../utils/formatDateDownload";

const API_DESCARGA = import.meta.env.VITE_API_DESCARGA;

export async function descargarHistorial(userId, formato) {
  try {
    const response = await axios.get(
      `${API_DESCARGA}/api/descargas/historial/${formato}/${userId}`,
      { responseType: 'blob' } 
    );

    const blob = new Blob([response.data]);
    const url = window.URL.createObjectURL(blob);

    const fecha = formatDateDownload(new Date())
      .replace(/ /g, "_")
      .replace(/·/g, "")
      .replace(/:/g, "-");

    const a = document.createElement("a");
    a.href = url;
    a.download = `historial_${userId}_${fecha}.${formato}`;

    document.body.appendChild(a);
    a.click();

    a.remove();
    window.URL.revokeObjectURL(url);

  } catch (error) {
    console.error("Error descargando historial:", error);
  }
}
</file>

<file path="src/services/MedicalService.js">
import axios from 'axios';

const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:3000';

const getConfig = () => ({
  headers: {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${localStorage.getItem('token')}`
  }
});

export const createMedicalRecord = async (data) => {
  try {
    const response = await axios.post(`${API_URL}/medical/records`, data, getConfig());
    return response.data;
  } catch (error) {
    console.error("Error en createMedicalRecord:", error);
    throw new Error(error.response?.data?.error || 'Error al crear ficha');
  }
};

export const getMedicalRecord = async (userId) => {
  try {
    const response = await axios.get(`${API_URL}/medical/records/${userId}`, getConfig());
    return response.data;
  } catch (error) {
    if (error.response && error.response.status === 404) {
        console.warn("Ficha médica no encontrada (404) para usuario:", userId);
        return null;
    }
    console.error("Error de red en getMedicalRecord:", error.message);
    return null;
  }
};

export const updateMedicalRecord = async (userId, updatedData) => {
  try {
    const response = await axios.put(`${API_URL}/medical/records/${userId}`, updatedData, getConfig());
    return response.data;
  } catch (error) {
    console.error("Error en updateMedicalRecord:", error);
    throw new Error(error.response?.data?.error || 'Error al actualizar datos');
  }
};
</file>

<file path="src/services/SpecialistService.js">
import axios from 'axios';

const API_USERS_URL = import.meta.env.VITE_API_URL || 'http://localhost:3000';
const API_REGISTRO_URL = import.meta.env.VITE_API_REGISTRO_URL || 'http://localhost:3001';
const API_DOWNLOAD_URL = import.meta.env.VITE_API_DESCARGA || 'http://localhost:3002';

const getConfig = () => ({
    headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${localStorage.getItem('token')}`
    }
});

export const getPatientById = async (id) => {
  try {
    const response = await axios.get(`${API_USERS_URL}/users/${id}`, getConfig());
    return response.data;
  } catch (error) {
    console.error(`Error getPatientById (${id}):`, error.message);
    return null;
  }
};

export const getPatients = async () => {
  try {
    const response = await axios.get(`${API_USERS_URL}/patients`, getConfig());
    return response.data;
  } catch (error) {
    console.error("Error getPatients:", error.message);
    return [];
  }
};

export const getMedicalRecord = async (userId) => {
  try {
    const response = await axios.get(`${API_USERS_URL}/medical/records/${userId}`, getConfig());
    return response.data;
  } catch (error) {
    if (error.response && error.response.status === 404) {
        return null;
    }
    console.error("Error getMedicalRecord:", error.message);
    return null;
  }
};

export const getPatientDashboardData = async (userId) => {
  try {
    const response = await axios.get(`${API_REGISTRO_URL}/api/registros/dashboard/${userId}`, getConfig());
    return response.data;
  } catch (error) {
    return { glucose: null, pressure: null };
  }
};

export const getPatientHistory = async (userId) => {
  try {
    const response = await axios.get(`${API_REGISTRO_URL}/api/registros/historial/${userId}`, getConfig());
    return response.data;
  } catch (error) {
    return [];
  }
};

export const getDownloadUrl = (userId) => {
    return `${API_DOWNLOAD_URL}/api/descargas/historial/pdf/${userId}`;
};
</file>

<file path="src/Styles/homeStyles.css">
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: Arial, sans-serif;
  background-color: #f4f8ff;
  overflow-x: hidden; 
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px 5%;
  background: #fff;
  border-bottom: 2px solid #2563eb;
  position: sticky;
  top: 0;
  z-index: 1000;
}

.logo {
  display: flex;
  align-items: center;
  gap: 10px;
  color: #2563eb;
  font-weight: bold;
}

.logo img { width: 36px; }

button {
  border: none;
  border-radius: 6px;
  padding: 8px 16px;
  cursor: pointer;
  font-weight: 500;
  transition: 0.3s;
}

.btn-primary { background: #2563eb; color: white; }
.btn-primary:hover { background: #1d4ed8; }
.btn-outline { background: transparent; border: 1px solid #2563eb; color: #2563eb; }
.btn-white { background: white; color: #2563eb; font-weight: bold; }

.big {
  padding: 12px 30px;
  font-size: 1rem;
  width: fit-content; /* */
}

.hero-modern-container {
  position: relative;
  background: #f4f8ff;
  width: 100%;
  min-height: 500px; 
  display: flex;
  flex-direction: column;
}

.hero-modern {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 40px;
  padding: 60px 10%;
  width: 100%;
  flex: 1;
}

.hero-text {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 20px;
  z-index: 2;
}

.badge {
  background: #e0ecff;
  color: #2563eb;
  padding: 6px 16px;
  border-radius: 20px;
  font-size: 0.8rem;
  width: fit-content;
}

.hero-text h1 {
  font-size: 2.5rem;
  color: #1e293b;
  line-height: 1.2;
}

.hero-text p {
  font-size: 1.1rem;
  color: #475569;
  line-height: 1.6;
  max-width: 500px;
}

.hero-image {
  flex: 1;
  display: flex;
  justify-content: center;
}

.hero-image img {
  width: 100%;
  max-width: 500px;
  height: auto;
  aspect-ratio: 16/10;
  object-fit: cover;
  border-radius: 22px;
  box-shadow: 0 20px 40px rgba(37, 99, 235, 0.15);
}

.carousel-arrow {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: white;
  color: #2563eb;
  width: 45px;
  height: 45px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  z-index: 10;
}

.left { left: 20px; }
.right { right: 20px; }

.carousel-dots {
  display: flex;
  justify-content: center;
  gap: 8px;
  padding: 20px 0;
}

.dot {
  width: 10px;
  height: 10px;
  background: #cbd5e1;
  border-radius: 50%;
  cursor: pointer;
}

.dot.active {
  background: #2563eb;
  width: 25px; 
  border-radius: 10px;
}

.features {
  background: white;
  padding: 80px 10%;
  text-align: center;
}

.features-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 30px;
  margin-top: 40px;
}

.feature-card {
  padding: 30px;
  border: 1px solid #e0ecff;
  border-radius: 16px;
  transition: 0.3s;
}

.feature-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.05); }

.icon {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 20px;
}

.icon.blue { background: #e0ecff; color: #2563eb; }
.icon.red { background: #fde2e2; color: #dc2626; }

@media (max-width: 1024px) {
  .hero-modern { gap: 20px; padding: 40px 5%; }
  .hero-text h1 { font-size: 2rem; }
}

@media (max-width: 768px) {
  .hero-modern {
    flex-direction: column; 
    text-align: center;
    padding-top: 30px;
  }

  .hero-text {
    align-items: center; 
    order: 1; 
  }

  .hero-image { order: 2; width: 100%; }
  
  .carousel-arrow { display: none; } 
  
  .hero-text .btn-primary.big { align-self: center; }
}

@media (max-width: 480px) {
  .hero-text h1 { font-size: 1.8rem; }
  .hero-text p { font-size: 1rem; }
  .header { padding: 10px 15px; }
  .header-buttons { display: none; } 
}

.fade-in { animation: fadeIn 0.8s ease-in-out; }
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

html, body {
  height: 100%;
  margin: 0;
}

#root {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}

main, .hero-modern-container, .features {
  flex: 1 0 auto;
}

.cta {
  background: #2563eb;
  color: white;
  text-align: center;
  padding: 40px 20px;
  width: 100%;
  flex-shrink: 0; 
}
.cta h2 {
  font-size: 1.8rem;
  margin-bottom: 10px;
}
.cta p {
  margin-bottom: 20px;
  opacity: 0.9;
}
.cta a {
  color: white;
  text-decoration: underline;
  font-size: 0.9rem;
  display: block;
  margin-top: 15px;
}
</file>

<file path="src/Styles/ProfileStyles.css">
.profile-container {
  max-width: 1000px;
  margin: 0 auto;
  padding: 40px 20px;
  font-family: 'Segoe UI', sans-serif;
  color: #333;
}

.loading-container {
  text-align: center; 
  margin-top: 50px;
  font-size: 1.2rem;
  color: #666;
}

.profile-header {
  display: flex;
  align-items: center;
  gap: 20px;
  margin-bottom: 40px;
  background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
  padding: 30px;
  border-radius: 15px;
  color: white;
  box-shadow: 0 4px 15px rgba(37, 99, 235, 0.2);
}

.profile-avatar {
  background: white;
  width: 80px;
  height: 80px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2.5rem;
  color: #2563eb;
}

.profile-title h1 {
  margin: 0;
  font-size: 2rem;
  text-transform: capitalize;
}

.profile-title p {
  margin: 5px 0 0;
  opacity: 0.9;
}

.btn-edit {
  margin-left: auto; 
  background: white; 
  color: #2563eb; 
  border: none; 
  padding: 10px 20px; 
  border-radius: 8px; 
  font-weight: bold; 
  cursor: pointer;
  transition: transform 0.2s;
}

.btn-edit:hover {
  transform: scale(1.05);
}

.profile-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 25px;
}

.info-card {
  background: white;
  padding: 25px;
  border-radius: 12px;
  border: 1px solid #e5e7eb;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  transition: transform 0.2s;
}

.info-card:hover {
  transform: translateY(-3px);
  border-color: #bfdbfe;
}

.card-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 20px;
  border-bottom: 1px solid #f0f0f0;
  padding-bottom: 10px;
}

.card-header h3 {
  margin: 0;
  color: #2563eb;
  font-size: 1.2rem;
}

.info-item {
  margin-bottom: 15px;
}

.info-label {
  display: block;
  font-size: 0.85rem;
  color: #64748b;
  font-weight: 600;
  text-transform: uppercase;
  margin-bottom: 4px;
}

.info-value {
  font-size: 1.1rem;
  color: #1e293b;
  font-weight: 500;
}

.empty-state {
  text-align: center;
  padding: 60px;
  background: #f8fafc;
  border-radius: 15px;
  border: 2px dashed #cbd5e1;
}

.btn-create-record {
  background: #2563eb;
  color: white;
  padding: 12px 25px;
  border-radius: 8px;
  text-decoration: none;
  font-weight: bold;
  display: inline-block;
  margin-top: 20px;
  cursor: pointer;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
}

.form-input-edit {
  width: 100%;
  padding: 8px;
  border: 1px solid #2563eb;
  border-radius: 6px;
  background: #f0f9ff;
  font-size: 1rem;
  color: #333;
}

.edit-actions {
  margin-top: 30px; 
  display: flex; 
  gap: 15px; 
  justify-content: center;
}

.btn-cancel-edit {
  padding: 12px 25px;
  background: #ef4444; 
  color: white; 
  border: none; 
  border-radius: 8px; 
  font-weight: bold; 
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}

.danger-zone {
  margin-top: 40px;
  padding: 20px 25px;
  background-color: #fff1f2;
  border: 1px solid #fecaca;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 20px;
}

.danger-content h3 {
  margin: 0;
  color: #991b1b;
  font-size: 1.1rem;
}

.danger-content p {
  margin: 5px 0 0;
  color: #b91c1c;
  font-size: 0.9rem;
}

.btn-request-delete {
  background-color: #dc2626;
  color: white;
  border: none;
  padding: 12px 20px;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.2s ease;
  white-space: nowrap;
}

.btn-request-delete:hover {
  background-color: #b91c1c;
  box-shadow: 0 4px 10px rgba(220, 38, 38, 0.25);
}

.custom-modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 2000;
  backdrop-filter: blur(3px);
}

.custom-modal-content {
  background: white;
  padding: 30px;
  border-radius: 16px;
  width: 90%;
  max-width: 400px;
  text-align: center;
  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
  animation: popIn 0.3s ease-out;
}

@keyframes popIn {
  from { transform: scale(0.9); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}

.modal-icon-warning {
  width: 60px;
  height: 60px;
  background-color: #fee2e2;
  color: #dc2626;
  font-size: 30px;
  font-weight: bold;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 20px auto;
  border: 4px solid #fecaca;
}

.custom-modal-content h3 {
  margin: 0 0 10px 0;
  color: #1f2937;
  font-size: 1.5rem;
}

.custom-modal-content p {
  color: #6b7280;
  margin-bottom: 25px;
  line-height: 1.5;
}

.modal-actions {
  display: flex;
  gap: 12px;
  justify-content: center;
}

.btn-modal-cancel {
  background-color: #e5e7eb;
  color: #374151;
  border: none;
  padding: 12px 20px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
}

.btn-modal-cancel:hover {
  background-color: #d1d5db;
}

.btn-modal-confirm {
  background-color: #dc2626;
  color: white;
  border: none;
  padding: 12px 20px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
}

.btn-modal-confirm:hover {
  background-color: #b91c1c;
  box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
}

.phone-edit-wrapper {
    display: flex;
    align-items: center;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    background: white;
}

.prefix-span {
    padding: 8px 10px;
    background: #f3f4f6;
    color: #6b7280;
    font-weight: 600;
    font-size: 0.9rem;
    border-right: 1px solid #e5e7eb;
    border-top-left-radius: 6px;
    border-bottom-left-radius: 6px;
}

.form-input-edit.phone-input {
    border: none;
    padding: 8px;
    width: 100%;
    outline: none;
    border-top-right-radius: 6px;
    border-bottom-right-radius: 6px;
}

.phone-display {
    font-family: monospace;
    font-size: 1rem;
    letter-spacing: 0.5px;
    color: #1f2937;
}

@media (max-width: 600px) {
  .danger-zone {
    flex-direction: column;
    text-align: center;
  }
  .btn-request-delete {
    width: 100%;
  }
  .modal-actions {
    flex-direction: column;
  }
  .btn-modal-cancel, .btn-modal-confirm {
    width: 100%;
  }
}

.icon-blue {
  color: #2563eb;
}

.icon-red {
  color: #dc2626;
}

.btn-icon {
  margin-right: 5px;
}
</file>

<file path="package.json">
{
  "name": "web-monitoreo",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "test": "vitest",
    "test:coverage": "vitest run --coverage",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "axios": "^1.13.3",
    "lucide-react": "^0.562.0",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-icons": "^5.5.0",
    "react-router-dom": "^7.12.0"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@testing-library/jest-dom": "^6.9.1",
    "@testing-library/react": "^16.3.2",
    "@testing-library/user-event": "^14.6.1",
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "@vitest/coverage-v8": "^4.0.18",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "jsdom": "^27.4.0",
    "vite": "^7.2.4",
    "vitest": "^4.0.18"
  }
}
</file>

<file path="src/components/Admin/AdminStats.jsx">
import React, { useEffect, useState } from 'react';
import { Users, Activity, PieChart } from 'lucide-react';
import { getStats } from '../../services/AdminService';

const AdminStats = () => {
  const [stats, setStats] = useState({
    total: 0,
    admins: 0,
    patients: 0,
    specialists: 0,
    active: 0
  });

  useEffect(() => {
    const loadStats = async () => {
      const data = await getStats();
      
      if (data && data.roles) {
        const adminCount = data.roles.find(r => r.role?.toLowerCase() === 'admin')?.count || 0;
        const specialistCount = data.roles.find(r => r.role?.toLowerCase() === 'specialist')?.count || 0;
        const patientCount = data.roles.find(r => 
          r.role?.toLowerCase() === 'user' || 
          r.role?.toLowerCase() === 'patient'
        )?.count || 0;

        setStats({
          total: data.total || 0,
          active: data.active || 0,
          admins: adminCount,
          patients: patientCount,
          specialists: specialistCount
        });
      }
    };
    loadStats();
  }, []);

  return (
    <div className="stats-grid">
      <div className="health-card-admin">
        <div className="stat-icon icon-blue">
          <Users size={28} />
        </div>
        <div className="stat-info">
          <p className="stats-label">Total Usuarios</p>
          <span className="stats-value">{stats.total}</span>
        </div>
      </div>

      <div className="health-card-admin">
        <div className="stat-icon icon-green">
          <Activity size={28} />
        </div>
        <div className="stat-info">
          <p className="stats-label">Activos (30d)</p>
          <span className="stats-value">{stats.active}</span>
        </div>
      </div>

      <div className="health-card-admin">
        <div className="stat-icon icon-purple">
          <PieChart size={28} />
        </div>
        
        <div className="stat-info-mixed">
          <div className="role-item">
            <div className="role-label-group">
              <span className="role-dot dot-patient"></span>
              <span className="mini-label">Pacientes</span>
            </div>
            <span className="mini-value">{stats.patients}</span>
          </div>

          <div className="role-item">
            <div className="role-label-group">
              <span className="role-dot dot-specialist"></span>
              <span className="mini-label">Especialistas</span>
            </div>
            <span className="mini-value">{stats.specialists}</span>
          </div>

          <div className="role-item">
            <div className="role-label-group">
              <span className="role-dot dot-admin"></span>
              <span className="mini-label">Admins</span>
            </div>
            <span className="mini-value">{stats.admins}</span>
          </div>
        </div>
      </div>
    </div>
  );
};

export default AdminStats;
</file>

<file path="src/components/Admin/UserRow.jsx">
import React from 'react';
import { Key, Trash2, AlertTriangle } from 'lucide-react';
import { resetUserPassword, deleteUser } from '../../services/AdminService';

const UserRow = ({ user, onUpdate }) => {
  if (!user) return null;

  const getRoleLabel = (role) => {
    switch (role?.toLowerCase()) {
      case 'admin': return 'Administrador';
      case 'specialist': return 'Especialista';
      case 'patient': return 'Paciente';
      default: return 'Usuario';
    }
  };

  const getRoleClass = (role) => {
    const r = role?.toLowerCase();
    if (r === 'admin') return 'status-admin';
    if (r === 'specialist') return 'status-specialist';
    return 'status-user';
  };

  const handleReset = async () => {
    if (!user.email) return alert("Este usuario no tiene correo registrado.");
    
    const confirmed = window.confirm(`¿Enviar enlace de recuperación a ${user.email}?`);
    if (confirmed) {
      const { success, error } = await resetUserPassword(user.email);
      if (success) alert("Correo de recuperación enviado con éxito.");
      else alert("Error: " + error);
    }
  };

  const handleDelete = async () => {
    const isDeletionRequested = user.status === 'delete_requested';
    const message = isDeletionRequested
      ? `ATENCIÓN: El paciente ha solicitado ELIMINAR sus datos. ¿Confirmas la eliminación definitiva de ${user.first_names}?`
      : `¿Estás seguro de que deseas eliminar a ${user.first_names}? Esta acción es irreversible.`;

    if (window.confirm(message)) {
      const { success, error } = await deleteUser(user.id);
      if (success) {
        alert("Usuario eliminado correctamente.");
        if (onUpdate) onUpdate(); 
      } else {
        alert("Error al eliminar: " + error);
      }
    }
  };

  return (
    <tr className={`admin-row ${user.status === 'delete_requested' ? 'row-delete-requested' : ''}`}>
      <td>{user.rut || '---'}</td>

      <td className="user-name">
        {user.first_names} {user.last_names}
        
        {user.status === 'delete_requested' && user.delete_requested_at && (
          <div className="deletion-alert">
             <AlertTriangle size={14} />
             Solicitó borrar: {new Date(user.delete_requested_at).toLocaleDateString()}
          </div>
        )}
      </td>

      <td>{user.email}</td>

      <td>
        <span className={`status-badge ${getRoleClass(user.role)}`}>
          {getRoleLabel(user.role)}
        </span>
      </td>

      <td>
        <span className={`status-badge status-${user.status || 'active'}`}>
          {user.status === 'delete_requested' ? 'Por Borrar' : 'Activo'}
        </span>
      </td>

      <td>
        <div className="actions-container">
          <button 
            onClick={handleReset} 
            className="btn-icon btn-key" 
            title="Restablecer Contraseña"
          >
            <Key size={18} />
          </button>
          
          <button 
            onClick={handleDelete} 
            className={`btn-icon btn-trash ${user.status === 'delete_requested' ? 'btn-trash-urgent' : ''}`}
            title="Eliminar permanentemente"
          >
            <Trash2 size={18} />
          </button>
        </div>
      </td>
    </tr>
  );
};

export default UserRow;
</file>

<file path="src/components/Admin/UserTable.jsx">
import React, { useState, useEffect } from 'react';
import { Search, AlertTriangle, RefreshCw } from 'lucide-react';
import { getUsers } from '../../services/AdminService';
import UserRow from './UserRow';

const UserTable = () => {
  const [users, setUsers] = useState([]);
  const [searchTerm, setSearchTerm] = useState("");
  const [loading, setLoading] = useState(true);
  const [showDeleteOnly, setShowDeleteOnly] = useState(false);

  const fetchUsers = async () => {
    setLoading(true);
    const data = await getUsers();
    setUsers(Array.isArray(data) ? data : []);
    setLoading(false);
  };

  useEffect(() => {
    fetchUsers();
  }, []);

  const roleMap = {
    patient: 'paciente',
    specialist: 'especialista',
    admin: 'administrador'
  };

  const filteredUsers = users.filter(user => {
    if (showDeleteOnly && user.status !== 'delete_requested') {
      return false;
    }

    const roleKey = (user.role || "").toLowerCase();
    const roleSpanish = roleMap[roleKey] || roleKey;

    const fullName = `${user.first_names || ''} ${user.last_names || ''}`.toLowerCase();
    const rut = (user.rut || "").toLowerCase();
    const email = (user.email || "").toLowerCase();
    const term = searchTerm.toLowerCase();

    return (
      fullName.includes(term) || 
      rut.includes(term) || 
      email.includes(term) || 
      roleSpanish.includes(term)
    );
  });

  if (loading) return <div className="loading-text">Cargando usuarios...</div>;

  return (
    <div className="admin-table-container">
      <div className="table-controls">
        <div className="controls-wrapper">
            
            <div className="search-container">
                <Search className="search-icon" size={18} />
                <input
                    type="text"
                    placeholder="Buscar por nombre, RUT, rol..."
                    className="search-input"
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                />
            </div>

            <button 
                onClick={() => setShowDeleteOnly(!showDeleteOnly)}
                className={`btn-filter ${showDeleteOnly ? 'active' : ''}`}
            >
                <AlertTriangle size={18} />
                {showDeleteOnly ? 'Mostrando Solicitudes' : 'Ver Solicitudes de Borrado'}
            </button>

            <button 
                onClick={fetchUsers}
                className="btn-icon btn-reload"
                title="Recargar lista"
            >
                <RefreshCw size={18} />
            </button>
        </div>
      </div>

      <div className="table-scroll-wrapper">
        <table className="admin-table">
          <thead>
            <tr>
              <th>RUT</th>
              <th>Nombre Completo</th>
              <th>Email</th>
              <th>Rol</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            {filteredUsers.length > 0 ? (
              filteredUsers.map((user) => (
                <UserRow 
                  key={user.id} 
                  user={user} 
                  onUpdate={fetchUsers} 
                />
              ))
            ) : (
              <tr>
                <td colSpan="6" className="no-data-cell">
                  {showDeleteOnly 
                    ? "No hay solicitudes de eliminación pendientes." 
                    : searchTerm 
                        ? `No se encontraron resultados para "${searchTerm}"`
                        : "No hay usuarios registrados."
                  }
                </td>
              </tr>
            )}
          </tbody>
        </table>
      </div>
    </div>
  );
};

export default UserTable;
</file>

<file path="src/components/Dashboard/GlucoseCard.jsx">
import { FaTint } from "react-icons/fa";
import { formatDateLong } from "../../utils/formatDate";

export default function GlucoseCard({ glucose, date }) {
  let level = "normal";

  if (glucose >= 200) level = "danger";
  else if (glucose >= 141) level = "warning";

  return (
    <div className={`card glucose-card ${level}`}>
      <div className="card-header">
        <div className="icon-circle glucose-icon">
          <FaTint />
          <span className="droplet"></span>
        </div>
        <span className={`status ${level}`}>
          {level === "normal" && "Normal"}
          {level === "warning" && "Alerta"}
          {level === "danger" && "Peligro"}
        </span>
      </div>

      <h3>Glucosa</h3>
      <p className="value">{glucose} mg/dL</p>

      <span className="date">{formatDateLong(date)}</span>
    </div>
  );
}
</file>

<file path="src/components/Dashboard/PressureCard.jsx">
import { FaHeartbeat } from "react-icons/fa";
import { formatDateLong } from "../../utils/formatDate";

export default function PressureCard({ systolic, diastolic, date }) {
  let level = "normal";

  if (systolic >= 140 || diastolic >= 90) level = "danger";
  else if (systolic >= 130 || diastolic >= 85) level = "warning";

  return (
    <div className={`card pressure-card ${level}`}>
      <div className="card-header">
        <div className="icon-circle pressure-icon">
          <FaHeartbeat />
        </div>
        <span className={`status ${level}`}>
          {level === "normal" && "Normal"}
          {level === "warning" && "Alerta"}
          {level === "danger" && "Peligro"}
        </span>
      </div>

      <h3>Presión Arterial</h3>
      <p className="value">{systolic}/{diastolic} mmHg</p>

      <span className="date">{formatDateLong(date)}</span>
    </div>
  );
}
</file>

<file path="src/pages/AdminPage.jsx">
import React, { useState } from 'react';
import { UserPlus } from 'lucide-react';
import AdminStats from '../components/Admin/AdminStats';
import UserTable from '../components/Admin/UserTable';
import RegisterSpecialistModal from '../components/Admin/RegisterSpecialistModal';
import '../Styles/AdminStyles.css';

const AdminPage = () => {
  const [showModal, setShowModal] = useState(false);
  const [refreshKey, setRefreshKey] = useState(0);

  const handleSuccess = () => {
    setRefreshKey(prev => prev + 1);
  };

  return (
    <div className="admin-page-wrapper">
      <header className="admin-header">
        <div className="header-content">
            <div>
                <h1>Panel de Control</h1>
                <p>Gestión de usuarios y pacientes.</p>
            </div>
            
            <button 
                className="btn-create-specialist" 
                onClick={() => setShowModal(true)}
            >
                <UserPlus size={20} />
                Nuevo Especialista
            </button>
        </div>
      </header>
      
      <AdminStats key={`stats-${refreshKey}`} />
      
      <h3 className="section-title">Lista de Usuarios</h3>
      
      <UserTable key={`table-${refreshKey}`} />

      {showModal && (
        <RegisterSpecialistModal 
            onClose={() => setShowModal(false)} 
            onSuccess={handleSuccess} 
        />
      )}
    </div>
  );
};

export default AdminPage;
</file>

<file path="src/pages/HomePage.jsx">
import { useState, useEffect } from "react";
import "../Styles/homeStyles.css";
import { useNavigate } from "react-router-dom";
import carrusel1 from '../assets/carrusel-1.png';
import carrusel2 from '../assets/imagen2.png';
import carrusel3 from '../assets/carrusel-3.png';

import DrChapatinSection from "../components/Landing/DrChapatinSection"; 
import HowToUseSection from "../components/Landing/HowToUseSection"; 

function HomePage() {
  const navigate = useNavigate();
  const [currentIndex, setCurrentIndex] = useState(0);

  const slides = [
    {
      badge: "Salud explicada por IA",
      title: "Monitorea tu Presión y Glucosa con Inteligencia Artificial",
      text: "Controla tus niveles de presión arterial y glucosa de forma simple, segura y confiable.",
      image: carrusel1,
    },
    {
      badge: "Tecnología de Vanguardia",
      title: "Análisis Clínico en Lenguaje Simple",
      text: "Nuestra plataforma te ayuda a detectar riesgos a tiempo y tomar mejores decisiones para tu salud.",
      image: carrusel2, 
    },
    {
      badge: "Vive tranquilo",
      title: "Tus Datos Médicos están Seguros",
      text: "Implementamos altos estándares de seguridad y cifrado para que tu información personal esté siempre protegida.",
      image: carrusel3,
    }
  ];

  useEffect(() => {
    const interval = setInterval(() => {
      nextSlide();
    }, 5000);
    return () => clearInterval(interval);
  }, [currentIndex]);

  const nextSlide = () => {
    setCurrentIndex((prev) => (prev === slides.length - 1 ? 0 : prev + 1));
  };

  const prevSlide = () => {
    setCurrentIndex((prev) => (prev === 0 ? slides.length - 1 : prev - 1));
  };

  return (
    <>
      <section className="hero-modern-container">
        <button className="carousel-arrow left" onClick={prevSlide}>&#10094;</button>
        <button className="carousel-arrow right" onClick={nextSlide}>&#10095;</button>

        <div className="hero hero-modern">
          <div className="hero-text">
            <span className="badge">{slides[currentIndex].badge}</span>
            <h1>{slides[currentIndex].title}</h1>
            <p>{slides[currentIndex].text}</p>
            <button className="btn-primary big" onClick={() => navigate("/login")}>
              Comenzar Ahora
            </button>
          </div>

          <div className="hero-image">
            <img 
              src={slides[currentIndex].image} 
              alt="Monitoreo de salud" 
              className="fade-in" 
              key={currentIndex} 
            />
          </div>
        </div>

        <div className="carousel-dots">
          {slides.map((_, index) => (
            <span 
              key={index} 
              className={`dot ${index === currentIndex ? "active" : ""}`}
              onClick={() => setCurrentIndex(index)}
            ></span>
          ))}
        </div>
      </section>

      <DrChapatinSection />

      <HowToUseSection />

      <section className="cta">
        <h2>¿Listo para mejorar tu salud?</h2>
        <p>Únete a miles de personas que ya confían en Salud al Día.</p>
        <button className="btn-white" onClick={() => navigate("/signup")}>Crear Cuenta Ahora</button>
      </section>
      
    </>
  );
}

export default HomePage;
</file>

<file path="src/Styles/AdminStyles.css">
.admin-page-wrapper {
  padding: 40px;
  max-width: 1200px;
  margin: 0 auto;
  font-family: 'Segoe UI', sans-serif;
}

.admin-header {
  margin-bottom: 30px;
}

.header-content {
  display: flex;
  justify-content: space-between;
  align-items: flex-end;
  flex-wrap: wrap;
  gap: 20px;
}

.admin-header h1 {
  color: #1e3a8a;
  font-size: 2rem;
  margin: 0 0 5px 0;
}

.admin-header p {
  color: #64748b;
  margin: 0;
}

.section-title {
  color: #1e293b;
  margin-bottom: 15px;
  font-size: 1.5rem;
}

.btn-create-specialist {
  background-color: #2563eb;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  transition: background-color 0.2s, transform 0.2s;
  box-shadow: 0 4px 6px rgba(37, 99, 235, 0.2);
}

.btn-create-specialist:hover {
  background-color: #1d4ed8;
  transform: translateY(-2px);
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.health-card-admin {
  background: white;
  padding: 1.5rem;
  border-radius: 12px;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  border-top: 6px solid #1e40af;
  border-left: 1px solid #e2e8f0;
  border-right: 1px solid #e2e8f0;
  border-bottom: 1px solid #e2e8f0;
  display: flex;
  align-items: center;
  gap: 20px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  cursor: default; 
}

.health-card-admin:hover {
  transform: translateY(-5px);
  background-color: #f8fafc;
  box-shadow: 0 15px 30px -5px rgba(30, 64, 175, 0.15);
  border-color: #cbd5e1;
}

.stat-icon {
  padding: 12px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  min-width: 50px;
}

.icon-blue { background: #eef2ff; color: #1e40af; }
.icon-green { background: #f0fdf4; color: #16a34a; }
.icon-orange { background: #fff7ed; color: #f97316; }
.icon-purple { background: #f5f3ff; color: #7c3aed; }
.icon-indigo { background: #e0e7ff; color: #4338ca; }

.stat-info, .stat-info-mixed {
  flex: 1;
}

.stat-info-mixed {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.role-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.role-label-group {
  display: flex;
  align-items: center;
  gap: 8px;
}

.role-dot {
  width: 7px;
  height: 7px;
  border-radius: 50%;
}

.dot-patient { background-color: #16a34a; }
.dot-specialist { background-color: #1e40af; }
.dot-admin { background-color: #7e22ce; }

.stats-label {
  margin: 0;
  color: #64748b;
  font-size: 0.85rem;
  text-transform: uppercase;
  font-weight: 700;
  letter-spacing: 0.5px;
}

.stats-value {
  font-size: 1.8rem;
  font-weight: 900;
  color: #1e293b;
  margin: 0;
  display: block;
}

.mixed-value {
  font-weight: 800;
  color: #1e293b;
  font-size: 1.1rem;
}

.admin-table-container {
  background: white;
  border-radius: 12px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.08);
  border-top: 6px solid #1e40af;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

.table-controls {
  padding: 20px;
  background-color: #ffffff;
  border-bottom: 1px solid #f1f5f9;
}

.controls-wrapper {
  display: flex; 
  gap: 15px; 
  flex-wrap: wrap; 
  align-items: center;
}

.search-container {
  position: relative;
  display: flex;
  align-items: center;
  flex: 1;
  min-width: 250px;
}

.search-icon {
  position: absolute;
  left: 14px;
  color: #94a3b8;
  pointer-events: none;
}

.search-input {
  width: 100%;
  padding: 12px 16px 12px 42px;
  border: 1px solid #e2e8f0;
  border-radius: 10px;
  font-size: 0.9rem;
  background-color: #f8fafc;
  transition: all 0.2s ease;
  outline: none;
}

.search-input:focus {
  background-color: #ffffff;
  border-color: #1e40af;
  box-shadow: 0 0 0 4px rgba(30, 64, 175, 0.1);
}

.btn-filter {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 16px;
  border-radius: 8px;
  border: 1px solid #e2e8f0;
  background-color: white;
  color: #64748b;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.2s;
}

.btn-filter.active {
  border: 1px solid #ef4444;
  background-color: #fee2e2;
  color: #b91c1c;
}

.btn-reload {
  height: 42px; 
  width: 42px;
}

.table-scroll-wrapper {
  max-height: 500px; 
  overflow-y: auto;
  overflow-x: auto; 
}

.admin-table {
  width: 100%;
  border-collapse: collapse;
  min-width: 800px;
}

.admin-table th {
  background-color: #f8fafc;
  color: #1e40af;
  padding: 15px;
  font-weight: bold;
  border-bottom: 3px solid #cbd5e1;
  text-transform: uppercase;
  font-size: 0.8rem;
  text-align: left;
  position: sticky;
  top: 0;
  z-index: 10;
}

.admin-table td {
  padding: 15px;
  border-bottom: 1px solid #cbd5e1;
  color: #334155;
  font-size: 0.95rem;
  vertical-align: middle;
}

.admin-row:nth-child(even) {
  background-color: #f1f5f9;
}

.admin-row:hover {
  background-color: #e2e8f0 !important;
}

.row-delete-requested {
  background-color: #fff1f2 !important;
}

.user-name {
  font-weight: bold;
  color: #1e293b;
}

.deletion-alert {
  font-size: 0.75rem; 
  color: #dc2626; 
  font-weight: bold; 
  margin-top: 4px;
  display: flex;
  align-items: center;
  gap: 4px;
}

.status-badge {
  padding: 6px 14px;
  border-radius: 99px;
  font-size: 0.75rem;
  font-weight: 800;
  text-transform: uppercase;
  display: inline-block;
  white-space: nowrap;
}

.status-active, 
.status-user, 
.status-patient { 
  background: #dcfce7; 
  color: #166534; 
}

.status-specialist { 
  background: #dbeafe; 
  color: #1e40af; 
}

.status-admin { 
  background: #f3e8ff; 
  color: #7e22ce; 
  border: 1px solid #d8b4fe;
}

.status-delete_requested { 
  background: #fee2e2; 
  color: #991b1b; 
  border: 1px solid #f87171;
  animation: pulse-red 2s infinite;
}

@keyframes pulse-red {
  0% { box-shadow: 0 0 0 0 rgba(248, 113, 113, 0.4); }
  70% { box-shadow: 0 0 0 10px rgba(248, 113, 113, 0); }
  100% { box-shadow: 0 0 0 0 rgba(248, 113, 113, 0); }
}

.actions-container {
  display: flex;
  gap: 8px;
}

.btn-icon {
  border: none;
  background: #f1f5f9;
  cursor: pointer;
  padding: 8px;
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
  color: #64748b;
  min-width: 36px;
  min-height: 36px;
}

.btn-icon:hover {
  transform: translateY(-2px);
}

.btn-key:hover { background: #dbeafe; color: #1e40af; }
.btn-trash:hover { background: #fee2e2; color: #ef4444; }
.btn-trash-urgent { color: #ef4444; background: #fee2e2; }

.modal-overlay {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.6);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 2000;
  padding: 20px;
  backdrop-filter: blur(4px);
}

.modal-content {
  background: white;
  padding: 2rem;
  border-radius: 12px;
  width: 100%;
  max-width: 500px;
  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
  animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
  from { opacity: 0; transform: translateY(-20px); }
  to { opacity: 1; transform: translateY(0); }
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.modal-header h3 {
  margin: 0;
  color: #1e3a8a;
  display: flex;
  align-items: center;
  gap: 10px;
}

.btn-close-modal {
  background: none;
  border: none;
  cursor: pointer;
  color: #64748b;
}

.form-grid-2 {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 15px;
}

.input-group-reset {
  margin-bottom: 15px;
}

.input-group-reset label {
  display: block;
  margin-bottom: 5px;
  color: #334155;
  font-weight: 600;
  font-size: 0.9rem;
}

.input-icon-wrapper {
  position: relative;
}

.input-icon {
  position: absolute;
  top: 11px;
  left: 10px;
  color: #94a3b8;
}

.input-reset {
  width: 100%;
  padding: 10px 12px;
  border: 1px solid #cbd5e1;
  border-radius: 8px;
  font-size: 0.95rem;
  transition: all 0.2s;
  box-sizing: border-box;
}

.input-with-icon {
  padding-left: 35px;
}

.input-reset:focus {
  border-color: #2563eb;
  outline: none;
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

.modal-actions {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
  margin-top: 25px;
  padding-top: 15px;
  border-top: 1px solid #f1f5f9;
}

.btn-cancel {
  padding: 10px 18px;
  border: 1px solid #e2e8f0;
  background: white;
  color: #64748b;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.2s;
}

.btn-cancel:hover {
  background: #f8fafc;
  color: #1e293b;
}

.btn-confirm {
  padding: 10px 18px;
  background: #2563eb;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.2s;
}

.btn-confirm:hover {
  background: #1d4ed8;
}

.btn-confirm:disabled {
  background: #93c5fd;
  cursor: not-allowed;
}

.no-data-cell {
  text-align: center; 
  padding: 30px; 
  color: #64748b;
}

@media (max-width: 768px) {
  .admin-page-wrapper {
    padding: 15px;
  }
  
  .header-content {
    flex-direction: column;
    align-items: stretch;
  }
  
  .btn-create-specialist {
    justify-content: center;
  }

  .admin-table-container {
    max-width: 100%; 
  }
  
  .table-scroll-wrapper {
    max-height: 60vh;
  }
} 

.input-error-border {
  border-color: #ef4444 !important;
  box-shadow: 0 0 0 1px rgba(239, 68, 68, 0.1);
}

.error-msg {
  color: #ef4444;
  font-size: 0.8rem;
  margin-top: 5px;
  display: block;
  font-weight: 600;
  animation: fadeIn 0.3s ease-in;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-5px); }
  to { opacity: 1; transform: translateY(0); }
}
</file>

<file path="src/Styles/medicalRecordsStyles.css">
.medical-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  background-color: #f0f4f8;
  padding: 20px;
}

.medical-box {
  background: white;
  padding: 30px;
  border-radius: 12px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  max-width: 600px;
  width: 100%;
}

.medical-header {
  text-align: center;
  margin-bottom: 20px;
}

.medical-logo {
  height: 60px;
}

.form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 15px;
}

.full-width {
  grid-column: span 2;
}

.form-group label {
  display: block;
  font-weight: bold;
  margin-bottom: 5px;
  color: #1e40af;
}

.form-group input, .form-group select, .form-group textarea {
  width: 100%;
  padding: 10px;
  border: 1px solid #cbd5e1;
  border-radius: 6px;
  font-family: inherit;
  font-size: 1rem;
  color: #333;
}

.btn-medical {
  grid-column: span 2;
  background-color: #1e40af;
  color: white;
  padding: 12px;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
  font-size: 1rem;
  transition: all 0.3s ease;
}

.btn-medical:disabled {
  background-color: #93c5fd;
  color: #e0f2fe; 
  cursor: not-allowed; 
  opacity: 0.8;
  box-shadow: none;
}

.btn-medical:not(:disabled):hover {
  background-color: #1e3a8a;
  transform: translateY(-1px);
}

.checkbox-container {
  margin-top: 20px;
  margin-bottom: 25px;
  background-color: #eff6ff;
  border: 1px solid #dbeafe;
  border-radius: 8px;
  padding: 15px;
  transition: all 0.2s ease-in-out;
}

.checkbox-container:hover {
  background-color: #e0f2fe;
  border-color: #1e40af;
  box-shadow: 0 2px 4px rgba(30, 64, 175, 0.1);
}

.checkbox-label {
  display: flex;
  align-items: flex-start; 
  gap: 15px;
  cursor: pointer;
  text-align: left;
  user-select: none;
}

.checkbox-label input[type="checkbox"] {
  width: 20px;
  height: 20px;
  margin-top: 5px; 
  margin-right: 8px; 
  accent-color: #1e40af;
  flex-shrink: 0; 
  cursor: pointer;
}

.checkbox-text {
  font-size: 0.9rem;
  line-height: 1.6; 
  color: #334155;
}

.phone-input-group {
    display: flex;
    align-items: center;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    background: white;
    overflow: hidden;
    transition: border-color 0.2s;
    width: 100%;
}

.phone-input-group:focus-within {
    border-color: #2563eb;
    box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.1);
}

.phone-input-group.input-error {
    border-color: #dc2626;
}

.country-prefix {
    background: #f3f4f6;
    padding: 10px 15px;
    color: #4b5563;
    font-weight: 600;
    font-size: 1rem;
    border-right: 1px solid #e5e7eb;
    white-space: nowrap;
}

.phone-field {
    border: none !important;
    flex: 1;
    padding: 10px !important;
    outline: none;
    border-radius: 0 !important;
}

.error-text {
    color: #dc2626;
    font-size: 0.8rem;
    margin-top: 4px;
    display: block;
}

.hint-text {
    color: #6b7280;
    font-size: 0.8rem;
    margin-top: 4px;
    display: block;
}
</file>

<file path="src/Styles/NavbarStyles.css">
.navbar {
  width: 100%;
  background-color: #ffffff;
  border-bottom: 1px solid #f0f0f0;
  position: sticky;
  top: 0;
  z-index: 1000;
  height: 75px;
  display: flex;
  align-items: center;
  transition: box-shadow 0.3s ease;
}

.navbar-container {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 90%;
  max-width: 1200px;
  margin: 0 auto;
}

.nav-logo {
  display: flex;
  align-items: center;
  transition: transform 0.3s;
  margin-right: auto;
  z-index: 1002;
}

.nav-logo:hover {
  transform: scale(1.05);
}

.logo-img {
  height: 45px;
  width: auto;
}

.nav-collapse {
  display: flex;
  align-items: center;
  gap: 30px;
}

.nav-menu {
  display: flex;
  gap: 25px;
}

.nav-item {
  text-decoration: none;
  color: #4b5563;
  font-size: 0.95rem;
  font-weight: 500;
  position: relative; 
  transition: color 0.3s ease;
  display: flex;
  align-items: center;
  gap: 6px;
}

.nav-item::after {
  content: '';
  position: absolute;
  width: 0;
  height: 2px;
  bottom: -4px;
  left: 0;
  background-color: #2563eb;
  transition: width 0.3s ease-in-out;
}

.nav-item:hover { color: #2563eb; }
.nav-item:hover::after { width: 100%; }

/* Estilo específico para el link del Panel Médico */
.nav-special-link {
  color: #2563eb;
  font-weight: 600;
}
.nav-icon-inline {
  color: #2563eb;
}

.nav-auth {
  display: flex;
  align-items: center;
  gap: 15px;
}

.nav-user-area {
  display: flex;
  align-items: center;
  gap: 15px;
}

/* Botones principales - Respetando tu CSS original */
.btn-login, .btn-register {
  height: 40px !important; 
  width: 140px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0;
  padding: 0;
  border-radius: 8px;
  font-size: 0.9rem;
  font-weight: 600;
  text-decoration: none;
  cursor: pointer;
  transition: all 0.3s ease;
  box-sizing: border-box !important; 
}

.btn-login {
  background-color: transparent;
  color: #2563eb;
  border: 2px solid #e5e7eb; 
}

.btn-login:hover {
  background-color: #f0f9ff;
  border-color: #2563eb;
}

.btn-register {
  background-color: #2563eb;
  color: white;
  border: 2px solid #2563eb; 
}

.btn-register:hover {
  background-color: #1d4ed8;
  border-color: #1d4ed8;
}

/* Botón cerrar sesión general (reutiliza estilos de btn-login pero ajustado) */
.btn-logout-general {
  border-color: #e5e7eb;
  color: #ef4444;
}
.btn-logout-general:hover {
  background-color: #fef2f2;
  border-color: #ef4444;
  color: #dc2626;
}

/* --- ESTILOS DE ESPECIALISTA INTEGRADOS --- */

.specialist-nav-badge {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-right: 5px;
}

.specialist-info {
  text-align: right;
  line-height: 1.2;
}

.specialist-name {
  display: block;
  font-weight: bold;
  color: #1e3a8a;
  font-size: 0.9rem;
  white-space: nowrap;
}

.specialist-role {
  font-size: 0.75rem;
  color: #64748b;
  display: block;
  text-transform: uppercase;
}

.specialist-icon-box {
  background: #eff6ff;
  padding: 8px;
  border-radius: 50%;
  color: #2563eb;
  border: 1px solid #bfdbfe;
  display: flex;
  align-items: center;
  justify-content: center;
}

.btn-logout-specialist {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 0 16px;
  height: 40px;
  border: 1px solid #e2e8f0;
  color: #64748b;
  background: white;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.2s;
  box-sizing: border-box;
}

.btn-logout-specialist:hover {
  background-color: #f8fafc;
  color: #dc2626;
  border-color: #fee2e2;
}

.sos-desktop-wrapper {
  display: block; 
}

.nav-mobile-actions {
  display: none; 
  align-items: center;
  gap: 15px;
}

.hamburger {
  display: none;
  cursor: pointer;
}

.bar {
  display: block;
  width: 25px;
  height: 3px;
  margin: 5px auto;
  transition: all 0.3s ease-in-out;
  background-color: #333; 
}

@media screen and (max-width: 900px) {
  .nav-mobile-actions {
    display: flex;
    margin-left: auto;
    z-index: 1002;
  }

  .hamburger {
    display: block; 
  }

  .sos-desktop-wrapper {
    display: none;
  }

  .nav-collapse {
    position: fixed;
    left: -100%;
    top: 75px; 
    flex-direction: column;
    background-color: #ffffff;
    width: 100%;
    height: calc(100vh - 75px); 
    text-align: center;
    transition: 0.3s ease-in-out;
    box-shadow: 0 10px 10px rgba(0,0,0,0.1);
    padding-top: 40px;
    gap: 30px; 
  }

  .nav-collapse.active {
    left: 0;
  }

  .nav-menu {
    flex-direction: column;
    gap: 25px;
    width: 100%;
  }

  .nav-auth {
    flex-direction: column;
    gap: 20px;
    width: 100%;
    margin-top: 20px;
  }
  
  .nav-user-area {
    flex-direction: column;
    gap: 20px;
    width: 100%;
    justify-content: center;
  }

  .specialist-nav-badge {
    flex-direction: row; 
    justify-content: center;
    margin-right: 0;
  }

  .nav-item {
    font-size: 1.1rem;
    display: block;
    width: 100%;
    padding: 10px 0;
    justify-content: center;
  }

  .hamburger.active .bar:nth-child(2) { opacity: 0; }
  .hamburger.active .bar:nth-child(1) { transform: translateY(8px) rotate(45deg); }
  .hamburger.active .bar:nth-child(3) { transform: translateY(-8px) rotate(-45deg); }

  .sos-mobile-wrapper .sos-button-final {
    padding: 0 12px;
    height: 36px;
    font-size: 0.8rem;
  }
}
</file>

<file path="src/Styles/SosButtonStyles.css">
.sos-button-final {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  height: 40px; 
  box-sizing: border-box;
  background-color: #dc2626;
  color: white;
  border: none;
  border-radius: 50px;
  padding: 0 20px;
  gap: 8px;
  font-weight: 800;
  font-size: 0.9rem;
  letter-spacing: 0.5px;
  cursor: pointer;
  box-shadow: 0 4px 10px rgba(220, 38, 38, 0.4);
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  animation: pulse-emergency 2s infinite;
  z-index: 1000;
}

.sos-button-final:hover {
  background-color: #b91c1c;
  transform: scale(1.05);
  box-shadow: 0 6px 15px rgba(220, 38, 38, 0.5);
}

.sos-button-final:disabled {
  background-color: #ef4444;
  cursor: not-allowed;
  animation: none;
  opacity: 0.7;
}

@keyframes pulse-emergency {
  0% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7); }
  70% { box-shadow: 0 0 0 10px rgba(220, 38, 38, 0); }
  100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0); }
}

.sos-modal-overlay {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0, 0, 0, 0.75); 
  backdrop-filter: blur(5px);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

.sos-modal-content {
  position: relative;
  background: white;
  padding: 30px;
  border-radius: 20px;
  width: 90%;
  max-width: 400px;
  text-align: center;
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
  border-top: 10px solid #dc2626;
  animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

@keyframes popIn {
  from { transform: scale(0.8); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}

.sos-modal-close-icon {
    position: absolute;
    top: 15px;
    right: 15px;
    background: transparent;
    border: none;
    color: #9ca3af;
    cursor: pointer;
    padding: 5px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: color 0.2s;
}

.sos-modal-close-icon:hover {
    color: #111827;
}

.sos-modal-header-icon {
  margin-bottom: 10px;
  display: flex;
  justify-content: center;
}

.sos-alert-icon {
  color: #dc2626;
}

.sos-modal-content h3 {
    margin: 10px 0;
    color: #111827;
    font-weight: 800;
}

.sos-info-text {
  color: #4b5563;
  margin-bottom: 20px;
  font-size: 0.95rem;
  line-height: 1.5;
}

.phone-display-box {
  background: #f3f4f6;
  border: 2px dashed #d1d5db;
  padding: 15px;
  border-radius: 12px;
  margin-bottom: 25px;
  cursor: pointer;
  transition: all 0.2s ease;
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.phone-display-box:hover {
    background: #e5e7eb;
    border-color: #9ca3af;
    transform: translateY(-2px);
}

.phone-display-box:active {
    transform: translateY(0);
}

.phone-number {
  font-family: monospace;
  font-size: 1.6rem;
  font-weight: 800;
  color: #b91c1c;
  display: block;
}

.copy-indicator {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: 0.75rem;
    color: #6b7280;
    margin-top: 5px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.sos-modal-actions-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.btn-whatsapp-action,
.btn-call-action,
.btn-cancel-action {
  width: 100%;
  padding: 12px;
  border-radius: 10px;
  font-weight: 700;
  font-size: 1rem;
  cursor: pointer;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  transition: filter 0.2s, transform 0.1s;
}

.btn-whatsapp-action {
  background-color: #25D366; 
  color: white;
  box-shadow: 0 4px 6px -1px rgba(37, 211, 102, 0.3);
}

.btn-call-action {
  background-color: #2563eb; 
  color: white;
  box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.3);
}

.btn-cancel-action {
  background-color: transparent;
  color: #6b7280;
  border: 1px solid #d1d5db;
}

.btn-whatsapp-action:hover, 
.btn-call-action:hover {
  filter: brightness(0.9);
  transform: translateY(-1px);
}

.btn-cancel-action:hover {
  background-color: #f3f4f6;
  color: #374151;
}
</file>

<file path="src/components/Chat/ChatWidget.jsx">
import React, { useState, useEffect, useRef } from 'react';
import { HeartPulse, X, Send, Stethoscope, Activity, Loader2 } from 'lucide-react';
import axios from 'axios'; 
import '../../Styles/ChatWidgetStyles.css';

const ChatWidget = ({ userId }) => {
  if (!userId) return null;

  const [isOpen, setIsOpen] = useState(false);
  const [messages, setMessages] = useState([]);
  const [input, setInput] = useState('');
  const [loading, setLoading] = useState(false);
  const scrollRef = useRef(null);

  const API_URL = import.meta.env.VITE_AI_MS_URL || 'http://localhost:3002';

  useEffect(() => {
    setMessages([{ 
      role: 'assistant', 
      content: 'Hola. Soy el Dr. Chapatín, tu asistente médico virtual. ¿En qué puedo orientarte con tu salud hoy?' 
    }]);
    setIsOpen(false);
  }, [userId]);

  useEffect(() => {
    scrollRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [messages, loading]);

  const sendMessage = async (e) => {
    e.preventDefault();
    if (!input.trim() || loading) return;

    const currentInput = input;
    setMessages(prev => [...prev, { role: 'user', content: currentInput }]);
    setInput('');
    setLoading(true);

    try {
      const response = await axios.post(`${API_URL}/api/ai/send`, { 
        userId, 
        message: currentInput 
      }, {
        headers: { 'Content-Type': 'application/json' }
      });

      setMessages(prev => [...prev, { role: 'assistant', content: response.data.response }]);
    } catch (error) {
      setMessages(prev => [...prev, { role: 'assistant', content: 'Lo siento, tengo dificultades técnicas. Intenta más tarde.' }]);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="chat-container">
      <button 
        className={`chat-button ${isOpen ? 'open' : ''}`} 
        onClick={() => setIsOpen(!isOpen)}
        aria-label={isOpen ? "Cerrar asistente" : "Abrir Asistente Médico Virtual"}
      >
        {isOpen ? <X size={28} /> : <HeartPulse size={32} />}
        {!isOpen && <span className="notification-dot"></span>}
      </button>

      {isOpen && (
        <div className="chat-window">
          <div className="chat-header">
            <div className="header-info">
              <div className="bot-avatar-container">
                <Stethoscope size={26} className="bot-avatar-icon" />
              </div>
              <div>
                <p className="bot-name">Dr. Chapatín</p>
                <div className="online-indicator">
                  <Activity size={12} className="status-icon" />
                  Asistente Médico IA
                </div>
              </div>
            </div>
          </div>

          <div className="chat-messages">
            {messages.map((m, i) => (
              <div key={i} className={`message ${m.role === 'user' ? 'user' : 'ai'}`}>
                {m.content}
              </div>
            ))}
            
            {loading && (
              <div className="message ai loading-container">
                <Loader2 className="animate-spin" size={18} />
                <span>Analizando...</span>
              </div>
            )}
            <div ref={scrollRef} />
          </div>

          <form className="chat-input-area" onSubmit={sendMessage}>
            <input 
              className="chat-input"
              value={input}
              onChange={(e) => setInput(e.target.value)}
              placeholder="Describe tus síntomas..."
              disabled={loading}
              autoFocus
            />
            <button 
              className="send-button" 
              type="submit" 
              disabled={loading || !input.trim()}
            >
              <Send size={18} />
            </button>
          </form>
        </div>
      )}
    </div>
  );
};

export default ChatWidget;
</file>

<file path="src/components/SosButton.jsx">
import React, { useState } from "react";
import axios from "axios";
import {
  AlertTriangle,
  Phone,
  MessageCircle,
  X,
  Copy,
  Check,
  Siren,
} from "lucide-react";
import "../Styles/SosButtonStyles.css";

const SosButton = () => {
  const [showModal, setShowModal] = useState(false);
  const [contactPhone, setContactPhone] = useState(null);
  const [loading, setLoading] = useState(false);
  const [copied, setCopied] = useState(false);

  const USER_ID = localStorage.getItem("user_id");

  const handleSOSClick = async () => {
    if (!USER_ID) {
      console.warn("Usuario no autenticado para SOS");
      return;
    }

    setLoading(true);
    try {
      const API_SOS_URL = import.meta.env.VITE_API_SOS_URL || "http://localhost:3000";

      const response = await axios.get(
        `${API_SOS_URL}/api/sos/emergency-contact/${USER_ID}`,
        {
          headers: { Authorization: `Bearer ${localStorage.getItem("token")}` },
        }
      );

      const data = response.data;

      if (data.success && data.phone) {
        setContactPhone(data.phone);
        setShowModal(true);
        setCopied(false);
      } else {
        console.warn(data.message || "Sin contacto de emergencia");
      }
    } catch (err) {
      console.error("Error servicio SOS:", err);
    } finally {
      setLoading(false);
    }
  };

  const handleCall = () => {
    if (contactPhone) window.location.href = `tel:${contactPhone}`;
  };

  const handleWhatsApp = () => {
    if (contactPhone) {
      const cleanNum = contactPhone.replace(/\D/g, "");
      const message = encodeURIComponent("¡EMERGENCIA! Necesito ayuda urgente.");
      window.open(`https://wa.me/${cleanNum}?text=${message}`, "_blank");
    }
  };

  const handleCopyNumber = () => {
    if (contactPhone) {
      navigator.clipboard.writeText(contactPhone);
      setCopied(true);
      setTimeout(() => setCopied(false), 2000);
    }
  };

  return (
    <>
      <button
        className={`sos-button-final ${loading ? "loading" : ""}`}
        onClick={handleSOSClick}
        disabled={loading}
        aria-label="Emergencia SOS"
      >
        <Siren size={20} />
        <span>{loading ? "..." : "SOS"}</span>
      </button>

      {showModal && (
        <div className="sos-modal-overlay">
          <div className="sos-modal-content">
            <button
              className="sos-modal-close-icon"
              onClick={() => setShowModal(false)}
            >
              <X size={24} />
            </button>

            <div className="sos-modal-header-icon">
              <AlertTriangle size={48} className="sos-alert-icon" />
            </div>

            <h3>Ayuda de Emergencia</h3>
            <p className="sos-info-text">
              Selecciona una opción para contactar a tu enlace de confianza:
            </p>

            <div
              className="phone-display-box"
              onClick={handleCopyNumber}
              title="Haz clic para copiar"
            >
              <span className="phone-number">{contactPhone}</span>
              <div className="copy-indicator">
                {copied ? <Check size={14} /> : <Copy size={14} />}
                <span>{copied ? "Copiado" : "Copiar"}</span>
              </div>
            </div>

            <div className="sos-modal-actions-list">
              <button className="btn-whatsapp-action" onClick={handleWhatsApp}>
                <MessageCircle size={20} />
                Enviar WhatsApp
              </button>

              <button className="btn-call-action" onClick={handleCall}>
                <Phone size={20} />
                Llamar por Teléfono
              </button>

              <button
                className="btn-cancel-action"
                onClick={() => setShowModal(false)}
              >
                Cancelar
              </button>
            </div>
          </div>
        </div>
      )}
    </>
  );
};

export default SosButton;
</file>

<file path="src/pages/HistoryPage.jsx">
import { useEffect, useState } from "react";
import axios from 'axios'; 
import "../Styles/HistoryStyles.css";
import { descargarHistorial } from "../services/downloadService";
import { formatDateLong } from "../utils/formatDate";

export default function HistoryPage() {
  const [history, setHistory] = useState([]);
  const userId = localStorage.getItem("user_id");

  const API_URL = import.meta.env.VITE_API_REGISTRO_URL || "http://localhost:3001";

  useEffect(() => {
    if (!userId) return;

    const fetchHistory = async () => {
      try {
        const response = await axios.get(
          `${API_URL}/api/registros/historial/${userId}`,
          { headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` } }
        );
        setHistory(response.data);
      } catch (error) {
        console.error("Error al obtener historial:", error);
      }
    };

    fetchHistory();
  }, [userId]);

  return (
    <main className="history-page">
      <h1>Historial de Mediciones</h1>

      <div className="download-buttons">
        <button
          className="download-btn pdf"
          onClick={() => descargarHistorial(userId, "pdf")}
        >
          Descargar PDF
        </button>

        <button
          className="download-btn csv"
          onClick={() => descargarHistorial(userId, "csv")}
        >
          Descargar CSV
        </button>
      </div>

      {history.length === 0 && <p>No hay registros disponibles</p>}

      {history.map((item, index) => {
        const glucoseAlert = item.glucose > 130;
        const pressureAlert =
          item.systolic > 130 || item.diastolic > 85;

        return (
          <div
            key={index}
            className={`history-item ${
              glucoseAlert || pressureAlert ? "alert" : ""
            }`}
          >
            <div className="history-header">
              <span className="history-date">
                {formatDateLong(item.date)}
              </span>
            </div>

            <div className="history-values">
              <span className={`badge glucose ${glucoseAlert ? "danger" : ""}`}>
                Glucosa: {item.glucose} mg/dL
              </span>

              <span
                className={`badge pressure ${
                  pressureAlert ? "danger" : ""
                }`}
              >
                Presión: {item.systolic}/{item.diastolic} mmHg
              </span>
            </div>
          </div>
        );
      })}
    </main>
  );
}
</file>

<file path="src/services/AdminService.js">
import axios from 'axios';

const API_ADMIN_URL = import.meta.env.VITE_API_ADMIN_URL || 'http://localhost:4000/api/admin';

const getConfig = () => ({
  headers: {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${localStorage.getItem('token')}`
  }
});

export const getStats = async () => {
  try {
    const response = await axios.get(`${API_ADMIN_URL}/stats`, getConfig());
    return response.data;
  } catch (error) {
    return null;
  }
};

export const getUsers = async () => {
  try {
    const response = await axios.get(`${API_ADMIN_URL}/users`, getConfig());
    return response.data;
  } catch (error) {
    return [];
  }
};

export const createSpecialist = async (userData) => {
  try {
    await axios.post(`${API_ADMIN_URL}/create-specialist`, userData, getConfig());
    return { success: true };
  } catch (error) {
    return { success: false, error: error.response?.data?.error || error.message };
  }
};

export const resetUserPassword = async (email) => {
  try {
    await axios.post(`${API_ADMIN_URL}/send-reset-email`, { email }, getConfig());
    return { success: true };
  } catch (error) {
    return { success: false, error: error.response?.data?.error || error.message };
  }
};

export const updatePasswordFinal = async (email, newPassword) => {
  try {
    await axios.post(`${API_ADMIN_URL}/update-password`, { email, newPassword }, getConfig());
    return { success: true };
  } catch (error) {
    return { success: false, error: error.response?.data?.error || error.message };
  }
};

export const deleteUser = async (userId) => {
  try {
    await axios.delete(`${API_ADMIN_URL}/users/${userId}`, getConfig());
    return { success: true };
  } catch (error) {
    return { success: false, error: error.response?.data?.error || error.message };
  }
};

export const requestAccountDeletion = async (userId) => {
  try {
    await axios.patch(`${API_ADMIN_URL}/users/request-deletion/${userId}`, {}, getConfig());
    return { success: true };
  } catch (error) {
    return { success: false, error: error.response?.data?.error || error.message };
  }
};

export const verifyAdminStatus = async (email) => {
  try {
    const response = await axios.post(`${API_ADMIN_URL}/verify-admin`, { email: email.toLowerCase() }, getConfig());
    return response.data.isAdmin;
  } catch (error) {
    return false;
  }
};
</file>

<file path="src/components/Dashboard/HealthRegisterForm.jsx">
import { useState } from "react";
import axios from "axios"; 
import "../../Styles/healthRegister.css";

export default function HealthRegisterForm() {
  const [glucose, setGlucose] = useState("");
  const [systolic, setSystolic] = useState("");
  const [diastolic, setDiastolic] = useState("");

  const handleSubmit = async (e) => {
    e.preventDefault();

    if (glucose <= 0 || systolic <= 0 || diastolic <= 0) {
      alert("Los valores de salud deben ser mayores a 0");
      return;
    }

    try {
      const API_URL = import.meta.env.VITE_API_REGISTRO_URL || "http://localhost:3001";

      const payload = {
        patientId: localStorage.getItem("user_id"),
        glucosa: Number(glucose),
        sistolica: Number(systolic),
        diastolica: Number(diastolic),
      };

      await axios.post(`${API_URL}/api/registros`, payload, {
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${localStorage.getItem('token')}`
        },
      });

      alert("Registro guardado correctamente");

      setGlucose("");
      setSystolic("");
      setDiastolic("");

    } catch (error) {
      console.error("Error al guardar:", error);
      alert("Error al guardar registro");
    }
  };

  return (
    <form className="health-form" onSubmit={handleSubmit}>
      <div className="form-card blue">
        <h2>Glucosa (mg/dL)</h2>
        <input
          type="number"
          min="1"
          placeholder="Ej: 120"
          value={glucose}
          onChange={(e) => setGlucose(e.target.value)}
          required
        />
      </div>

      <div className="form-card red">
        <h2>Presión Arterial</h2>
        <div className="pressure-inputs">
          <input
            type="number"
            min="1"
            placeholder="Sistólica (Ej: 120)"
            value={systolic}
            onChange={(e) => setSystolic(e.target.value)}
            required
          />
          <span>/</span>
          <input
            type="number"
            min="1"
            placeholder="Diastólica (Ej: 80)"
            value={diastolic}
            onChange={(e) => setDiastolic(e.target.value)}
            required
          />
        </div>
      </div>

      <button className="save-btn">Guardar Registro</button>
    </form>
  );
}
</file>

<file path="src/pages/Dashboard.jsx">
import { useNavigate } from "react-router-dom";
import { useState, useEffect } from "react";
import { FaPlusCircle, FaChartBar } from "react-icons/fa";
import GlucoseCard from "../components/Dashboard/GlucoseCard";
import PressureCard from "../components/Dashboard/PressureCard";
import "../Styles/DashboardStyles.css";

export default function Dashboard() {
  const navigate = useNavigate();

  const [reading, setReading] = useState({
    glucose: 0,
    systolic: 0,
    diastolic: 0,
    date: "",
  });

  const userId = localStorage.getItem("user_id");

  useEffect(() => {
    const loadDashboard = async () => {
      const API_URL =
        import.meta.env.VITE_API_REGISTRO_URL || "http://localhost:3001";

      try {
        const res = await fetch(
          `${API_URL}/api/registros/dashboard/${userId}`
        );

        if (!res.ok) throw new Error("Error cargando dashboard");

        const data = await res.json();

        setReading({
          glucose: data.glucose?.value || 0,
          systolic: data.pressure?.systolic || 0,
          diastolic: data.pressure?.diastolic || 0,
          date: data.glucose?.date || "",
        });
      } catch (error) {
        console.error("Error cargando datos del dashboard:", error);
      }
    };

    if (userId) loadDashboard();
  }, [userId]);

  return (
    <main className="dashboard-bg">
      <div className="dashboard-container">
        <header className="dashboard-header">
          <h1>Panel de Control</h1>
          <p>Revisa y gestiona tu información de salud</p>
        </header>

        <section className="cards-container">
          <GlucoseCard glucose={reading.glucose} date={reading.date} />

          <PressureCard
            systolic={reading.systolic}
            diastolic={reading.diastolic}
            date={reading.date}
          />

          <div
            className="action-card register-card"
            onClick={() => navigate("/registro-salud")}
          >
            <h2>
              <FaPlusCircle className="card-icon" />
              Registrar Información
            </h2>
            <p>Ingresa nuevos datos de salud</p>
          </div>

          <div
            className="action-card history-card"
            onClick={() => navigate("/historial")}
          >
            <h2>
              <FaChartBar className="card-icon" />
              Ver Historial
            </h2>
            <p>Consulta registros anteriores</p>
          </div>
        </section>
      </div>
    </main>
  );
}
</file>

<file path="src/pages/RegisterPage.jsx">
import { useState } from 'react';
import { useNavigate, Link } from 'react-router-dom';
import axios from 'axios'; 
import '../Styles/signUpStyles.css';
import logo from '../assets/logo.png';
import { formatRut, isValidEmail } from "../utils/validations";

const Signup = () => {
  const navigate = useNavigate();
  const [error, setError] = useState(""); 
  const [formData, setFormData] = useState({
    email: '', password: '', rut: '', first_names: '', last_names: ''
  });

  const handleChange = (e) => {
    setFormData({ ...formData, [e.target.name]: e.target.value });
    if(error) setError(""); 
  };

  const handleRutChange = (e) => {
    const inputValue = e.target.value;
    if (inputValue.length > 12) return;
    setFormData({
      ...formData,
      rut: formatRut(inputValue) 
    });
    if(error) setError("");
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError(""); 

    if (!isValidEmail(formData.email)) {
      setError("El correo electrónico no es válido.");
      return;
    }

    if (formData.rut.length < 8) {
      setError("El RUT parece incompleto.");
      return;
    }

    try {
      const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:3000';
      
      const response = await axios.post(`${API_URL}/auth/signup`, formData, {
        headers: { 'Content-Type': 'application/json' }
      });

      const data = response.data;

      if (data.user || data.session) {
        const user = data.user;
        const session = data.session;
        
        if (user && user.id) {
            localStorage.setItem('user_id', user.id);
        }

        if (session && session.access_token) {
            localStorage.setItem('token', session.access_token);
        }

        localStorage.setItem('user_email', formData.email);
        localStorage.setItem('user_name', `${formData.first_names} ${formData.last_names}`);
        localStorage.setItem('user_role', 'patient');
        localStorage.setItem('temp_access', 'true');

        window.dispatchEvent(new Event("auth-change"));

        alert('Cuenta creada con éxito.'); 
        navigate('/ficha-medica'); 
      }
    } catch (error) {
      setError(error.response?.data?.error || 'Error al crear la cuenta. Intenta nuevamente.');
    }
  };

  return (
    <div className="signup-container">
      <div className="signup-box">
        <div className="signup-header">
          <img src={logo} alt="Salud Al Día" className="signup-logo" />
        </div>

        <form onSubmit={handleSubmit} className="form-grid">
          <div className="form-group">
            <label>RUT</label>
            <input 
              type="text" 
              name="rut" 
              placeholder="12.345.678-9" 
              value={formData.rut}
              onChange={handleRutChange} 
              required 
            />
          </div>

          <div className="form-group">
            <label>Nombres</label>
            <input type="text" name="first_names" placeholder="Juan Ignacio" onChange={handleChange} required />
          </div>
          
          <div className="form-group">
            <label>Apellidos</label>
            <input type="text" name="last_names" placeholder="Pérez Soto" onChange={handleChange} required />
          </div>
          
          <div className="form-group">
            <label>Email</label>
            <input type="email" name="email" placeholder="correo@ejemplo.com" onChange={handleChange} required />
          </div>
          
          <div className="form-group full-width">
            <label>Contraseña</label>
            <input type="password" name="password" placeholder="••••••••" onChange={handleChange} required />
          </div>

          {error && (
            <div className="error-message-container">
              {error}
            </div>
          )}

          <button type="submit" className="btn-signup">Crear Cuenta</button>
        </form>

        <p className="signup-footer">
          ¿Ya tienes cuenta? <Link to="/login">Inicia sesión</Link>
        </p>
      </div>
    </div>
  );
};

export default Signup;
</file>

<file path="src/pages/MedicalRecords.jsx">
import { useState, useEffect } from "react";
import { useNavigate } from "react-router-dom";
import { createMedicalRecord } from "../services/MedicalService";
import "../Styles/medicalRecordsStyles.css";
import logo from "../assets/logo.png";

const MedicalRecords = () => {
  const navigate = useNavigate();

  const [medicalData, setMedicalData] = useState({
    blood_type: "",
    height: "",
    initial_weight: "",
    allergies: "",
    chronic_diseases: "",
    emergency_contact_name: "",
    data_processing_consent: false,
  });

  const [phoneNumber, setPhoneNumber] = useState("");
  const [phoneError, setPhoneError] = useState("");

  useEffect(() => {
    const userId = localStorage.getItem("user_id");
    const token = localStorage.getItem("token");

    if (!userId || !token) {
      alert("Acceso denegado. Por favor, inicia sesión o regístrate.");
      navigate("/login");
    }
  }, [navigate]);

  const handleChange = (e) => {
    const { name, value, type, checked } = e.target;

    if (name === "height" && value > 300) return;
    if (name === "initial_weight" && value > 600) return;

    setMedicalData({
      ...medicalData,
      [name]: type === "checkbox" ? checked : value,
    });
  };

  const handlePhoneChange = (e) => {
    const value = e.target.value;
    const onlyNums = value.replace(/[^0-9]/g, "");

    if (onlyNums.length <= 9) {
      setPhoneNumber(onlyNums);

      if (onlyNums.length === 9) {
        if (onlyNums.charAt(0) !== "9") {
          setPhoneError("El número debe comenzar con 9");
        } else {
          setPhoneError("");
        }
      } else {
        setPhoneError("");
      }
    }
  };

  const isFormValid =
    medicalData.blood_type !== "" &&
    medicalData.height !== "" &&
    medicalData.initial_weight !== "" &&
    medicalData.emergency_contact_name !== "" &&
    phoneNumber.length === 9 &&
    phoneNumber.startsWith("9") &&
    medicalData.data_processing_consent === true;

  const handleSubmit = async (e) => {
    e.preventDefault();

    if (!medicalData.data_processing_consent) {
      alert("Debes aceptar los términos legales para continuar.");
      return;
    }

    if (phoneNumber.length !== 9 || !phoneNumber.startsWith("9")) {
      alert("El teléfono debe tener 9 dígitos y comenzar con 9.");
      return;
    }

    const userId = localStorage.getItem("user_id");
    const fullPhone = `+56${phoneNumber}`;

    const { data_processing_consent, ...datosLimpios } = medicalData;

    try {
      await createMedicalRecord({
        ...datosLimpios,
        emergency_contact_phone: fullPhone,
        user_id: userId,
      });

      alert("¡Ficha médica creada exitosamente!");
      navigate("/dashboard");
    } catch (error) {
      alert("Error: " + (error.message || "No autorizado."));
    }
  };

  return (
    <div className="medical-container">
      <div className="medical-box">
        <div className="medical-header">
          <img src={logo} alt="Salud Al Día" className="medical-logo" />
          <h2>Ficha Médica Inicial</h2>
        </div>

        <form onSubmit={handleSubmit} className="form-grid">
          <div className="form-group">
            <label>Tipo de Sangre</label>
            <select
              name="blood_type"
              value={medicalData.blood_type}
              onChange={handleChange}
              required
            >
              <option value="">Seleccionar...</option>
              <option value="A+">A+</option>
              <option value="O+">O+</option>
              <option value="B+">B+</option>
              <option value="AB+">AB+</option>
              <option value="A-">A-</option>
              <option value="O-">O-</option>
              <option value="B-">B-</option>
              <option value="AB-">AB-</option>
            </select>
          </div>

          <div className="form-group">
            <label>Estatura (cm)</label>
            <input
              type="number"
              name="height"
              value={medicalData.height}
              placeholder="Ej: 170"
              onChange={handleChange}
              min="50"
              max="300"
              required
            />
          </div>

          <div className="form-group">
            <label>Peso Inicial (kg)</label>
            <input
              type="number"
              name="initial_weight"
              value={medicalData.initial_weight}
              placeholder="Ej: 75"
              onChange={handleChange}
              min="20"
              max="500"
              required
            />
          </div>

          <div className="form-group">
            <label>Contacto de Emergencia</label>
            <input
              type="text"
              name="emergency_contact_name"
              value={medicalData.emergency_contact_name}
              placeholder="Nombre completo"
              onChange={handleChange}
              required
            />
          </div>

          <div className="form-group full-width">
            <label>Teléfono de Emergencia</label>
            <div
              className={`phone-input-group ${phoneError ? "input-error" : ""}`}
            >
              <div className="country-prefix">+56</div>

              <input
                type="tel"
                name="emergency_contact_phone"
                placeholder="9 1234 5678"
                value={phoneNumber}
                onChange={handlePhoneChange}
                required
                className="phone-field"
              />
            </div>
            {phoneError && <small className="error-text">{phoneError}</small>}
            <small className="hint-text">
              * Ingresa los 9 dígitos (ej: 987654321)
            </small>
          </div>

          <div className="form-group full-width">
            <label>Alergias</label>
            <textarea
              name="allergies"
              value={medicalData.allergies}
              placeholder="Medicamentos, alimentos..."
              onChange={handleChange}
            ></textarea>
          </div>

          <div className="form-group full-width">
            <label>Enfermedades Crónicas</label>
            <textarea
              name="chronic_diseases"
              value={medicalData.chronic_diseases}
              placeholder="Diabetes, Hipertensión..."
              onChange={handleChange}
            ></textarea>
          </div>

          <div className="form-group full-width checkbox-container">
            <label className="checkbox-label">
              <input
                type="checkbox"
                name="data_processing_consent"
                checked={medicalData.data_processing_consent}
                onChange={handleChange}
              />
              <span className="checkbox-text">
                Autorizo el tratamiento de mis datos sensibles de salud para
                fines de monitoreo y gestión médica, en conformidad con la Ley
                19.628 sobre Protección de la Vida Privada.
              </span>
            </label>
          </div>

          <button type="submit" className="btn-medical" disabled={!isFormValid}>
            Finalizar y Entrar
          </button>
        </form>
      </div>
    </div>
  );
};

export default MedicalRecords;
</file>

<file path="src/services/AuthService.js">
import axios from 'axios';

const API_ADMIN_URL = import.meta.env.VITE_API_ADMIN_URL || "http://localhost:4000/api/admin";
const API_URL = import.meta.env.VITE_API_URL || "http://localhost:3000";

const getAuthConfig = (tokenOverride) => {
  const token = tokenOverride || localStorage.getItem('token');
  return {
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    }
  };
};

export const isAdmin = async () => {
  try {
    const userEmail = localStorage.getItem("user_email");
    const token = localStorage.getItem("token");

    if (!userEmail || !token) return false;

    const response = await axios.post(
      `${API_ADMIN_URL}/verify-admin`, 
      { email: userEmail.toLowerCase() },
      getAuthConfig(token)
    );

    return response.data.isAdmin;
  } catch (error) {
    return false;
  }
};

export const getUserProfile = async (userId, token) => {
  try {
    const response = await axios.get(
      `${API_URL}/users/${userId}`, 
      getAuthConfig(token)
    );
    return response.data;
  } catch (error) {
    console.error(`Error Auth User ${userId}:`, error.message);
    return null;
  }
};

export const requestPublicPasswordReset = async (email) => {
  try {
    await axios.post(
      `${API_ADMIN_URL}/send-reset-email`,
      { email },
      { headers: { 'Content-Type': 'application/json' } }
    );
    return { success: true };
  } catch (error) {
    return { success: false, error: error.response?.data?.error || error.message };
  }
};
</file>

<file path="src/pages/LoginPage.jsx">
import { useState, useEffect } from 'react';
import { useNavigate, Link } from 'react-router-dom';
import axios from 'axios'; 
import { requestPublicPasswordReset, getUserProfile } from '../services/AuthService';
import '../Styles/loginStyles.css';
import logo from '../assets/logo.png'; 

const Login = () => {
  const [credentials, setCredentials] = useState({ email: '', password: '' });
  const [showResetModal, setShowResetModal] = useState(false);
  const [resetEmail, setResetEmail] = useState('');
  const [resetStatus, setResetStatus] = useState({ loading: false, msg: '', type: '' });
  const [cooldownTime, setCooldownTime] = useState(0); 
  
  const navigate = useNavigate();

  useEffect(() => {
    const lockUntil = localStorage.getItem('reset_lock_until');
    if (lockUntil) {
      const now = Date.now();
      const timeLeft = Math.ceil((parseInt(lockUntil) - now) / 1000);
      if (timeLeft > 0) {
        setCooldownTime(timeLeft);
      } else {
        localStorage.removeItem('reset_lock_until');
      }
    }
  }, []);

  useEffect(() => {
    if (cooldownTime <= 0) return;
    const timer = setInterval(() => {
      setCooldownTime((prev) => {
        if (prev <= 1) {
          localStorage.removeItem('reset_lock_until');
          return 0;
        }
        return prev - 1;
      });
    }, 1000);
    return () => clearInterval(timer);
  }, [cooldownTime]);

  const handleChange = (e) => {
    setCredentials({ ...credentials, [e.target.name]: e.target.value });
  };

  const handleLogin = async (e) => {
    e.preventDefault();
    try {
      const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:3000';
      
      const response = await axios.post(`${API_URL}/auth/login`, credentials, {
        headers: {
          'Content-Type': 'application/json'
        }
      });

      const data = response.data;
      const token = data.session?.access_token || data.token;
      
      if (!token) throw new Error("No se recibió token");

      localStorage.setItem('token', token);
      localStorage.setItem('user_email', credentials.email); 

      let userId = null;
      let userData = null;

      if (data.user && data.user.id) {
          userId = data.user.id;
          userData = data.user;
      } else if (data.session && data.session.user && data.session.user.id) {
          userId = data.session.user.id;
          userData = data.session.user;
      }

      if (userId) {
          localStorage.setItem('user_id', userId);
          
          if (userData) {
             const meta = userData.user_metadata || {};
             const firstName = meta.first_names || "Usuario";
             const lastName = meta.last_names || "";
             localStorage.setItem('user_name', `${firstName} ${lastName}`.trim());
          }

          let finalRole = 'patient';
          const profile = await getUserProfile(userId, token);
          
          if (profile && profile.role) {
              finalRole = profile.role;
          } else {
              const meta = userData?.user_metadata || {};
              finalRole = userData?.role || meta.role || 'patient';
          }

          if (finalRole === 'authenticated') finalRole = 'patient';

          localStorage.setItem('user_role', finalRole);
          
          window.dispatchEvent(new Event("auth-change"));
          window.dispatchEvent(new Event("storage"));
      
          if (finalRole === 'specialist') {
              navigate('/panel-medico');
          } else if (finalRole === 'admin') {
              navigate('/admin');
          } else {
              navigate('/dashboard');
          }
      }

    } catch (error) {
      console.error("Login Error:", error);
      alert(`Error: ${error.response?.data?.error || error.message}`);
    }
  };

  const handleResetSubmit = async (e) => {
    e.preventDefault();
    if (cooldownTime > 0) return;

    setResetStatus({ loading: true, msg: '', type: '' });
    const result = await requestPublicPasswordReset(resetEmail);
    setResetStatus({ loading: false });

    if (result.success) {
      setResetStatus({ msg: '¡Enlace enviado! Revisa tu correo.', type: 'success' });
      const secondsToWait = 300; 
      setCooldownTime(secondsToWait);
      const unlockTime = Date.now() + (secondsToWait * 1000);
      localStorage.setItem('reset_lock_until', unlockTime.toString());
    } else {
      setResetStatus({ msg: result.error || 'Error al enviar.', type: 'error' });
    }
  };

  const formatTime = (seconds) => {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
  };

  return (
    <div className="login-container">
      <div className="login-box">
        <div className="login-header">
          <img src={logo} alt="Salud Al Día" className="login-logo"/>
        </div>
        
        <form onSubmit={handleLogin}>
           <div className="input-group-login">
            <label>Correo Electrónico</label>
            <input type="email" name="email" placeholder="ejemplo@correo.com" onChange={handleChange} required />
          </div>
          <div className="input-group-login">
            <label>Contraseña</label>
            <input type="password" name="password" placeholder="••••••••" onChange={handleChange} required />
          </div>

          <div className="forgot-password-link">
             <button type="button" onClick={() => setShowResetModal(true)} className="btn-link">
               ¿Olvidaste tu contraseña?
             </button>
          </div>

          <button type="submit" className="btn-login">Entrar al Panel</button>
        </form>

        <p className="auth-footer">
          ¿No tiene una cuenta? <Link to="/signup">Regístrese aquí</Link>
        </p>
      </div>

      {showResetModal && (
        <div className="modal-overlay">
          <div className="modal-content">
            <h3>Recuperar Contraseña</h3>
            <p>Ingresa tu correo y te enviaremos un enlace.</p>
            
            <form onSubmit={handleResetSubmit}>
              <input 
                type="email" 
                value={resetEmail}
                onChange={(e) => setResetEmail(e.target.value)}
                placeholder="tu@correo.com"
                required
                className="input-reset"
                disabled={cooldownTime > 0}
              />
              
              {resetStatus.msg && (
                <p className={`status-msg ${resetStatus.type}`}>{resetStatus.msg}</p>
              )}

              {cooldownTime > 0 && (
                <p className="cooldown-text">
                  Espera {formatTime(cooldownTime)} para intentar de nuevo.
                </p>
              )}

              <div className="modal-actions">
                <button type="button" onClick={() => setShowResetModal(false)} className="btn-cancel">
                  {cooldownTime > 0 ? 'Cerrar' : 'Cancelar'}
                </button>
                
                <button 
                  type="submit" 
                  className={`btn-confirm ${cooldownTime > 0 ? 'disabled' : ''}`}
                  disabled={resetStatus.loading || cooldownTime > 0}
                >
                  {resetStatus.loading ? 'Enviando...' : cooldownTime > 0 ? 'Espera...' : 'Enviar'}
                </button>
              </div>
            </form>
          </div>
        </div>
      )}
    </div>
  );
};

export default Login;
</file>

<file path="src/App.jsx">
import { useState, useEffect } from "react";
import { BrowserRouter as Router, Routes, Route } from "react-router-dom";

import ContactPage from "./pages/ContactPage";
import HomePage from "./pages/HomePage";
import LoginPage from "./pages/LoginPage";
import RegisterPage from "./pages/RegisterPage";
import AboutPage from "./pages/AboutPage";
import Dashboard from "./pages/Dashboard";
import HistoryPage from "./pages/HistoryPage";
import HealthRegisterPage from "./pages/HealthRegisterPage";
import MedicalRecords from "./pages/MedicalRecords";
import AdminPage from "./pages/AdminPage";
import ProfilePage from "./pages/ProfilePage";
import ResetPassword from "./pages/ResetPassword";
import SpecialistDashboard from "./pages/SpecialistDashboard";
import PatientFile from "./pages/PatientFile";

import Navbar from "./components/Navbar";
import ChatWidget from "./components/Chat/ChatWidget";
import Loader from "./components/Loader"; 
import { isAdmin } from "./services/AuthService";

import PatientGuard from "./components/Guards/PatientGuard";
import SpecialistGuard from "./components/Guards/SpecialistGuard";
import AdminGuard from "./components/Guards/AdminGuard";

function App() {
  const [currentUserId, setCurrentUserId] = useState(localStorage.getItem('user_id'));
  const [isUserAdmin, setIsUserAdmin] = useState(false);
  const [userRole, setUserRole] = useState(localStorage.getItem('user_role'));
  const [isAuthChecking, setIsAuthChecking] = useState(true);

  const refreshAppState = async () => {
      setIsAuthChecking(true);
      
      const token = localStorage.getItem('token');
      const userId = localStorage.getItem('user_id');
      const role = localStorage.getItem('user_role');

      setCurrentUserId(userId);
      setUserRole(role);

      if (token && userId) {
        try {
            const adminStatus = await isAdmin();
            setIsUserAdmin(adminStatus);
        } catch {
            setIsUserAdmin(false);
        }
      } else {
        setIsUserAdmin(false);
      }
      
      setTimeout(() => {
          setIsAuthChecking(false);
      }, 1500); 
  };

  useEffect(() => {
    refreshAppState();
    window.addEventListener('auth-change', refreshAppState);
    window.addEventListener('storage', refreshAppState);

    return () => {
        window.removeEventListener('auth-change', refreshAppState);
        window.removeEventListener('storage', refreshAppState);
    };
  }, []);

  if (isAuthChecking) {
    return <Loader message="Verificando credenciales y permisos..." />;
  }

  return (
    <Router>
      <Navbar 
        isUserAdmin={isUserAdmin} 
        userRole={userRole} 
      />
      
      <Routes>
        <Route path="/" element={<HomePage />} />
        <Route path="/home" element={<HomePage />} />
        <Route path="/login" element={<LoginPage />} />
        <Route path="/signup" element={<RegisterPage />} />
        <Route path="/about" element={<AboutPage />} />
        <Route path="/contact" element={<ContactPage />} />
        <Route path="/reset-password" element={<ResetPassword />} />

        <Route 
          path="/dashboard" 
          element={
            <PatientGuard>
              <Dashboard />
            </PatientGuard>
          } 
        />
        <Route 
          path="/historial" 
          element={
            <PatientGuard>
              <HistoryPage />
            </PatientGuard>
          } 
        />
        <Route 
          path="/perfil" 
          element={
            <PatientGuard>
              <ProfilePage />
            </PatientGuard>
          } 
        />
        <Route 
          path="/registro-salud" 
          element={
            <PatientGuard>
              <HealthRegisterPage />
            </PatientGuard>
          } 
        />
        <Route 
          path="/ficha-medica" 
          element={
            <PatientGuard>
              <MedicalRecords />
            </PatientGuard>
          } 
        />

        <Route 
            path="/panel-medico" 
            element={
                <SpecialistGuard>
                    <SpecialistDashboard />
                </SpecialistGuard>
            } 
        />
        <Route 
            path="/paciente/:id" 
            element={
                <SpecialistGuard>
                    <PatientFile />
                </SpecialistGuard>
            } 
        />

        <Route
          path="/admin"
          element={
            <AdminGuard>
              <AdminPage />
            </AdminGuard>
          }
        />
      </Routes>

      {!isAuthChecking && currentUserId && !isUserAdmin && userRole !== 'specialist' && (
        <ChatWidget userId={currentUserId} />
      )}
      
    </Router>
  );
}

export default App;
</file>

<file path="src/components/Navbar.jsx">
import { useState } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import SosButton from './SosButton'; 
import '../Styles/NavbarStyles.css';
import logo1 from '../assets/logo1.png';
import { Stethoscope, LogOut, LayoutDashboard } from 'lucide-react';

const Navbar = ({ isUserAdmin, userRole }) => {
    const navigate = useNavigate();
    const [isOpen, setIsOpen] = useState(false);
    
    const docName = localStorage.getItem('user_name') || '';
    const token = localStorage.getItem('token');

    const handleLogout = () => {
        localStorage.clear();
        window.dispatchEvent(new Event("auth-change"));
        navigate('/login');
        setIsOpen(false);
    };

    const isSpecialist = userRole === 'specialist';
    // El SOS se muestra solo si hay token, NO es admin y NO es especialista
    const showSos = token && !isUserAdmin && !isSpecialist;

    return (
        <nav className="navbar">
            <div className="navbar-container">
                {/* Lógica del Logo: Especialista -> Panel, Otros -> Home */}
                <Link 
                    to={isSpecialist ? "/panel-medico" : "/"} 
                    className="nav-logo" 
                    onClick={() => setIsOpen(false)}
                >
                    <img src={logo1} alt="Salud al Día" className="logo-img" />
                </Link>

                <div className={`nav-collapse ${isOpen ? 'active' : ''}`}>
                    <div className="nav-menu">
                        <Link to="/about" className="nav-item" onClick={() => setIsOpen(false)}>Sobre Nosotros</Link>
                        <Link to="/contact" className="nav-item" onClick={() => setIsOpen(false)}>Contáctanos</Link>
                        
                        {token && (
                            <>
                                {isSpecialist ? (
                                    <Link to="/panel-medico" className="nav-item nav-special-link" onClick={() => setIsOpen(false)}>
                                        <LayoutDashboard size={18} className="nav-icon-inline" /> Panel Médico
                                    </Link>
                                ) : isUserAdmin ? (
                                    <Link to="/admin" className="nav-item" onClick={() => setIsOpen(false)}>Panel Admin</Link>
                                ) : (
                                    <>
                                        <Link to="/dashboard" className="nav-item" onClick={() => setIsOpen(false)}>Mi Panel</Link>
                                        <Link to="/historial" className="nav-item" onClick={() => setIsOpen(false)}>Historial</Link>
                                        <Link to="/perfil" className="nav-item" onClick={() => setIsOpen(false)}>Mi Perfil</Link>
                                    </>
                                )}
                            </>
                        )}
                    </div>

                    <div className="nav-auth">
                        {token ? (
                            <div className="nav-user-area">
                                {isSpecialist && (
                                    <div className="specialist-nav-badge">
                                        <div className="specialist-info">
                                            <span className="specialist-name">{docName}</span>
                                            <span className="specialist-role">Profesional</span>
                                        </div>
                                        <div className="specialist-icon-box">
                                            <Stethoscope size={18} />
                                        </div>
                                    </div>
                                )}

                                {showSos && <div className="sos-desktop-wrapper"><SosButton /></div>}
                                
                                <button onClick={handleLogout} className={isSpecialist ? "btn-logout-specialist" : "btn-login btn-logout-general"}>
                                    {isSpecialist ? (
                                        <>
                                            <LogOut size={16} /> Salir
                                        </>
                                    ) : (
                                        "Cerrar Sesión"
                                    )}
                                </button>
                            </div>
                        ) : (
                            <>
                                <Link to="/login" className="btn-login" onClick={() => setIsOpen(false)}>Iniciar Sesión</Link>
                                <Link to="/signup" className="btn-register" onClick={() => setIsOpen(false)}>Registrarse</Link>
                            </>
                        )}
                    </div>
                </div>

                <div className="nav-mobile-actions">
                    {showSos && <div className="sos-mobile-wrapper"><SosButton /></div>}
                    <div className={`hamburger ${isOpen ? 'active' : ''}`} onClick={() => setIsOpen(!isOpen)}>
                        <span className="bar"></span>
                        <span className="bar"></span>
                        <span className="bar"></span>
                    </div>
                </div>
            </div>
        </nav>
    );
};

export default Navbar;
</file>

</files>
